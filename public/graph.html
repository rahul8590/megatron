<!--  
The Callgraph is the page where the graph objects is send to the front end and been streamed to graph.html. The webpage will display all the graph details. 

-->


<html>
<body>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script src="springy.js" type="text/javascript"></script>
<script src="springyui.js" type="text/javascript"></script>

<script src="/socket.io/socket.io.js"></script>

<script>
var graph = new Springy.Graph();
var JSON = JSON || {}; 
var socket = io.connect('http://localhost:8590');
var call_list = [] // List of all call objects.


/*

The Call objects are generated in the client side which needs 
to be streamed to server side as and when generated.
The current assumed structure of call object is 
call = {caller: 'func1', callee: 'func2'};
*/


//Dummy call objects being creeated here 
var call = {caller: 'func1', callee: 'func2'};  // caller object info.
var call1 = {caller: 'func3', callee: 'func4'};  // caller object info.  


// Newly inserted code starts here 
socket.on('init',function (data) {
	if (data == 'start') {
		socket.emit('gobjects',JSON.stringify(call)); 
		socket.emit('gobjects',JSON.stringify(call1));
		socket.emit('gobjects','end');
	}		
});

socket.on('graph',function(data) {
	call_list = JSON.parse(data);
	alert(call_list.toString());
	for (var i =0; i < call_list.length; i++)
	{ 
		graph.newEdge(graph.newNode({label: call_list[i].caller}), graph.newNode({label: call_list[i].callee}), {color: '#00A0B0'});
	}
});


// Newly inserted code ends here 



/*
socket.on('graph', function (data) {
	var a = JSON.parse(data);
	call_list.push(a);	
});

socket.on('end',function(data) {
	  var end = JSON.parse(data);
	  if (end.status == 'complete') {
		 for (var i =0; i < call_list.length; i++)
		 { 
		graph.newEdge(graph.newNode({label: call_list[i].caller}), graph.newNode({label: call_list[i].callee}), {color: '#00A0B0'});
		}
	}
  });
*/

jQuery(function(){
 document.getElementById('callgraph').value = null; // flushing the canvas to avoid caching of objects
  var springy = window.springy = jQuery('#callgraph').springy({
    graph: graph,
    nodeSelected: function(node){
      console.log('Node selected: ' + JSON.stringify(node.data));
    }
  });
}); 
  
</script>

<canvas id="callgraph" width = "640" height = "500" />
</body>
</html>
