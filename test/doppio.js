// Copyright 2009 The Closure Library Authors. All Rights Reserved.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//      http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS-IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

//     Underscore.js 1.5.2
//     http://underscorejs.org
//     (c) 2009-2013 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
//     Underscore may be freely distributed under the MIT license.

define("src/gLong",["require","exports"],function(require,exports){var gLong=function(){function gLong(low,high){this.low_=low|0,this.high_=high|0}return gLong.fromInt=function(value){if(-128<=value&&value<128){var cachedObj=gLong.IntCache_[value];if(cachedObj)return cachedObj}var obj=new gLong(value,value<0?-1:0);return-128<=value&&value<128&&(gLong.IntCache_[value]=obj),obj},gLong.fromNumber=function(value){return isNaN(value)||!isFinite(value)?gLong.ZERO:value<=-gLong.TWO_PWR_63_DBL_?gLong.MIN_VALUE:value+1>=gLong.TWO_PWR_63_DBL_?gLong.MAX_VALUE:value<0?gLong.fromNumber(-value).negate():new gLong(value%gLong.TWO_PWR_32_DBL_|0,value/gLong.TWO_PWR_32_DBL_|0)},gLong.fromBits=function(lowBits,highBits){return new gLong(lowBits,highBits)},gLong.fromString=function(str,opt_radix){if(str.length==0)throw Error("number format error: empty string");var radix=opt_radix||10;if(radix<2||36<radix)throw Error("radix out of range: "+radix);if(str.charAt(0)=="-")return gLong.fromString(str.substring(1),radix).negate();if(str.indexOf("-")>=0)throw Error('number format error: interior "-" character: '+str);var radixToPower=gLong.fromNumber(Math.pow(radix,8)),result=gLong.ZERO;for(var i=0;i<str.length;i+=8){var size=Math.min(8,str.length-i),value=parseInt(str.substring(i,i+size),radix);if(size<8){var power=gLong.fromNumber(Math.pow(radix,size));result=result.multiply(power).add(gLong.fromNumber(value))}else result=result.multiply(radixToPower),result=result.add(gLong.fromNumber(value))}return result},gLong.prototype.toInt=function(){return this.low_},gLong.prototype.toNumber=function(){return this.high_*gLong.TWO_PWR_32_DBL_+this.getLowBitsUnsigned()},gLong.prototype.toString=function(opt_radix){var radix=opt_radix||10;if(radix<2||36<radix)throw Error("radix out of range: "+radix);if(this.isZero())return"0";if(this.isNegative()){if(this.equals(gLong.MIN_VALUE)){var radixLong=gLong.fromNumber(radix),div=this.div(radixLong),rem=div.multiply(radixLong).subtract(this);return div.toString(radix)+rem.toInt().toString(radix)}return"-"+this.negate().toString(radix)}var radixToPower=gLong.fromNumber(Math.pow(radix,6)),rem=this,result="";for(;;){var remDiv=rem.div(radixToPower),intval=rem.subtract(remDiv.multiply(radixToPower)).toInt(),digits=intval.toString(radix);rem=remDiv;if(rem.isZero())return digits+result;while(digits.length<6)digits="0"+digits;result=""+digits+result}},gLong.prototype.getHighBits=function(){return this.high_},gLong.prototype.getLowBits=function(){return this.low_},gLong.prototype.getLowBitsUnsigned=function(){return this.low_>=0?this.low_:gLong.TWO_PWR_32_DBL_+this.low_},gLong.prototype.getNumBitsAbs=function(){if(this.isNegative())return this.equals(gLong.MIN_VALUE)?64:this.negate().getNumBitsAbs();var val=this.high_!=0?this.high_:this.low_;for(var bit=31;bit>0;bit--)if((val&1<<bit)!=0)break;return this.high_!=0?bit+33:bit+1},gLong.prototype.isZero=function(){return this.high_==0&&this.low_==0},gLong.prototype.isNegative=function(){return this.high_<0},gLong.prototype.isOdd=function(){return(this.low_&1)==1},gLong.prototype.equals=function(other){return this.high_==other.high_&&this.low_==other.low_},gLong.prototype.notEquals=function(other){return this.high_!=other.high_||this.low_!=other.low_},gLong.prototype.lessThan=function(other){return this.compare(other)<0},gLong.prototype.lessThanOrEqual=function(other){return this.compare(other)<=0},gLong.prototype.greaterThan=function(other){return this.compare(other)>0},gLong.prototype.greaterThanOrEqual=function(other){return this.compare(other)>=0},gLong.prototype.compare=function(other){if(this.equals(other))return 0;var thisNeg=this.isNegative(),otherNeg=other.isNegative();return thisNeg&&!otherNeg?-1:!thisNeg&&otherNeg?1:this.subtract(other).isNegative()?-1:1},gLong.prototype.negate=function(){return this.equals(gLong.MIN_VALUE)?gLong.MIN_VALUE:this.not().add(gLong.ONE)},gLong.prototype.add=function(other){var a48=this.high_>>>16,a32=this.high_&65535,a16=this.low_>>>16,a00=this.low_&65535,b48=other.high_>>>16,b32=other.high_&65535,b16=other.low_>>>16,b00=other.low_&65535,c48=0,c32=0,c16=0,c00=0;return c00+=a00+b00,c16+=c00>>>16,c00&=65535,c16+=a16+b16,c32+=c16>>>16,c16&=65535,c32+=a32+b32,c48+=c32>>>16,c32&=65535,c48+=a48+b48,c48&=65535,gLong.fromBits(c16<<16|c00,c48<<16|c32)},gLong.prototype.subtract=function(other){return this.add(other.negate())},gLong.prototype.multiply=function(other){if(this.isZero())return gLong.ZERO;if(other.isZero())return gLong.ZERO;if(this.equals(gLong.MIN_VALUE))return other.isOdd()?gLong.MIN_VALUE:gLong.ZERO;if(other.equals(gLong.MIN_VALUE))return this.isOdd()?gLong.MIN_VALUE:gLong.ZERO;if(this.isNegative())return other.isNegative()?this.negate().multiply(other.negate()):this.negate().multiply(other).negate();if(other.isNegative())return this.multiply(other.negate()).negate();if(this.lessThan(gLong.TWO_PWR_24_)&&other.lessThan(gLong.TWO_PWR_24_))return gLong.fromNumber(this.toNumber()*other.toNumber());var a48=this.high_>>>16,a32=this.high_&65535,a16=this.low_>>>16,a00=this.low_&65535,b48=other.high_>>>16,b32=other.high_&65535,b16=other.low_>>>16,b00=other.low_&65535,c48=0,c32=0,c16=0,c00=0;return c00+=a00*b00,c16+=c00>>>16,c00&=65535,c16+=a16*b00,c32+=c16>>>16,c16&=65535,c16+=a00*b16,c32+=c16>>>16,c16&=65535,c32+=a32*b00,c48+=c32>>>16,c32&=65535,c32+=a16*b16,c48+=c32>>>16,c32&=65535,c32+=a00*b32,c48+=c32>>>16,c32&=65535,c48+=a48*b00+a32*b16+a16*b32+a00*b48,c48&=65535,gLong.fromBits(c16<<16|c00,c48<<16|c32)},gLong.prototype.div=function(other){if(other.isZero())throw Error("division by zero");if(this.isZero())return gLong.ZERO;if(this.equals(gLong.MIN_VALUE)){if(other.equals(gLong.ONE)||other.equals(gLong.NEG_ONE))return gLong.MIN_VALUE;if(other.equals(gLong.MIN_VALUE))return gLong.ONE;var halfThis=this.shiftRight(1),l_approx=halfThis.div(other).shiftLeft(1);if(l_approx.equals(gLong.ZERO))return other.isNegative()?gLong.ONE:gLong.NEG_ONE;var rem=this.subtract(other.multiply(l_approx)),result=l_approx.add(rem.div(other));return result}if(other.equals(gLong.MIN_VALUE))return gLong.ZERO;if(this.isNegative())return other.isNegative()?this.negate().div(other.negate()):this.negate().div(other).negate();if(other.isNegative())return this.div(other.negate()).negate();var res=gLong.ZERO,rem=this;while(rem.greaterThanOrEqual(other)){var approx=Math.max(1,Math.floor(rem.toNumber()/other.toNumber())),log2=Math.ceil(Math.log(approx)/Math.LN2),delta=1;log2>48&&(delta=Math.pow(2,log2-48));var approxRes=gLong.fromNumber(approx),approxRem=approxRes.multiply(other);while(approxRem.isNegative()||approxRem.greaterThan(rem))approx-=delta,approxRes=gLong.fromNumber(approx),approxRem=approxRes.multiply(other);approxRes.isZero()&&(approxRes=gLong.ONE),res=res.add(approxRes),rem=rem.subtract(approxRem)}return res},gLong.prototype.modulo=function(other){return this.subtract(this.div(other).multiply(other))},gLong.prototype.not=function(){return gLong.fromBits(~this.low_,~this.high_)},gLong.prototype.and=function(other){return gLong.fromBits(this.low_&other.low_,this.high_&other.high_)},gLong.prototype.or=function(other){return gLong.fromBits(this.low_|other.low_,this.high_|other.high_)},gLong.prototype.xor=function(other){return gLong.fromBits(this.low_^other.low_,this.high_^other.high_)},gLong.prototype.shiftLeft=function(numBits){numBits&=63;if(numBits==0)return this;var low=this.low_;if(numBits<32){var high=this.high_;return gLong.fromBits(low<<numBits,high<<numBits|low>>>32-numBits)}return gLong.fromBits(0,low<<numBits-32)},gLong.prototype.shiftRight=function(numBits){numBits&=63;if(numBits==0)return this;var high=this.high_;if(numBits<32){var low=this.low_;return gLong.fromBits(low>>>numBits|high<<32-numBits,high>>numBits)}return gLong.fromBits(high>>numBits-32,high>=0?0:-1)},gLong.prototype.shiftRightUnsigned=function(numBits){numBits&=63;if(numBits==0)return this;var high=this.high_;if(numBits<32){var low=this.low_;return gLong.fromBits(low>>>numBits|high<<32-numBits,high>>>numBits)}return numBits==32?gLong.fromBits(high,0):gLong.fromBits(high>>>numBits-32,0)},gLong.IntCache_={},gLong.TWO_PWR_16_DBL_=65536,gLong.TWO_PWR_24_DBL_=1<<24,gLong.TWO_PWR_32_DBL_=gLong.TWO_PWR_16_DBL_*gLong.TWO_PWR_16_DBL_,gLong.TWO_PWR_31_DBL_=gLong.TWO_PWR_32_DBL_/2,gLong.TWO_PWR_48_DBL_=gLong.TWO_PWR_32_DBL_*gLong.TWO_PWR_16_DBL_,gLong.TWO_PWR_64_DBL_=gLong.TWO_PWR_32_DBL_*gLong.TWO_PWR_32_DBL_,gLong.TWO_PWR_63_DBL_=gLong.TWO_PWR_64_DBL_/2,gLong.ZERO=gLong.fromInt(0),gLong.ONE=gLong.fromInt(1),gLong.NEG_ONE=gLong.fromInt(-1),gLong.MAX_VALUE=gLong.fromBits(4294967295,2147483647),gLong.MIN_VALUE=gLong.fromBits(0,2147483648),gLong.TWO_PWR_24_=gLong.fromInt(gLong.TWO_PWR_24_DBL_),gLong}();return gLong}),define("src/util",["require","exports","./gLong"],function(require,exports,__gLong__){function async_foreach(lst,fn,done_cb){function process(){i++,i<lst.length?fn(lst[i],process):done_cb()}var i=-1;process()}function arrayset(len,val){var array=new Array(len);for(var i=0;i<len;i++)array[i]=val;return array}function int_mod(rs,a,b){if(b===0){var err_cls=rs.get_bs_class("Ljava/lang/ArithmeticException;");rs.java_throw(err_cls,"/ by zero")}return a%b}function int_div(rs,a,b){if(b===0){var err_cls=rs.get_bs_class("Ljava/lang/ArithmeticException;");rs.java_throw(err_cls,"/ by zero")}return a===exports.INT_MIN&&b===-1?a:a/b|0}function long_mod(rs,a,b){if(b.isZero()){var err_cls=rs.get_bs_class("Ljava/lang/ArithmeticException;");rs.java_throw(err_cls,"/ by zero")}return a.modulo(b)}function long_div(rs,a,b){if(b.isZero()){var err_cls=rs.get_bs_class("Ljava/lang/ArithmeticException;");rs.java_throw(err_cls,"/ by zero")}return a.div(b)}function float2int(a){return a>exports.INT_MAX?exports.INT_MAX:a<exports.INT_MIN?exports.INT_MIN:a|0}function intbits2float(int32){if(typeof Int32Array!="undefined"){var i_view=new Int32Array([int32]),f_view=new Float32Array(i_view.buffer);return f_view[0]}if(int32===exports.FLOAT_POS_INFINITY_AS_INT)return Number.POSITIVE_INFINITY;if(int32===exports.FLOAT_NEG_INFINITY_AS_INT)return Number.NEGATIVE_INFINITY;var sign=(int32&2147483648)>>>31,exponent=(int32&2139095040)>>>23,significand=int32&8388607,value;exponent===0?value=Math.pow(-1,sign)*significand*Math.pow(2,-149):value=Math.pow(-1,sign)*(1+significand*Math.pow(2,-23))*Math.pow(2,exponent-127);if(value<exports.FLOAT_NEG_INFINITY||value>exports.FLOAT_POS_INFINITY)value=NaN;return value}function longbits2double(uint32_a,uint32_b){if(typeof Uint32Array!="undefined"){var i_view=new Uint32Array(2);i_view[0]=uint32_b,i_view[1]=uint32_a;var d_view=new Float64Array(i_view.buffer);return d_view[0]}var sign=(uint32_a&2147483648)>>>31,exponent=(uint32_a&2146435072)>>>20,significand=exports.lshift(uint32_a&1048575,32)+uint32_b;return exponent===0&&significand===0?0:exponent===2047?significand===0?sign===1?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY:NaN:exponent===0?Math.pow(-1,sign)*significand*Math.pow(2,-1074):Math.pow(-1,sign)*(1+significand*Math.pow(2,-52))*Math.pow(2,exponent-1023)}function wrap_float(a){return a>3.4028234663852886e38?Number.POSITIVE_INFINITY:0<a&&a<1.401298464324817e-45?0:a<-3.4028234663852886e38?Number.NEGATIVE_INFINITY:0>a&&a>-1.401298464324817e-45?0:a}function cmp(a,b){return a===b?0:a<b?-1:a>b?1:null}function lshift(x,n){return x*Math.pow(2,n)}function read_uint(bytes){var n=bytes.length-1,sum=0;for(var i=0;i<=n;i++)sum+=exports.lshift(bytes[i],8*(n-i));return sum}function chars2js_str(jvm_carr,offset,count){var off=offset||0;return exports.bytes2str(jvm_carr.array).substr(off,count)}function bytestr_to_array(bytecode_string){var rv=[];for(var i=0;i<bytecode_string.length;i++)rv.push(bytecode_string.charCodeAt(i)&255);return rv}function array_to_bytestr(bytecode_array){var rv="";for(var i=0;i<bytecode_array.length;i++)rv+=String.fromCharCode(bytecode_array[i]);return rv}function parse_flags(flag_byte){return{"public":(flag_byte&1)>0,"private":(flag_byte&2)>0,"protected":(flag_byte&4)>0,"static":(flag_byte&8)>0,"final":(flag_byte&16)>0,"synchronized":(flag_byte&32)>0,"super":(flag_byte&32)>0,"volatile":(flag_byte&64)>0,"transient":(flag_byte&128)>0,"native":(flag_byte&256)>0,"interface":(flag_byte&512)>0,"abstract":(flag_byte&1024)>0,strict:(flag_byte&2048)>0}}function escaper(c){var args=[];for(var _i=0;_i<arguments.length-1;_i++)args[_i]=arguments[_i+1];switch(c){case"\n":return"\\n";case"\r":return"\\r";case"	":return"\\t";case"":return"\\v";case"\f":return"\\f";default:return c}}function escape_whitespace(str){return str.replace(/\s/g,escaper)}function format_extra_info(entry){var type=entry.type,info=typeof entry.deref=="function"?entry.deref():void 0;if(!info)return"";switch(type){case"Method":case"InterfaceMethod":return"	//  "+info["class"]+"."+info.sig;case"Field":return"	//  "+info["class"]+"."+info.name+":"+info.type;case"NameAndType":return"//  "+info.name+":"+info.type;default:if(exports.is_string(info))return"	//  "+exports.escape_whitespace(info)}}function initial_value(type_str){if(type_str==="J")return gLong.ZERO;var c=type_str[0];return c==="["||c==="L"?null:0}function is_string(obj){return typeof obj=="string"||obj instanceof String}function ext_classname(str){return exports.descriptor2typestr(str).replace(/\//g,".")}function int_classname(str){return exports.typestr2descriptor(str.replace(/\./g,"/"))}function verify_int_classname(str){var array_nesting=str.match(/^\[*/)[0].length;if(array_nesting>255)return!1;array_nesting>0&&(str=str.slice(array_nesting));if(str[0]==="L"){if(str[str.length-1]!==";")return!1;str=str.slice(1,-1)}if(str in exports.internal2external)return!0;if(str.match(/\/{2,}/))return!1;var parts=str.split("/");for(var i=0;i<parts.length;i++)if(parts[i].match(/[^$_a-z0-9]/i))return!1;return!0}function get_component_type(type_str){return type_str.slice(1)}function is_array_type(type_str){return type_str[0]==="["}function is_primitive_type(type_str){return type_str in exports.internal2external}function is_reference_type(type_str){return type_str[0]==="L"}function descriptor2typestr(type_str){var c=type_str[0];if(c in exports.internal2external)return exports.internal2external[c];if(c==="L")return type_str.slice(1,-1);if(c==="[")return type_str;throw new Error("Unrecognized type string: "+type_str)}function carr2descriptor(carr){var c=carr.shift();if(c==null)return null;if(exports.internal2external[c]!==void 0)return c;if(c==="L"){var rv="L";while((c=carr.shift())!==";")rv+=c;return rv+";"}if(c==="[")return"["+exports.carr2descriptor(carr);throw carr.unshift(c),new Error("Unrecognized descriptor: "+carr.join(""))}function typestr2descriptor(type_str){return exports.external2internal[type_str]!==void 0?exports.external2internal[type_str]:type_str[0]==="["?type_str:"L"+type_str+";"}function bytes2str(bytes,null_terminate){var y,z,idx=0,rv="";while(idx<bytes.length){var x=bytes[idx++]&255;if(null_terminate&&x==0)break;rv+=String.fromCharCode(x<=127?x:x<=223?(y=bytes[idx++],((x&31)<<6)+(y&63)):(y=bytes[idx++],z=bytes[idx++],((x&15)<<12)+((y&63)<<6)+(z&63)))}return rv}function last(array){return array[array.length-1]}var gLong=__gLong__;exports.async_foreach=async_foreach,exports.INT_MAX=Math.pow(2,31)-1,exports.INT_MIN=-exports.INT_MAX-1,exports.FLOAT_POS_INFINITY=Math.pow(2,128),exports.FLOAT_NEG_INFINITY=-1*exports.FLOAT_POS_INFINITY,exports.FLOAT_POS_INFINITY_AS_INT=2139095040,exports.FLOAT_NEG_INFINITY_AS_INT=-8388608,exports.FLOAT_NaN_AS_INT=2143289344,Math["imul"]==null&&(Math.imul=function(a,b){var ah=a>>>16&65535,al=a&65535,bh=b>>>16&65535,bl=b&65535;return al*bl+(ah*bl+al*bh<<16>>>0)|0}),Array.prototype.indexOf||(Array.prototype.indexOf=function(searchElement,fromIndex){if(this==null)throw new TypeError;var t=Object(this),len=t.length>>>0;if(len===0)return-1;var n=0;fromIndex!==undefined&&(n=Number(fromIndex),n!=n?n=0:n!=0&&n!=Infinity&&n!=-Infinity&&(n=(n>0||-1)*Math.floor(Math.abs(n))));if(n>=len)return-1;var k=n>=0?n:Math.max(len-Math.abs(n),0);for(;k<len;k++)if(k in t&&t[k]===searchElement)return k;return-1}),exports.arrayset=arrayset,exports.int_mod=int_mod,exports.int_div=int_div,exports.long_mod=long_mod,exports.long_div=long_div,exports.float2int=float2int,exports.intbits2float=intbits2float,exports.longbits2double=longbits2double,exports.wrap_float=wrap_float,exports.cmp=cmp,exports.lshift=lshift,exports.read_uint=read_uint,exports.chars2js_str=chars2js_str,exports.bytestr_to_array=bytestr_to_array,exports.array_to_bytestr=array_to_bytestr,exports.parse_flags=parse_flags,exports.escape_whitespace=escape_whitespace,exports.format_extra_info=format_extra_info;var BytesArray=function(){function BytesArray(buffer,start,end){this.buffer=buffer,this.start=start!=null?start:0,this.end=end!=null?end:this.buffer.length,this._index=0}return BytesArray.prototype.rewind=function(){this._index=0},BytesArray.prototype.pos=function(){return this._index},BytesArray.prototype.skip=function(bytes_count){this._index+=bytes_count},BytesArray.prototype.has_bytes=function(){return this.start+this._index<this.end},BytesArray.prototype.get_uint=function(bytes_count){var readIndex=this.start+this._index;this._index+=bytes_count;switch(bytes_count){case 1:return this.buffer.readUInt8(readIndex);case 2:return this.buffer.readUInt16BE(readIndex);case 4:return this.buffer.readUInt32BE(readIndex);default:throw this._index-=bytes_count,new Error("Cannot read a uint of size "+bytes_count)}},BytesArray.prototype.get_int=function(bytes_count){var bytes_to_set=32-bytes_count*8;return this.get_uint(bytes_count)<<bytes_to_set>>bytes_to_set},BytesArray.prototype.read=function(bytes_count){var rv=[];for(var i=this.start+this._index;i<this.start+this._index+bytes_count;i++)rv.push(this.buffer.readUInt8(i));return this._index+=bytes_count,rv},BytesArray.prototype.peek=function(){return this.buffer.readUInt8(this.start+this._index)},BytesArray.prototype.size=function(){return this.end-this.start-this._index},BytesArray.prototype.splice=function(len){var arr=new BytesArray(this.buffer,this.start+this._index,this.start+this._index+len);return this._index+=len,arr},BytesArray.prototype.slice=function(len){var rv=this.buffer.slice(this.start+this._index,this.start+this._index+len);return this._index+=len,rv},BytesArray}();exports.BytesArray=BytesArray,exports.initial_value=initial_value,exports.is_string=is_string,exports.ext_classname=ext_classname,exports.int_classname=int_classname,exports.verify_int_classname=verify_int_classname,exports.internal2external={B:"byte",C:"char",D:"double",F:"float",I:"int",J:"long",S:"short",V:"void",Z:"boolean"},exports.external2internal={};for(var k in exports.internal2external)exports.external2internal[exports.internal2external[k]]=k;exports.get_component_type=get_component_type,exports.is_array_type=is_array_type,exports.is_primitive_type=is_primitive_type,exports.is_reference_type=is_reference_type,exports.descriptor2typestr=descriptor2typestr,exports.carr2descriptor=carr2descriptor,exports.typestr2descriptor=typestr2descriptor,exports.bytes2str=bytes2str,exports.last=last;var SafeMap=function(){function SafeMap(){this.cache=Object.create(null)}return SafeMap.prototype.get=function(key){return this.cache[key]!=null?this.cache[key]:key=="__proto__"&&this.proto_cache!==undefined?this.proto_cache:undefined},SafeMap.prototype.has=function(key){return this.get(key)!==void 0},SafeMap.prototype.set=function(key,value){key!="__proto__"?this.cache[key]=value:this.proto_cache=value},SafeMap}();exports.SafeMap=SafeMap}),define("src/logging",["require","exports","./gLong"],function(require,exports,__gLong__){function debug_var(e){return e===null?"!":e===void 0?"undef":e.ref!=null?"*"+e.ref:e instanceof gLong?e+"L":e}function debug_vars(arr){return arr.map(debug_var)}function log(level,msgs){if(level<=exports.log_level){var msg=msgs.join(" ");level==1?console.error(msg):console.log(msg)}}function vtrace(){var msgs=[];for(var _i=0;_i<arguments.length-0;_i++)msgs[_i]=arguments[_i+0];log(exports.VTRACE,msgs)}function trace(){var msgs=[];for(var _i=0;_i<arguments.length-0;_i++)msgs[_i]=arguments[_i+0];log(exports.TRACE,msgs)}function debug(){var msgs=[];for(var _i=0;_i<arguments.length-0;_i++)msgs[_i]=arguments[_i+0];log(exports.DEBUG,msgs)}function error(){var msgs=[];for(var _i=0;_i<arguments.length-0;_i++)msgs[_i]=arguments[_i+0];log(exports.ERROR,msgs)}var gLong=__gLong__;exports.debug_vars=debug_vars,exports.VTRACE=10,exports.TRACE=9,exports.DEBUG=5,exports.ERROR=1,exports.log_level=exports.ERROR,exports.vtrace=vtrace,exports.trace=trace,exports.debug=debug,exports.error=error}),function(){var root=this,previousUnderscore=root._,breaker={},ArrayProto=Array.prototype,ObjProto=Object.prototype,FuncProto=Function.prototype,push=ArrayProto.push,slice=ArrayProto.slice,concat=ArrayProto.concat,toString=ObjProto.toString,hasOwnProperty=ObjProto.hasOwnProperty,nativeForEach=ArrayProto.forEach,nativeMap=ArrayProto.map,nativeReduce=ArrayProto.reduce,nativeReduceRight=ArrayProto.reduceRight,nativeFilter=ArrayProto.filter,nativeEvery=ArrayProto.every,nativeSome=ArrayProto.some,nativeIndexOf=ArrayProto.indexOf,nativeLastIndexOf=ArrayProto.lastIndexOf,nativeIsArray=Array.isArray,nativeKeys=Object.keys,nativeBind=FuncProto.bind,_=function(obj){if(obj instanceof _)return obj;if(!(this instanceof _))return new _(obj);this._wrapped=obj};typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=_),exports._=_):root._=_,_.VERSION="1.5.2";var each=_.each=_.forEach=function(obj,iterator,context){if(obj==null)return;if(nativeForEach&&obj.forEach===nativeForEach)obj.forEach(iterator,context);else if(obj.length===+obj.length){for(var i=0,length=obj.length;i<length;i++)if(iterator.call(context,obj[i],i,obj)===breaker)return}else{var keys=_.keys(obj);for(var i=0,length=keys.length;i<length;i++)if(iterator.call(context,obj[keys[i]],keys[i],obj)===breaker)return}};_.map=_.collect=function(obj,iterator,context){var results=[];return obj==null?results:nativeMap&&obj.map===nativeMap?obj.map(iterator,context):(each(obj,function(value,index,list){results.push(iterator.call(context,value,index,list))}),results)};var reduceError="Reduce of empty array with no initial value";_.reduce=_.foldl=_.inject=function(obj,iterator,memo,context){var initial=arguments.length>2;obj==null&&(obj=[]);if(nativeReduce&&obj.reduce===nativeReduce)return context&&(iterator=_.bind(iterator,context)),initial?obj.reduce(iterator,memo):obj.reduce(iterator);each(obj,function(value,index,list){initial?memo=iterator.call(context,memo,value,index,list):(memo=value,initial=!0)});if(!initial)throw new TypeError(reduceError);return memo},_.reduceRight=_.foldr=function(obj,iterator,memo,context){var initial=arguments.length>2;obj==null&&(obj=[]);if(nativeReduceRight&&obj.reduceRight===nativeReduceRight)return context&&(iterator=_.bind(iterator,context)),initial?obj.reduceRight(iterator,memo):obj.reduceRight(iterator);var length=obj.length;if(length!==+length){var keys=_.keys(obj);length=keys.length}each(obj,function(value,index,list){index=keys?keys[--length]:--length,initial?memo=iterator.call(context,memo,obj[index],index,list):(memo=obj[index],initial=!0)});if(!initial)throw new TypeError(reduceError);return memo},_.find=_.detect=function(obj,iterator,context){var result;return any(obj,function(value,index,list){if(iterator.call(context,value,index,list))return result=value,!0}),result},_.filter=_.select=function(obj,iterator,context){var results=[];return obj==null?results:nativeFilter&&obj.filter===nativeFilter?obj.filter(iterator,context):(each(obj,function(value,index,list){iterator.call(context,value,index,list)&&results.push(value)}),results)},_.reject=function(obj,iterator,context){return _.filter(obj,function(value,index,list){return!iterator.call(context,value,index,list)},context)},_.every=_.all=function(obj,iterator,context){iterator||(iterator=_.identity);var result=!0;return obj==null?result:nativeEvery&&obj.every===nativeEvery?obj.every(iterator,context):(each(obj,function(value,index,list){if(!(result=result&&iterator.call(context,value,index,list)))return breaker}),!!result)};var any=_.some=_.any=function(obj,iterator,context){iterator||(iterator=_.identity);var result=!1;return obj==null?result:nativeSome&&obj.some===nativeSome?obj.some(iterator,context):(each(obj,function(value,index,list){if(result||(result=iterator.call(context,value,index,list)))return breaker}),!!result)};_.contains=_.include=function(obj,target){return obj==null?!1:nativeIndexOf&&obj.indexOf===nativeIndexOf?obj.indexOf(target)!=-1:any(obj,function(value){return value===target})},_.invoke=function(obj,method){var args=slice.call(arguments,2),isFunc=_.isFunction(method);return _.map(obj,function(value){return(isFunc?method:value[method]).apply(value,args)})},_.pluck=function(obj,key){return _.map(obj,function(value){return value[key]})},_.where=function(obj,attrs,first){return _.isEmpty(attrs)?first?void 0:[]:_[first?"find":"filter"](obj,function(value){for(var key in attrs)if(attrs[key]!==value[key])return!1;return!0})},_.findWhere=function(obj,attrs){return _.where(obj,attrs,!0)},_.max=function(obj,iterator,context){if(!iterator&&_.isArray(obj)&&obj[0]===+obj[0]&&obj.length<65535)return Math.max.apply(Math,obj);if(!iterator&&_.isEmpty(obj))return-Infinity;var result={computed:-Infinity,value:-Infinity};return each(obj,function(value,index,list){var computed=iterator?iterator.call(context,value,index,list):value;computed>result.computed&&(result={value:value,computed:computed})}),result.value},_.min=function(obj,iterator,context){if(!iterator&&_.isArray(obj)&&obj[0]===+obj[0]&&obj.length<65535)return Math.min.apply(Math,obj);if(!iterator&&_.isEmpty(obj))return Infinity;var result={computed:Infinity,value:Infinity};return each(obj,function(value,index,list){var computed=iterator?iterator.call(context,value,index,list):value;computed<result.computed&&(result={value:value,computed:computed})}),result.value},_.shuffle=function(obj){var rand,index=0,shuffled=[];return each(obj,function(value){rand=_.random(index++),shuffled[index-1]=shuffled[rand],shuffled[rand]=value}),shuffled},_.sample=function(obj,n,guard){return arguments.length<2||guard?obj[_.random(obj.length-1)]:_.shuffle(obj).slice(0,Math.max(0,n))};var lookupIterator=function(value){return _.isFunction(value)?value:function(obj){return obj[value]}};_.sortBy=function(obj,value,context){var iterator=lookupIterator(value);return _.pluck(_.map(obj,function(value,index,list){return{value:value,index:index,criteria:iterator.call(context,value,index,list)}}).sort(function(left,right){var a=left.criteria,b=right.criteria;if(a!==b){if(a>b||a===void 0)return 1;if(a<b||b===void 0)return-1}return left.index-right.index}),"value")};var group=function(behavior){return function(obj,value,context){var result={},iterator=value==null?_.identity:lookupIterator(value);return each(obj,function(value,index){var key=iterator.call(context,value,index,obj);behavior(result,key,value)}),result}};_.groupBy=group(function(result,key,value){(_.has(result,key)?result[key]:result[key]=[]).push(value)}),_.indexBy=group(function(result,key,value){result[key]=value}),_.countBy=group(function(result,key){_.has(result,key)?result[key]++:result[key]=1}),_.sortedIndex=function(array,obj,iterator,context){iterator=iterator==null?_.identity:lookupIterator(iterator);var value=iterator.call(context,obj),low=0,high=array.length;while(low<high){var mid=low+high>>>1;iterator.call(context,array[mid])<value?low=mid+1:high=mid}return low},_.toArray=function(obj){return obj?_.isArray(obj)?slice.call(obj):obj.length===+obj.length?_.map(obj,_.identity):_.values(obj):[]},_.size=function(obj){return obj==null?0:obj.length===+obj.length?obj.length:_.keys(obj).length},_.first=_.head=_.take=function(array,n,guard){return array==null?void 0:n==null||guard?array[0]:slice.call(array,0,n)},_.initial=function(array,n,guard){return slice.call(array,0,array.length-(n==null||guard?1:n))},_.last=function(array,n,guard){return array==null?void 0:n==null||guard?array[array.length-1]:slice.call(array,Math.max(array.length-n,0))},_.rest=_.tail=_.drop=function(array,n,guard){return slice.call(array,n==null||guard?1:n)},_.compact=function(array){return _.filter(array,_.identity)};var flatten=function(input,shallow,output){return shallow&&_.every(input,_.isArray)?concat.apply(output,input):(each(input,function(value){_.isArray(value)||_.isArguments(value)?shallow?push.apply(output,value):flatten(value,shallow,output):output.push(value)}),output)};_.flatten=function(array,shallow){return flatten(array,shallow,[])},_.without=function(array){return _.difference(array,slice.call(arguments,1))},_.uniq=_.unique=function(array,isSorted,iterator,context){_.isFunction(isSorted)&&(context=iterator,iterator=isSorted,isSorted=!1);var initial=iterator?_.map(array,iterator,context):array,results=[],seen=[];return each(initial,function(value,index){if(isSorted?!index||seen[seen.length-1]!==value:!_.contains(seen,value))seen.push(value),results.push(array[index])}),results},_.union=function(){return _.uniq(_.flatten(arguments,!0))},_.intersection=function(array){var rest=slice.call(arguments,1);return _.filter(_.uniq(array),function(item){return _.every(rest,function(other){return _.indexOf(other,item)>=0})})},_.difference=function(array){var rest=concat.apply(ArrayProto,slice.call(arguments,1));return _.filter(array,function(value){return!_.contains(rest,value)})},_.zip=function(){var length=_.max(_.pluck(arguments,"length").concat(0)),results=new Array(length);for(var i=0;i<length;i++)results[i]=_.pluck(arguments,""+i);return results},_.object=function(list,values){if(list==null)return{};var result={};for(var i=0,length=list.length;i<length;i++)values?result[list[i]]=values[i]:result[list[i][0]]=list[i][1];return result},_.indexOf=function(array,item,isSorted){if(array==null)return-1;var i=0,length=array.length;if(isSorted){if(typeof isSorted!="number")return i=_.sortedIndex(array,item),array[i]===item?i:-1;i=isSorted<0?Math.max(0,length+isSorted):isSorted}if(nativeIndexOf&&array.indexOf===nativeIndexOf)return array.indexOf(item,isSorted);for(;i<length;i++)if(array[i]===item)return i;return-1},_.lastIndexOf=function(array,item,from){if(array==null)return-1;var hasIndex=from!=null;if(nativeLastIndexOf&&array.lastIndexOf===nativeLastIndexOf)return hasIndex?array.lastIndexOf(item,from):array.lastIndexOf(item);var i=hasIndex?from:array.length;while(i--)if(array[i]===item)return i;return-1},_.range=function(start,stop,step){arguments.length<=1&&(stop=start||0,start=0),step=arguments[2]||1;var length=Math.max(Math.ceil((stop-start)/step),0),idx=0,range=new Array(length);while(idx<length)range[idx++]=start,start+=step;return range};var ctor=function(){};_.bind=function(func,context){var args,bound;if(nativeBind&&func.bind===nativeBind)return nativeBind.apply(func,slice.call(arguments,1));if(!_.isFunction(func))throw new TypeError;return args=slice.call(arguments,2),bound=function(){if(this instanceof bound){ctor.prototype=func.prototype;var self=new ctor;ctor.prototype=null;var result=func.apply(self,args.concat(slice.call(arguments)));return Object(result)===result?result:self}return func.apply(context,args.concat(slice.call(arguments)))}},_.partial=function(func){var args=slice.call(arguments,1);return function(){return func.apply(this,args.concat(slice.call(arguments)))}},_.bindAll=function(obj){var funcs=slice.call(arguments,1);if(funcs.length===0)throw new Error("bindAll must be passed function names");return each(funcs,function(f){obj[f]=_.bind(obj[f],obj)}),obj},_.memoize=function(func,hasher){var memo={};return hasher||(hasher=_.identity),function(){var key=hasher.apply(this,arguments);return _.has(memo,key)?memo[key]:memo[key]=func.apply(this,arguments)}},_.delay=function(func,wait){var args=slice.call(arguments,2);return setTimeout(function(){return func.apply(null,args)},wait)},_.defer=function(func){return _.delay.apply(_,[func,1].concat(slice.call(arguments,1)))},_.throttle=function(func,wait,options){var context,args,result,timeout=null,previous=0;options||(options={});var later=function(){previous=options.leading===!1?0:new Date,timeout=null,result=func.apply(context,args)};return function(){var now=new Date;!previous&&options.leading===!1&&(previous=now);var remaining=wait-(now-previous);return context=this,args=arguments,remaining<=0?(clearTimeout(timeout),timeout=null,previous=now,result=func.apply(context,args)):!timeout&&options.trailing!==!1&&(timeout=setTimeout(later,remaining)),result}},_.debounce=function(func,wait,immediate){var timeout,args,context,timestamp,result;return function(){context=this,args=arguments,timestamp=new Date;var later=function(){var last=new Date-timestamp;last<wait?timeout=setTimeout(later,wait-last):(timeout=null,immediate||(result=func.apply(context,args)))},callNow=immediate&&!timeout;return timeout||(timeout=setTimeout(later,wait)),callNow&&(result=func.apply(context,args)),result}},_.once=function(func){var ran=!1,memo;return function(){return ran?memo:(ran=!0,memo=func.apply(this,arguments),func=null,memo)}},_.wrap=function(func,wrapper){return function(){var args=[func];return push.apply(args,arguments),wrapper.apply(this,args)}},_.compose=function(){var funcs=arguments;return function(){var args=arguments;for(var i=funcs.length-1;i>=0;i--)args=[funcs[i].apply(this,args)];return args[0]}},_.after=function(times,func){return function(){if(--times<1)return func.apply(this,arguments)}},_.keys=nativeKeys||function(obj){if(obj!==Object(obj))throw new TypeError("Invalid object");var keys=[];for(var key in obj)_.has(obj,key)&&keys.push(key);return keys},_.values=function(obj){var keys=_.keys(obj),length=keys.length,values=new Array(length);for(var i=0;i<length;i++)values[i]=obj[keys[i]];return values},_.pairs=function(obj){var keys=_.keys(obj),length=keys.length,pairs=new Array(length);for(var i=0;i<length;i++)pairs[i]=[keys[i],obj[keys[i]]];return pairs},_.invert=function(obj){var result={},keys=_.keys(obj);for(var i=0,length=keys.length;i<length;i++)result[obj[keys[i]]]=keys[i];return result},_.functions=_.methods=function(obj){var names=[];for(var key in obj)_.isFunction(obj[key])&&names.push(key);return names.sort()},_.extend=function(obj){return each(slice.call(arguments,1),function(source){if(source)for(var prop in source)obj[prop]=source[prop]}),obj},_.pick=function(obj){var copy={},keys=concat.apply(ArrayProto,slice.call(arguments,1));return each(keys,function(key){key in obj&&(copy[key]=obj[key])}),copy},_.omit=function(obj){var copy={},keys=concat.apply(ArrayProto,slice.call(arguments,1));for(var key in obj)_.contains(keys,key)||(copy[key]=obj[key]);return copy},_.defaults=function(obj){return each(slice.call(arguments,1),function(source){if(source)for(var prop in source)obj[prop]===void 0&&(obj[prop]=source[prop])}),obj},_.clone=function(obj){return _.isObject(obj)?_.isArray(obj)?obj.slice():_.extend({},obj):obj},_.tap=function(obj,interceptor){return interceptor(obj),obj};var eq=function(a,b,aStack,bStack){if(a===b)return a!==0||1/a==1/b;if(a==null||b==null)return a===b;a instanceof _&&(a=a._wrapped),b instanceof _&&(b=b._wrapped);var className=toString.call(a);if(className!=toString.call(b))return!1;switch(className){case"[object String]":return a==String(b);case"[object Number]":return a!=+a?b!=+b:a==0?1/a==1/b:a==+b;case"[object Date]":case"[object Boolean]":return+a==+b;case"[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if(typeof a!="object"||typeof b!="object")return!1;var length=aStack.length;while(length--)if(aStack[length]==a)return bStack[length]==b;var aCtor=a.constructor,bCtor=b.constructor;if(aCtor!==bCtor&&!(_.isFunction(aCtor)&&aCtor instanceof aCtor&&_.isFunction(bCtor)&&bCtor instanceof bCtor))return!1;aStack.push(a),bStack.push(b);var size=0,result=!0;if(className=="[object Array]"){size=a.length,result=size==b.length;if(result)while(size--)if(!(result=eq(a[size],b[size],aStack,bStack)))break}else{for(var key in a)if(_.has(a,key)){size++;if(!(result=_.has(b,key)&&eq(a[key],b[key],aStack,bStack)))break}if(result){for(key in b)if(_.has(b,key)&&!(size--))break;result=!size}}return aStack.pop(),bStack.pop(),result};_.isEqual=function(a,b){return eq(a,b,[],[])},_.isEmpty=function(obj){if(obj==null)return!0;if(_.isArray(obj)||_.isString(obj))return obj.length===0;for(var key in obj)if(_.has(obj,key))return!1;return!0},_.isElement=function(obj){return!!obj&&obj.nodeType===1},_.isArray=nativeIsArray||function(obj){return toString.call(obj)=="[object Array]"},_.isObject=function(obj){return obj===Object(obj)},each(["Arguments","Function","String","Number","Date","RegExp"],function(name){_["is"+name]=function(obj){return toString.call(obj)=="[object "+name+"]"}}),_.isArguments(arguments)||(_.isArguments=function(obj){return!!obj&&!!_.has(obj,"callee")}),typeof /./!="function"&&(_.isFunction=function(obj){return typeof obj=="function"}),_.isFinite=function(obj){return isFinite(obj)&&!isNaN(parseFloat(obj))},_.isNaN=function(obj){return _.isNumber(obj)&&obj!=+obj},_.isBoolean=function(obj){return obj===!0||obj===!1||toString.call(obj)=="[object Boolean]"},_.isNull=function(obj){return obj===null},_.isUndefined=function(obj){return obj===void 0},_.has=function(obj,key){return hasOwnProperty.call(obj,key)},_.noConflict=function(){return root._=previousUnderscore,this},_.identity=function(value){return value},_.times=function(n,iterator,context){var accum=Array(Math.max(0,n));for(var i=0;i<n;i++)accum[i]=iterator.call(context,i);return accum},_.random=function(min,max){return max==null&&(max=min,min=0),min+Math.floor(Math.random()*(max-min+1))};var entityMap={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};entityMap.unescape=_.invert(entityMap.escape);var entityRegexes={escape:new RegExp("["+_.keys(entityMap.escape).join("")+"]","g"),unescape:new RegExp("("+_.keys(entityMap.unescape).join("|")+")","g")};_.each(["escape","unescape"],function(method){_[method]=function(string){return string==null?"":(""+string).replace(entityRegexes[method],function(match){return entityMap[method][match]})}}),_.result=function(object,property){if(object==null)return void 0;var value=object[property];return _.isFunction(value)?value.call(object):value},_.mixin=function(obj){each(_.functions(obj),function(name){var func=_[name]=obj[name];_.prototype[name]=function(){var args=[this._wrapped];return push.apply(args,arguments),result.call(this,func.apply(_,args))}})};var idCounter=0;_.uniqueId=function(prefix){var id=++idCounter+"";return prefix?prefix+id:id},_.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var noMatch=/(.)^/,escapes={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},escaper=/\\|'|\r|\n|\t|\u2028|\u2029/g;_.template=function(text,data,settings){var render;settings=_.defaults({},settings,_.templateSettings);var matcher=new RegExp([(settings.escape||noMatch).source,(settings.interpolate||noMatch).source,(settings.evaluate||noMatch).source].join("|")+"|$","g"),index=0,source="__p+='";text.replace(matcher,function(match,escape,interpolate,evaluate,offset){return source+=text.slice(index,offset).replace(escaper,function(match){return"\\"+escapes[match]}),escape&&(source+="'+\n((__t=("+escape+"))==null?'':_.escape(__t))+\n'"),interpolate&&(source+="'+\n((__t=("+interpolate+"))==null?'':__t)+\n'"),evaluate&&(source+="';\n"+evaluate+"\n__p+='"),index=offset+match.length,match}),source+="';\n",settings.variable||(source="with(obj||{}){\n"+source+"}\n"),source="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+source+"return __p;\n";try{render=new Function(settings.variable||"obj","_",source)}catch(e){throw e.source=source,e}if(data)return render(data,_);var template=function(data){return render.call(this,data,_)};return template.source="function("+(settings.variable||"obj")+"){\n"+source+"}",template},_.chain=function(obj){return _(obj).chain()};var result=function(obj){return this._chain?_(obj).chain():obj};_.mixin(_),each(["pop","push","reverse","shift","sort","splice","unshift"],function(name){var method=ArrayProto[name];_.prototype[name]=function(){var obj=this._wrapped;return method.apply(obj,arguments),(name=="shift"||name=="splice")&&obj.length===0&&delete obj[0],result.call(this,obj)}}),each(["concat","join","slice"],function(name){var method=ArrayProto[name];_.prototype[name]=function(){return result.call(this,method.apply(this._wrapped,arguments))}}),_.extend(_.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}.call(this),define("vendor/underscore/underscore",function(global){return function(){var ret,fn;return ret||global._}}(this));var __extends=this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);__.prototype=b.prototype,d.prototype=new __};define("src/exceptions",["require","exports","./logging","../vendor/underscore/underscore"],function(require,exports,__logging__){var underscore=require("../vendor/underscore/underscore"),logging=__logging__,debug=logging.debug,HaltException=function(){function HaltException(exit_code){this.exit_code=exit_code}return HaltException.prototype.toplevel_catch_handler=function(){if(this.exit_code!==0)return logging.error("\nExited with code "+this.exit_code)},HaltException}();exports.HaltException=HaltException,exports.ReturnException="RETURNEXCEPTION";var YieldException=function(){function YieldException(condition){this.condition=condition}return YieldException}();exports.YieldException=YieldException;var YieldIOException=function(_super){function YieldIOException(){_super.apply(this,arguments)}return __extends(YieldIOException,_super),YieldIOException}(YieldException);exports.YieldIOException=YieldIOException;var JavaException=function(){function JavaException(exception){this.exception=exception}return JavaException.prototype.method_catch_handler=function(rs,cf,top_of_stack){var _this=this,method=cf.method;if(!top_of_stack&&method.has_bytecode){cf.pc-=3;var op;while(!(cf.pc<=0||(op=method.code.opcodes[cf.pc])!=null&&op.name.match(/^invoke/)))--cf.pc}if(cf["native"])return cf.error!=null?(cf.runner=function(){return cf.error(_this)},!0):!1;var exception_handlers=method.code.exception_handlers,ecls=this.exception.cls,handler=underscore.find(exception_handlers,function(eh){return eh.start_pc<=cf.pc&&cf.pc<eh.end_pc&&method.cls.loader.get_resolved_class(eh.catch_type,true)!=null&&(eh.catch_type==="<any>"||ecls.is_castable(method.cls.loader.get_resolved_class(eh.catch_type)))});return handler!=null?(debug("caught "+this.exception.cls.get_type()+" in "+method.full_signature()+" as subclass of "+handler.catch_type),cf.stack=[this.exception],cf.pc=handler.handler_pc,!0):(debug("exception not caught, terminating "+method.full_signature()),!1)},JavaException.prototype.toplevel_catch_handler=function(rs){debug("\nUncaught "+this.exception.cls.get_type());var msg=this.exception.get_field(rs,"Ljava/lang/Throwable;detailMessage");msg!=null&&debug("	"+msg.jvm2js_str()),rs.push2(rs.curr_thread,this.exception);var thread_cls=rs.get_bs_class("Ljava/lang/Thread;"),dispatch_method=thread_cls.method_lookup(rs,"dispatchUncaughtException(Ljava/lang/Throwable;)V");dispatch_method.setup_stack(rs)},JavaException}();exports.JavaException=JavaException}),define("src/enums",["require","exports"],function(require,exports){(function(ClassState){ClassState[ClassState.LOADED=0]="LOADED",ClassState[ClassState.RESOLVED=1]="RESOLVED",ClassState[ClassState.INITIALIZED=2]="INITIALIZED"})(exports.ClassState||(exports.ClassState={}));var ClassState=exports.ClassState});var __extends=this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);__.prototype=b.prototype,d.prototype=new __};define("src/java_object",["require","exports","./gLong","./util","./enums","../vendor/underscore/underscore"],function(require,exports,__gLong__,__util__,__enums__){var underscore=require("../vendor/underscore/underscore"),gLong=__gLong__,util=__util__,enums=__enums__,ClassState=enums.ClassState,JavaArray=function(){function JavaArray(rs,cls,obj){this.cls=cls,this.ref=rs.high_oref++,this.array=obj}return JavaArray.prototype.clone=function(rs){return new JavaArray(rs,this.cls,underscore.clone(this.array))},JavaArray.prototype.get_field_from_offset=function(rs,offset){return this.array[offset.toInt()]},JavaArray.prototype.set_field_from_offset=function(rs,offset,value){this.array[offset.toInt()]=value},JavaArray.prototype.toString=function(){return this.array.length<=10?"<"+this.cls.get_type()+" ["+this.array+"] (*"+this.ref+")>":"<"+this.cls.get_type()+" of length "+this.array.length+" (*"+this.ref+")>"},JavaArray.prototype.serialize=function(visited){function elem_serializer(f){return f?typeof f.serialize!="function"?f:f.serialize(visited):f}return visited[this.ref]?"<*"+this.ref+">":(visited[this.ref]=!0,{type:this.cls.get_type(),ref:this.ref,array:this.array.map(elem_serializer)})},JavaArray}();exports.JavaArray=JavaArray;var JavaObject=function(){function JavaObject(rs,cls,obj){this.cls=cls,obj==null&&(obj={}),this.ref=rs.high_oref++,this.fields=Object.create(this.cls.get_default_fields());for(var field in obj)obj.hasOwnProperty(field)&&(this.fields[field]=obj[field])}return JavaObject.prototype.clone=function(rs){return new JavaObject(rs,this.cls,underscore.clone(this.fields))},JavaObject.prototype.set_field=function(rs,name,val){this.fields[name]!==undefined?this.fields[name]=val:rs.java_throw(this.cls.loader.get_initialized_class("Ljava/lang/NoSuchFieldError;"),"Cannot set field "+name+" on class "+this.cls.get_type())},JavaObject.prototype.get_field=function(rs,name){return this.fields[name]!==undefined?this.fields[name]:rs.java_throw(this.cls.loader.get_initialized_class("Ljava/lang/NoSuchFieldError;"),"Cannot get field "+name+" from class "+this.cls.get_type())},JavaObject.prototype.get_field_from_offset=function(rs,offset){var f=this._get_field_from_offset(rs,this.cls,offset.toInt());return f.field.access_flags["static"]?f.cls_obj.static_get(rs,f.field.name):this.get_field(rs,f.cls+f.field.name)},JavaObject.prototype._get_field_from_offset=function(rs,cls,offset){var classname=cls.get_type();while(cls!=null){var jco_ref=cls.get_class_object(rs).ref,f=cls.get_fields()[offset-jco_ref];if(f!=null)return{field:f,cls:cls.get_type(),cls_obj:cls};cls=cls.get_super_class()}return rs.java_throw(this.cls.loader.get_initialized_class("Ljava/lang/NullPointerException;"),"field "+offset+" doesn't exist in class "+classname)},JavaObject.prototype.set_field_from_offset=function(rs,offset,value){var f=this._get_field_from_offset(rs,this.cls,offset.toInt());f.field.access_flags["static"]?f.cls_obj.static_put(rs,f.field.name,value):this.set_field(rs,f.cls+f.field.name,value)},JavaObject.prototype.toString=function(){return this.cls.get_type()==="Ljava/lang/String;"?"<"+this.cls.get_type()+" '"+this.jvm2js_str()+"' (*"+this.ref+")>":"<"+this.cls.get_type()+" (*"+this.ref+")>"},JavaObject.prototype.serialize=function(visited){if(this.ref in visited)return"<*"+this.ref+">";visited[this.ref]=!0;var fields={},_ref2=this.fields;for(var k in this.fields){var field=this.fields[k];field&&field.serialize?fields[k]=field.serialize(visited):fields[k]=field}return{type:this.cls.get_type(),ref:this.ref,fields:fields}},JavaObject.prototype.jvm2js_str=function(){return util.chars2js_str(this.fields["Ljava/lang/String;value"],this.fields["Ljava/lang/String;offset"],this.fields["Ljava/lang/String;count"])},JavaObject}();exports.JavaObject=JavaObject;var JavaClassObject=function(_super){function JavaClassObject(rs,$cls){_super.call(this,rs,rs.get_bs_cl().get_resolved_class("Ljava/lang/Class;")),this.$cls=$cls}return __extends(JavaClassObject,_super),JavaClassObject.prototype.toString=function(){return"<Class "+this.$cls.get_type()+" (*"+this.ref+")>"},JavaClassObject}(JavaObject);exports.JavaClassObject=JavaClassObject;var JavaClassLoaderObject=function(_super){function JavaClassLoaderObject(rs,cls){_super.call(this,rs,cls),this.$loader=rs.construct_cl(this)}return __extends(JavaClassLoaderObject,_super),JavaClassLoaderObject.prototype.serialize=function(visited){if(visited[this.ref])return"<*"+this.ref+">";visited[this.ref]=!0;var fields={};for(var k in this.fields){var f=this.fields[k];!f||typeof f.serialize!="function"?fields[k]=f:fields[k]=f.serialize(visited)}var loaded={};for(var type in this.$loader.loaded_classes){var vcls=this.$loader.loaded_classes[type];loaded[type+"("+ClassState[vcls.get_state()]+")"]=vcls.loader.serialize(visited)}return{type:this.cls.get_type(),ref:this.ref,fields:fields,loaded:loaded}},JavaClassLoaderObject}(JavaObject);exports.JavaClassLoaderObject=JavaClassLoaderObject});var __extends=this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);__.prototype=b.prototype,d.prototype=new __};define("src/ConstantPool",["require","exports","./gLong","./util"],function(require,exports,__gLong__,__util__){var gLong=__gLong__,util=__util__,SimpleReference=function(){function SimpleReference(constant_pool,value){this.constant_pool=constant_pool,this.value=value}return SimpleReference.from_bytes=function(bytes_array,constant_pool){var value=bytes_array.get_uint(2);return new this(constant_pool,value)},SimpleReference.prototype.deref=function(){var pool_obj=this.constant_pool[this.value];return(typeof pool_obj.deref=="function"?pool_obj.deref():void 0)||pool_obj.value},SimpleReference.size=1,SimpleReference}();exports.SimpleReference=SimpleReference;var ClassReference=function(_super){function ClassReference(){_super.apply(this,arguments),this.type="class"}return __extends(ClassReference,_super),ClassReference.prototype.deref=function(){var pool_obj=this.constant_pool[this.value];return typeof pool_obj.deref=="function"?pool_obj.deref():util.typestr2descriptor(pool_obj.value)},ClassReference}(SimpleReference);exports.ClassReference=ClassReference;var StringReference=function(_super){function StringReference(constant_pool,value){_super.call(this,constant_pool,value),this.type="String"}return __extends(StringReference,_super),StringReference}(SimpleReference);exports.StringReference=StringReference;var AbstractMethodFieldReference=function(){function AbstractMethodFieldReference(constant_pool,value){this.constant_pool=constant_pool,this.value=value}return AbstractMethodFieldReference.from_bytes=function(bytes_array,constant_pool){var class_ref=ClassReference.from_bytes(bytes_array,constant_pool),sig=SimpleReference.from_bytes(bytes_array,constant_pool);return new this(constant_pool,{class_ref:class_ref,sig:sig})},AbstractMethodFieldReference.prototype.deref=function(){var sig=this.value.sig.deref();return{class_desc:this.value.class_ref.deref(),sig:sig.name+sig.type}},AbstractMethodFieldReference.size=1,AbstractMethodFieldReference}();exports.AbstractMethodFieldReference=AbstractMethodFieldReference;var MethodReference=function(_super){function MethodReference(){_super.apply(this,arguments),this.type="Method"}return __extends(MethodReference,_super),MethodReference}(AbstractMethodFieldReference);exports.MethodReference=MethodReference;var InterfaceMethodReference=function(_super){function InterfaceMethodReference(){_super.apply(this,arguments),this.type="InterfaceMethod"}return __extends(InterfaceMethodReference,_super),InterfaceMethodReference}(AbstractMethodFieldReference);exports.InterfaceMethodReference=InterfaceMethodReference;var FieldReference=function(_super){function FieldReference(){_super.apply(this,arguments),this.type="Field"}return __extends(FieldReference,_super),FieldReference.prototype.deref=function(){var sig=this.value.sig.deref();return{class_desc:this.value.class_ref.deref(),name:sig.name,type:sig.type}},FieldReference}(AbstractMethodFieldReference);exports.FieldReference=FieldReference;var MethodSignature=function(){function MethodSignature(constant_pool,value){this.type="NameAndType",this.constant_pool=constant_pool,this.value=value}return MethodSignature.from_bytes=function(bytes_array,constant_pool){var meth_ref=StringReference.from_bytes(bytes_array,constant_pool),type_ref=StringReference.from_bytes(bytes_array,constant_pool);return new this(constant_pool,{meth_ref:meth_ref,type_ref:type_ref})},MethodSignature.prototype.deref=function(){return{name:this.value.meth_ref.deref(),type:this.value.type_ref.deref()}},MethodSignature.size=1,MethodSignature}();exports.MethodSignature=MethodSignature;var ConstString=function(){function ConstString(value){this.type="Asciz",this.value=value}return ConstString.from_bytes=function(bytes_array){var strlen=bytes_array.get_uint(2),value=util.bytes2str(bytes_array.read(strlen));return new this(value)},ConstString.size=1,ConstString}();exports.ConstString=ConstString;var ConstInt32=function(){function ConstInt32(value){this.type="int",this.value=value}return ConstInt32.from_bytes=function(bytes_array){var uint32=bytes_array.get_uint(4),value=-(1+~uint32);return new this(value)},ConstInt32.size=1,ConstInt32}();exports.ConstInt32=ConstInt32;var ConstFloat=function(){function ConstFloat(value){this.type="float",this.value=value}return ConstFloat.from_bytes=function(bytes_array){var uint32=bytes_array.get_uint(4),value=util.intbits2float(uint32|0);return new this(value)},ConstFloat.size=1,ConstFloat}();exports.ConstFloat=ConstFloat;var ConstLong=function(){function ConstLong(value){this.type="long",this.value=value}return ConstLong.from_bytes=function(bytes_array){var high=bytes_array.get_uint(4),low=bytes_array.get_uint(4),value=gLong.fromBits(low,high);return new this(value)},ConstLong.size=2,ConstLong}();exports.ConstLong=ConstLong;var ConstDouble=function(){function ConstDouble(value){this.type="double",this.value=value}return ConstDouble.from_bytes=function(bytes_array){var uint32_a=bytes_array.get_uint(4),uint32_b=bytes_array.get_uint(4);return new this(util.longbits2double(uint32_a,uint32_b))},ConstDouble.size=2,ConstDouble}();exports.ConstDouble=ConstDouble;var ConstantPool=function(){function ConstantPool(){}return ConstantPool.prototype.parse=function(bytes_array){var constant_tags;constant_tags={1:ConstString,3:ConstInt32,4:ConstFloat,5:ConstLong,6:ConstDouble,7:ClassReference,8:StringReference,9:FieldReference,10:MethodReference,11:InterfaceMethodReference,12:MethodSignature},this.cp_count=bytes_array.get_uint(2),this.constant_pool={};var idx=1;while(idx<this.cp_count){var tag=bytes_array.get_uint(1);if(!(1<=tag&&tag<=12))throw"invalid tag: "+tag;var pool_obj=constant_tags[tag].from_bytes(bytes_array,this.constant_pool);this.constant_pool[idx]=pool_obj,idx+=constant_tags[tag].size}return bytes_array},ConstantPool.prototype.get=function(idx){var _ref=this.constant_pool[idx];if(_ref!=null)return _ref;throw new Error("Invalid constant_pool reference: "+idx)},ConstantPool.prototype.each=function(fn){for(var i=0;i<this.cp_count;++i)i in this.constant_pool&&fn(i,this.constant_pool[i])},ConstantPool}();exports.ConstantPool=ConstantPool});var __extends=this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);__.prototype=b.prototype,d.prototype=new __};define("src/threading",["require","exports","./util","./java_object","../vendor/underscore/underscore"],function(require,exports,__util__,__java_object__){var underscore=require("../vendor/underscore/underscore"),util=__util__,java_object=__java_object__,JavaThreadObject=function(_super){function JavaThreadObject(rs,cls,obj){cls==null?(cls={get_type:function(){return"Ljava/lang/Thread;"},loader:rs.get_bs_cl(),get_default_fields:function(){return null}},this.fake=!0):this.fake=!1,_super.call(this,rs,cls,obj),this.$isAlive=!0,this.wakeup_time=null,this.$park_count=0,this.$park_timeout=Infinity,this.$meta_stack=new CallStack}return __extends(JavaThreadObject,_super),JavaThreadObject.prototype.clone=function(rs){return new JavaThreadObject(rs,this.cls,underscore.clone(this.fields))},JavaThreadObject.prototype.name=function(rs){return util.chars2js_str(this.get_field(rs,"Ljava/lang/Thread;name"))},JavaThreadObject.prototype.dump_state=function(rs){var fs;typeof node!="undefined"&&node!==null&&node.fs!=null?fs=node.fs:fs=require("fs");var filename="./core-"+this.name(rs)+".json",data=this.$meta_stack.dump_state();fs.writeFileSync(filename,data,"utf8",!0)},JavaThreadObject}(java_object.JavaObject);exports.JavaThreadObject=JavaThreadObject;var CallStack=function(){function CallStack(initial_stack){this._cs=[StackFrame.native_frame("$bootstrap")],initial_stack!=null&&(this._cs[0].stack=initial_stack)}return CallStack.prototype.dump_state=function(){var visited={},snapshots=this._cs.map(function(frame){return frame.snap(visited)});return JSON.stringify(snapshots.map(function(ss){return ss.serialize()}))},CallStack.prototype.length=function(){return this._cs.length},CallStack.prototype.push=function(sf){return this._cs.push(sf)},CallStack.prototype.pop=function(){return this._cs.pop()},CallStack.prototype.pop_n=function(n){this._cs.length-=n},CallStack.prototype.curr_frame=function(){return util.last(this._cs)},CallStack.prototype.get_caller=function(frames_to_skip){return this._cs[this._cs.length-1-frames_to_skip]},CallStack}();exports.CallStack=CallStack;var StackFrame=function(){function StackFrame(method,locals,stack){this.method=method,this.locals=locals,this.stack=stack,this.pc=0,this.runner=null,this.native=!1,this.name=this.method.full_signature()}return StackFrame.prototype.snap=function(visited){function serializer(obj){return obj!=null&&typeof obj.serialize=="function"?obj.serialize(visited):obj}function s(){return _this.method.cls!=null&&(rv.loader=_this.method.cls.loader.serialize(visited)),rv.stack=_this.stack.map(serializer),rv.locals=_this.locals.map(serializer),rv}var _this=this,rv={name:this.name,pc:this.pc,"native":this.native,loader:null,stack:null,locals:null};return{serialize:s}},StackFrame.native_frame=function(name,handler,error_handler){var sf=new StackFrame({full_signature:function(){return name}},[],[]);return sf.runner=handler,sf.name=name,error_handler!=null&&(sf.error=error_handler),sf.native=!0,sf},StackFrame}();exports.StackFrame=StackFrame});var __extends=this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);__.prototype=b.prototype,d.prototype=new __};define("src/opcodes",["require","exports","./gLong","./util","./exceptions","./java_object","./threading"],function(require,exports,__gLong__,__util__,__exceptions__,__java_object__,__threading__){function get_param_word_size(signature){var state="name",size=0;for(var i=0;i<signature.length;i++){var c=signature[i];switch(state){case"name":c==="("&&(state="type");break;case"type":if(c===")")return size;c==="J"||c==="D"?size+=2:++size,c==="L"?state="class":c==="["&&(state="array");break;case"class":c===";"&&(state="type");break;case"array":c==="L"?state="class":c!=="["&&(state="type")}}}function monitorenter(rs,monitor,inst){monitor==null&&rs.java_throw(rs.get_bs_class("Ljava/lang/NullPointerException;"),"Cannot enter a null monitor.");var locked_thread=rs.lock_refs[monitor.ref];if(locked_thread!=null){if(locked_thread!==rs.curr_thread)return inst!=null?inst.inc_pc(rs,1):rs.inc_pc(1),rs.meta_stack().push({}),rs.wait(monitor),!1;rs.lock_counts[monitor.ref]++}else rs.lock_refs[monitor.ref]=rs.curr_thread,rs.lock_counts[monitor.ref]=1;return!0}function monitorexit(rs,monitor){var locked_thread=rs.lock_refs[monitor.ref];if(locked_thread==null)return;if(locked_thread===rs.curr_thread)rs.lock_counts[monitor.ref]--,rs.lock_counts[monitor.ref]===0&&(delete rs.lock_refs[monitor.ref],rs.waiting_threads[monitor.ref]!=null&&(rs.waiting_threads[monitor.ref]=[]));else{var err_cls=rs.get_bs_class("Ljava/lang/IllegalMonitorStateException;");rs.java_throw(err_cls,"Thread "+rs.curr_thread.name(rs)+" tried to monitorexit on lock held by thread "+locked_thread.name(rs)+".")}}var gLong=__gLong__,util=__util__,exceptions=__exceptions__,JavaException=exceptions.JavaException,ReturnException=exceptions.ReturnException,java_object=__java_object__,threading=__threading__,JavaObject=java_object.JavaObject,JavaArray=java_object.JavaArray,JavaClassLoaderObject=java_object.JavaClassLoaderObject,Opcode=function(){function Opcode(name,byte_count,execute){this.name=name,this.byte_count=byte_count||0,this.execute=execute||this._execute,this.orig_execute=this.execute}return Opcode.prototype.take_args=function(code_array,constant_pool){this.args=[];for(var i=0;i<this.byte_count;i++)this.args.push(code_array.get_uint(1))},Opcode.prototype.annotate=function(idx,pool){return""},Opcode.prototype.reset_cache=function(){this.execute!==this.orig_execute&&(this.execute=this.orig_execute)},Opcode.prototype._execute=function(rs){throw new Error("ERROR: Unimplemented opcode.")},Opcode.prototype.inc_pc=function(rs,offset){return rs.inc_pc(offset-1-this.byte_count)},Opcode.prototype.goto_pc=function(rs,new_pc){return rs.goto_pc(new_pc-1-this.byte_count)},Opcode}();exports.Opcode=Opcode;var FieldOpcode=function(_super){function FieldOpcode(name,execute){_super.call(this,name,2,execute)}return __extends(FieldOpcode,_super),FieldOpcode.prototype.take_args=function(code_array,constant_pool){this.field_spec_ref=code_array.get_uint(2),this.field_spec=constant_pool.get(this.field_spec_ref).deref()},FieldOpcode.prototype.annotate=function(idx,pool){var info=util.format_extra_info(pool.get(this.field_spec_ref));return"	#"+this.field_spec_ref+";"+info},FieldOpcode}(Opcode);exports.FieldOpcode=FieldOpcode;var ClassOpcode=function(_super){function ClassOpcode(name,execute){_super.call(this,name,2,execute)}return __extends(ClassOpcode,_super),ClassOpcode.prototype.take_args=function(code_array,constant_pool){this.class_ref=code_array.get_uint(2),this.class_desc=constant_pool.get(this.class_ref).deref()},ClassOpcode.prototype.annotate=function(idx,pool){var info=util.format_extra_info(pool.get(this.class_ref));return"	#"+this.class_ref+";"+info},ClassOpcode}(Opcode);exports.ClassOpcode=ClassOpcode;var InvokeOpcode=function(_super){function InvokeOpcode(name){_super.call(this,name,2)}return __extends(InvokeOpcode,_super),InvokeOpcode.prototype.take_args=function(code_array,constant_pool){this.method_spec_ref=code_array.get_uint(2),this.method_spec=constant_pool.get(this.method_spec_ref).deref()},InvokeOpcode.prototype.annotate=function(idx,pool){var info=util.format_extra_info(pool.get(this.method_spec_ref));return"	#"+this.method_spec_ref+";"+info},InvokeOpcode.prototype._execute=function(rs){var cls=rs.get_class(this.method_spec.class_desc,!0);if(cls!=null){var my_sf=rs.curr_frame(),m=cls.method_lookup(rs,this.method_spec.sig);if(m!=null){if(m.setup_stack(rs)!=null)return my_sf.pc+=1+this.byte_count,!1}else{var sig=this.method_spec.sig;rs.async_op(function(resume_cb,except_cb){cls.resolve_method(rs,sig,function(){return resume_cb(undefined,undefined,!0,!1)},except_cb)})}}else{var classname=this.method_spec.class_desc;rs.async_op(function(resume_cb,except_cb){rs.get_cl().initialize_class(rs,classname,function(){return resume_cb(undefined,undefined,!0,!1)},except_cb)})}},InvokeOpcode}(Opcode);exports.InvokeOpcode=InvokeOpcode;var DynInvokeOpcode=function(_super){function DynInvokeOpcode(){_super.apply(this,arguments)}return __extends(DynInvokeOpcode,_super),DynInvokeOpcode.prototype.take_args=function(code_array,constant_pool){_super.prototype.take_args.call(this,code_array,constant_pool),this.name==="invokeinterface"?(this.count=code_array.get_uint(1),code_array.skip(1),this.byte_count+=2):this.count=1+get_param_word_size(this.method_spec.sig),this.cache=Object.create(null)},DynInvokeOpcode.prototype.annotate=function(idx,pool){var info=util.format_extra_info(pool.get(this.method_spec_ref)),extra="";return this.name==="invokeinterface"&&(extra=",  "+this.count),"	#"+this.method_spec_ref+extra+";"+info},DynInvokeOpcode.prototype._execute=function(rs){var cls=rs.get_class(this.method_spec.class_desc,!0);if(cls!=null){var my_sf=rs.curr_frame(),stack=my_sf.stack,obj=stack[stack.length-this.count],cls_obj=rs.check_null(obj).cls,m=cls_obj.method_lookup(rs,this.method_spec.sig);if(m!=null){if(m.setup_stack(rs)!=null)return my_sf.pc+=1+this.byte_count,!1}else{var sig=this.method_spec.sig;rs.async_op(function(resume_cb,except_cb){cls_obj.resolve_method(rs,sig,function(){return resume_cb(undefined,undefined,!0,!1)},except_cb)})}}else{var classname=this.method_spec.class_desc;rs.async_op(function(resume_cb,except_cb){rs.get_cl().initialize_class(rs,classname,function(){return resume_cb(undefined,undefined,!0,!1)},except_cb)})}},DynInvokeOpcode}(InvokeOpcode);exports.DynInvokeOpcode=DynInvokeOpcode;var LoadConstantOpcode=function(_super){function LoadConstantOpcode(){_super.apply(this,arguments)}return __extends(LoadConstantOpcode,_super),LoadConstantOpcode.prototype.take_args=function(code_array,constant_pool){this.constant_ref=code_array.get_uint(this.byte_count),this.constant=constant_pool.get(this.constant_ref);var ctype=this.constant.type;if(ctype==="String"||ctype==="class")this.str_constant=constant_pool.get(this.constant.value)},LoadConstantOpcode.prototype.annotate=function(idx,pool){var ctype=this.constant.type,anno="	#"+this.constant_ref+";	// "+this.constant.type+" ";return ctype==="String"||ctype==="class"?anno+util.escape_whitespace(this.constant.deref()):anno+this.constant.value},LoadConstantOpcode.prototype._execute=function(rs){switch(this.constant.type){case"String":rs.push(rs.init_string(this.str_constant.value,!0));break;case"class":var cdesc=util.typestr2descriptor(this.str_constant.value);rs.async_op(function(resume_cb,except_cb){rs.get_cl().resolve_class(rs,cdesc,function(cls){return resume_cb(cls.get_class_object(rs),undefined,!0)},except_cb)});break;default:this.name==="ldc2_w"?rs.push2(this.constant.value,null):rs.push(this.constant.value)}return!0},LoadConstantOpcode}(Opcode);exports.LoadConstantOpcode=LoadConstantOpcode;var BranchOpcode=function(_super){function BranchOpcode(name,execute){_super.call(this,name,2,execute)}return __extends(BranchOpcode,_super),BranchOpcode.prototype.take_args=function(code_array,constant_pool){this.offset=code_array.get_int(this.byte_count)},BranchOpcode.prototype.annotate=function(idx,pool){return"	"+(idx+this.offset)},BranchOpcode}(Opcode);exports.BranchOpcode=BranchOpcode;var GotoOpcode=function(_super){function GotoOpcode(name,byte_count){_super.call(this,name),this.byte_count=byte_count}return __extends(GotoOpcode,_super),GotoOpcode.prototype._execute=function(rs){return this.inc_pc(rs,this.offset),!0},GotoOpcode}(BranchOpcode);exports.GotoOpcode=GotoOpcode;var JSROpcode=function(_super){function JSROpcode(){_super.apply(this,arguments)}return __extends(JSROpcode,_super),JSROpcode.prototype._execute=function(rs){return rs.push(rs.curr_pc()+this.byte_count+1),this.inc_pc(rs,this.offset),!0},JSROpcode}(GotoOpcode);exports.JSROpcode=JSROpcode;var UnaryBranchOpcode=function(_super){function UnaryBranchOpcode(name,cmp){_super.call(this,name),this.cmp=cmp}return __extends(UnaryBranchOpcode,_super),UnaryBranchOpcode.prototype._execute=function(rs){return this.cmp(rs.pop())&&this.inc_pc(rs,this.offset),!0},UnaryBranchOpcode}(BranchOpcode);exports.UnaryBranchOpcode=UnaryBranchOpcode;var BinaryBranchOpcode=function(_super){function BinaryBranchOpcode(name,cmp){_super.call(this,name),this.cmp=cmp}return __extends(BinaryBranchOpcode,_super),BinaryBranchOpcode.prototype._execute=function(rs){var v2=rs.pop(),v1=rs.pop();return this.cmp(v1,v2)&&this.inc_pc(rs,this.offset),!0},BinaryBranchOpcode}(BranchOpcode);exports.BinaryBranchOpcode=BinaryBranchOpcode;var PushOpcode=function(_super){function PushOpcode(){_super.apply(this,arguments)}return __extends(PushOpcode,_super),PushOpcode.prototype.take_args=function(code_array,constant_pool){this.value=code_array.get_int(this.byte_count)},PushOpcode.prototype.annotate=function(idx,pool){return"	"+this.value},PushOpcode.prototype._execute=function(rs){return rs.push(this.value),!0},PushOpcode}(Opcode);exports.PushOpcode=PushOpcode;var IIncOpcode=function(_super){function IIncOpcode(){_super.apply(this,arguments)}return __extends(IIncOpcode,_super),IIncOpcode.prototype.take_args=function(code_array,constant_pool,wide){var arg_size;wide?(this.name+="_w",arg_size=2,this.byte_count=5):(arg_size=1,this.byte_count=2),this.index=code_array.get_uint(arg_size),this["const"]=code_array.get_int(arg_size)},IIncOpcode.prototype.annotate=function(idx,pool){return"	"+this.index+", "+this["const"]},IIncOpcode.prototype._execute=function(rs){var v=rs.cl(this.index)+this["const"];return rs.put_cl(this.index,v|0),!0},IIncOpcode}(Opcode);exports.IIncOpcode=IIncOpcode;var LoadOpcode=function(_super){function LoadOpcode(){_super.apply(this,arguments)}return __extends(LoadOpcode,_super),LoadOpcode.prototype.take_args=function(code_array,constant_pool){this.var_num=parseInt(this.name[6])},LoadOpcode.prototype._execute=function(rs){return rs.push(rs.cl(this.var_num)),!0},LoadOpcode}(Opcode);exports.LoadOpcode=LoadOpcode;var LoadOpcode2=function(_super){function LoadOpcode2(){_super.apply(this,arguments)}return __extends(LoadOpcode2,_super),LoadOpcode2.prototype._execute=function(rs){return rs.push2(rs.cl(this.var_num),null),!0},LoadOpcode2}(LoadOpcode);exports.LoadOpcode2=LoadOpcode2;var LoadVarOpcode=function(_super){function LoadVarOpcode(){_super.apply(this,arguments)}return __extends(LoadVarOpcode,_super),LoadVarOpcode.prototype.take_args=function(code_array,constant_pool,wide){wide?(this.name+="_w",this.byte_count=3,this.var_num=code_array.get_uint(2)):(this.byte_count=1,this.var_num=code_array.get_uint(1))},LoadVarOpcode.prototype.annotate=function(idx,pool){return"	"+this.var_num},LoadVarOpcode}(LoadOpcode);exports.LoadVarOpcode=LoadVarOpcode;var LoadVarOpcode2=function(_super){function LoadVarOpcode2(){_super.apply(this,arguments)}return __extends(LoadVarOpcode2,_super),LoadVarOpcode2.prototype._execute=function(rs){return rs.push2(rs.cl(this.var_num),null),!0},LoadVarOpcode2}(LoadVarOpcode);exports.LoadVarOpcode2=LoadVarOpcode2;var StoreOpcode=function(_super){function StoreOpcode(){_super.apply(this,arguments)}return __extends(StoreOpcode,_super),StoreOpcode.prototype.take_args=function(code_array,constant_pool){this.var_num=parseInt(this.name[7])},StoreOpcode.prototype._execute=function(rs){return rs.put_cl(this.var_num,rs.pop()),!0},StoreOpcode}(Opcode);exports.StoreOpcode=StoreOpcode;var StoreOpcode2=function(_super){function StoreOpcode2(){_super.apply(this,arguments)}return __extends(StoreOpcode2,_super),StoreOpcode2.prototype._execute=function(rs){return rs.put_cl2(this.var_num,rs.pop2()),!0},StoreOpcode2}(StoreOpcode);exports.StoreOpcode2=StoreOpcode2;var StoreVarOpcode=function(_super){function StoreVarOpcode(){_super.apply(this,arguments)}return __extends(StoreVarOpcode,_super),StoreVarOpcode.prototype.take_args=function(code_array,constant_pool,wide){wide?(this.name+="_w",this.byte_count=3,this.var_num=code_array.get_uint(2)):(this.byte_count=1,this.var_num=code_array.get_uint(1))},StoreVarOpcode.prototype.annotate=function(idx,pool){return"	"+this.var_num},StoreVarOpcode}(StoreOpcode);exports.StoreVarOpcode=StoreVarOpcode;var StoreVarOpcode2=function(_super){function StoreVarOpcode2(){_super.apply(this,arguments)}return __extends(StoreVarOpcode2,_super),StoreVarOpcode2.prototype._execute=function(rs){return rs.put_cl2(this.var_num,rs.pop2()),!0},StoreVarOpcode2}(LoadVarOpcode);exports.StoreVarOpcode2=StoreVarOpcode2;var LookupSwitchOpcode=function(_super){function LookupSwitchOpcode(){_super.apply(this,arguments)}return __extends(LookupSwitchOpcode,_super),LookupSwitchOpcode.prototype.annotate=function(idx,pool){var rv="{\n";for(var match in this.offsets){var offset=this.offsets[match];rv+="		"+match+": "+(idx+offset)+";\n"}return rv+"		default: "+(idx+this._default)+" }"},LookupSwitchOpcode.prototype.take_args=function(code_array,constant_pool){var padding_size=(4-code_array.pos()%4)%4;code_array.skip(padding_size),this._default=code_array.get_int(4);var npairs=code_array.get_int(4);this.offsets={};for(var i=0;i<npairs;++i){var match=code_array.get_int(4);this.offsets[match]=code_array.get_int(4)}this.byte_count=padding_size+8*(npairs+1)},LookupSwitchOpcode.prototype._execute=function(rs){var offset=this.offsets[rs.pop()];return offset?this.inc_pc(rs,offset):this.inc_pc(rs,this._default),!0},LookupSwitchOpcode}(BranchOpcode);exports.LookupSwitchOpcode=LookupSwitchOpcode;var TableSwitchOpcode=function(_super){function TableSwitchOpcode(){_super.apply(this,arguments)}return __extends(TableSwitchOpcode,_super),TableSwitchOpcode.prototype.take_args=function(code_array,constant_pool){var padding_size=(4-code_array.pos()%4)%4;code_array.skip(padding_size),this._default=code_array.get_int(4);var low=code_array.get_int(4),high=code_array.get_int(4);this.offsets={};var total_offsets=high-low+1;for(var i=0;i<total_offsets;++i)this.offsets[low+i]=code_array.get_int(4);this.byte_count=padding_size+12+4*total_offsets},TableSwitchOpcode}(LookupSwitchOpcode);exports.TableSwitchOpcode=TableSwitchOpcode;var NewArray_arr_types={4:"Z",5:"C",6:"F",7:"D",8:"B",9:"S",10:"I",11:"J"},NewArrayOpcode=function(_super){function NewArrayOpcode(name){_super.call(this,name,1)}return __extends(NewArrayOpcode,_super),NewArrayOpcode.prototype.take_args=function(code_array,constant_pool){this.element_type=NewArray_arr_types[code_array.get_uint(1)]},NewArrayOpcode.prototype.annotate=function(idx,pool){return"	"+util.internal2external[this.element_type]},NewArrayOpcode.prototype._execute=function(rs){return rs.push(rs.heap_newarray(this.element_type,rs.pop())),!0},NewArrayOpcode}(Opcode);exports.NewArrayOpcode=NewArrayOpcode;var MultiArrayOpcode=function(_super){function MultiArrayOpcode(name){_super.call(this,name,3)}return __extends(MultiArrayOpcode,_super),MultiArrayOpcode.prototype.take_args=function(code_array,constant_pool){this.class_ref=code_array.get_uint(2),this.class_descriptor=constant_pool.get(this.class_ref).deref(),this.dim=code_array.get_uint(1)},MultiArrayOpcode.prototype.annotate=function(idx,pool){return"	#"+this.class_ref+",  "+this.dim+";"},MultiArrayOpcode.prototype._execute=function(rs){var _this=this,cls=rs.get_class(this.class_descriptor,!0);if(cls==null)return rs.async_op(function(resume_cb,except_cb){rs.get_cl().initialize_class(rs,_this.class_descriptor,function(class_file){return resume_cb(undefined,undefined,!0,!1)},except_cb)}),!0;var new_execute=function(rs){var counts=rs.curr_frame().stack.splice(-this.dim,this.dim);rs.push(rs.heap_multinewarray(_this.class_descriptor,counts))};return new_execute.call(this,rs),this.execute=new_execute,!0},MultiArrayOpcode}(Opcode);exports.MultiArrayOpcode=MultiArrayOpcode;var ArrayLoadOpcode=function(_super){function ArrayLoadOpcode(){_super.apply(this,arguments)}return __extends(ArrayLoadOpcode,_super),ArrayLoadOpcode.prototype._execute=function(rs){var idx=rs.pop(),obj=rs.check_null(rs.pop()),len=obj.array.length;if(idx<0||idx>=len){var err_cls=rs.get_bs_class("Ljava/lang/ArrayIndexOutOfBoundsException;");rs.java_throw(err_cls,idx+" not in length "+len+" array of type "+obj.cls.get_type())}return rs.push(obj.array[idx]),(this.name[0]==="l"||this.name[0]==="d")&&rs.push(null),!0},ArrayLoadOpcode}(Opcode);exports.ArrayLoadOpcode=ArrayLoadOpcode;var ArrayStoreOpcode=function(_super){function ArrayStoreOpcode(){_super.apply(this,arguments)}return __extends(ArrayStoreOpcode,_super),ArrayStoreOpcode.prototype._execute=function(rs){var value=this.name[0]==="l"||this.name[0]==="d"?rs.pop2():rs.pop(),idx=rs.pop(),obj=rs.check_null(rs.pop()),len=obj.array.length;if(idx<0||idx>=len){var err_cls=rs.get_bs_class("Ljava/lang/ArrayIndexOutOfBoundsException;");rs.java_throw(err_cls,idx+" not in length "+len+" array of type "+obj.cls.get_type())}return obj.array[idx]=value,!0},ArrayStoreOpcode}(Opcode);exports.ArrayStoreOpcode=ArrayStoreOpcode;var ReturnOpcode=function(_super){function ReturnOpcode(){_super.apply(this,arguments)}return __extends(ReturnOpcode,_super),ReturnOpcode.prototype._execute=function(rs){var cf=rs.meta_stack().pop();return rs.push(cf.stack[0]),rs.should_return=!0,!0},ReturnOpcode}(Opcode);exports.ReturnOpcode=ReturnOpcode;var ReturnOpcode2=function(_super){function ReturnOpcode2(){_super.apply(this,arguments)}return __extends(ReturnOpcode2,_super),ReturnOpcode2.prototype._execute=function(rs){var cf=rs.meta_stack().pop();return rs.push2(cf.stack[0],null),rs.should_return=!0,!0},ReturnOpcode2}(Opcode);exports.ReturnOpcode2=ReturnOpcode2;var VoidReturnOpcode=function(_super){function VoidReturnOpcode(){_super.apply(this,arguments)}return __extends(VoidReturnOpcode,_super),VoidReturnOpcode.prototype._execute=function(rs){return rs.meta_stack().pop(),rs.should_return=!0,!0},VoidReturnOpcode}(Opcode);exports.VoidReturnOpcode=VoidReturnOpcode,exports.monitorenter=monitorenter,exports.monitorexit=monitorexit,exports.opcodes=[new Opcode("nop",0,function(rs){}),new Opcode("aconst_null",0,function(rs){return rs.push(null)}),new Opcode("iconst_m1",0,function(rs){return rs.push(-1)}),new Opcode("iconst_0",0,function(rs){return rs.push(0)}),new Opcode("iconst_1",0,function(rs){return rs.push(1)}),new Opcode("iconst_2",0,function(rs){return rs.push(2)}),new Opcode("iconst_3",0,function(rs){return rs.push(3)}),new Opcode("iconst_4",0,function(rs){return rs.push(4)}),new Opcode("iconst_5",0,function(rs){return rs.push(5)}),new Opcode("lconst_0",0,function(rs){return rs.push2(gLong.ZERO,null)}),new Opcode("lconst_1",0,function(rs){return rs.push2(gLong.ONE,null)}),new Opcode("fconst_0",0,function(rs){return rs.push(0)}),new Opcode("fconst_1",0,function(rs){return rs.push(1)}),new Opcode("fconst_2",0,function(rs){return rs.push(2)}),new Opcode("dconst_0",0,function(rs){return rs.push2(0,null)}),new Opcode("dconst_1",0,function(rs){return rs.push2(1,null)}),new PushOpcode("bipush",1),new PushOpcode("sipush",2),new LoadConstantOpcode("ldc",1),new LoadConstantOpcode("ldc_w",2),new LoadConstantOpcode("ldc2_w",2),new LoadVarOpcode("iload"),new LoadVarOpcode2("lload"),new LoadVarOpcode("fload"),new LoadVarOpcode2("dload"),new LoadVarOpcode("aload"),new LoadOpcode("iload_0"),new LoadOpcode("iload_1"),new LoadOpcode("iload_2"),new LoadOpcode("iload_3"),new LoadOpcode2("lload_0"),new LoadOpcode2("lload_1"),new LoadOpcode2("lload_2"),new LoadOpcode2("lload_3"),new LoadOpcode("fload_0"),new LoadOpcode("fload_1"),new LoadOpcode("fload_2"),new LoadOpcode("fload_3"),new LoadOpcode2("dload_0"),new LoadOpcode2("dload_1"),new LoadOpcode2("dload_2"),new LoadOpcode2("dload_3"),new LoadOpcode("aload_0"),new LoadOpcode("aload_1"),new LoadOpcode("aload_2"),new LoadOpcode("aload_3"),new ArrayLoadOpcode("iaload"),new ArrayLoadOpcode("laload"),new ArrayLoadOpcode("faload"),new ArrayLoadOpcode("daload"),new ArrayLoadOpcode("aaload"),new ArrayLoadOpcode("baload"),new ArrayLoadOpcode("caload"),new ArrayLoadOpcode("saload"),new StoreVarOpcode("istore"),new StoreVarOpcode2("lstore"),new StoreVarOpcode("fstore"),new StoreVarOpcode2("dstore"),new StoreVarOpcode("astore"),new StoreOpcode("istore_0"),new StoreOpcode("istore_1"),new StoreOpcode("istore_2"),new StoreOpcode("istore_3"),new StoreOpcode2("lstore_0"),new StoreOpcode2("lstore_1"),new StoreOpcode2("lstore_2"),new StoreOpcode2("lstore_3"),new StoreOpcode("fstore_0"),new StoreOpcode("fstore_1"),new StoreOpcode("fstore_2"),new StoreOpcode("fstore_3"),new StoreOpcode2("dstore_0"),new StoreOpcode2("dstore_1"),new StoreOpcode2("dstore_2"),new StoreOpcode2("dstore_3"),new StoreOpcode("astore_0"),new StoreOpcode("astore_1"),new StoreOpcode("astore_2"),new StoreOpcode("astore_3"),new ArrayStoreOpcode("iastore"),new ArrayStoreOpcode("lastore"),new ArrayStoreOpcode("fastore"),new ArrayStoreOpcode("dastore"),new ArrayStoreOpcode("aastore"),new ArrayStoreOpcode("bastore"),new ArrayStoreOpcode("castore"),new ArrayStoreOpcode("sastore"),new Opcode("pop",0,function(rs){return rs.pop()}),new Opcode("pop2",0,function(rs){return rs.pop2()}),new Opcode("dup",0,function(rs){var v=rs.pop();rs.push2(v,v)}),new Opcode("dup_x1",0,function(rs){var v1=rs.pop(),v2=rs.pop();rs.push_array([v1,v2,v1])}),new Opcode("dup_x2",0,function(rs){var v1=rs.pop(),v2=rs.pop(),v3=rs.pop();rs.push_array([v1,v3,v2,v1])}),new Opcode("dup2",0,function(rs){var v1=rs.pop(),v2=rs.pop();rs.push_array([v2,v1,v2,v1])}),new Opcode("dup2_x1",0,function(rs){var v1=rs.pop(),v2=rs.pop(),v3=rs.pop();rs.push_array([v2,v1,v3,v2,v1])}),new Opcode("dup2_x2",0,function(rs){var v1=rs.pop(),v2=rs.pop(),v3=rs.pop(),v4=rs.pop();rs.push_array([v2,v1,v4,v3,v2,v1])}),new Opcode("swap",0,function(rs){var v1=rs.pop(),v2=rs.pop();rs.push2(v2,v1)}),new Opcode("iadd",0,function(rs){return rs.push(rs.pop()+rs.pop()|0)}),new Opcode("ladd",0,function(rs){return rs.push2(rs.pop2().add(rs.pop2()),null)}),new Opcode("fadd",0,function(rs){return rs.push(util.wrap_float(rs.pop()+rs.pop()))}),new Opcode("dadd",0,function(rs){return rs.push2(rs.pop2()+rs.pop2(),null)}),new Opcode("isub",0,function(rs){return rs.push(-rs.pop()+rs.pop()|0)}),new Opcode("lsub",0,function(rs){return rs.push2(rs.pop2().negate().add(rs.pop2()),null)}),new Opcode("fsub",0,function(rs){return rs.push(util.wrap_float(-rs.pop()+rs.pop()))}),new Opcode("dsub",0,function(rs){return rs.push2(-rs.pop2()+rs.pop2(),null)}),new Opcode("imul",0,function(rs){return rs.push(Math.imul(rs.pop(),rs.pop()))}),new Opcode("lmul",0,function(rs){return rs.push2(rs.pop2().multiply(rs.pop2()),null)}),new Opcode("fmul",0,function(rs){return rs.push(util.wrap_float(rs.pop()*rs.pop()))}),new Opcode("dmul",0,function(rs){return rs.push2(rs.pop2()*rs.pop2(),null)}),new Opcode("idiv",0,function(rs){var v=rs.pop();rs.push(util.int_div(rs,rs.pop(),v))}),new Opcode("ldiv",0,function(rs){var v=rs.pop2();rs.push2(util.long_div(rs,rs.pop2(),v),null)}),new Opcode("fdiv",0,function(rs){var a=rs.pop();rs.push(util.wrap_float(rs.pop()/a))}),new Opcode("ddiv",0,function(rs){var v=rs.pop2();rs.push2(rs.pop2()/v,null)}),new Opcode("irem",0,function(rs){var v2=rs.pop();rs.push(util.int_mod(rs,rs.pop(),v2))}),new Opcode("lrem",0,function(rs){var v2=rs.pop2();rs.push2(util.long_mod(rs,rs.pop2(),v2),null)}),new Opcode("frem",0,function(rs){var b=rs.pop();rs.push(rs.pop()%b)}),new Opcode("drem",0,function(rs){var v2=rs.pop2();rs.push2(rs.pop2()%v2,null)}),new Opcode("ineg",0,function(rs){return rs.push(-rs.pop()|0)}),new Opcode("lneg",0,function(rs){return rs.push2(rs.pop2().negate(),null)}),new Opcode("fneg",0,function(rs){return rs.push(-rs.pop())}),new Opcode("dneg",0,function(rs){return rs.push2(-rs.pop2(),null)}),new Opcode("ishl",0,function(rs){var s=rs.pop();rs.push(rs.pop()<<s)}),new Opcode("lshl",0,function(rs){var s=rs.pop();rs.push2(rs.pop2().shiftLeft(gLong.fromInt(s)),null)}),new Opcode("ishr",0,function(rs){var s=rs.pop();rs.push(rs.pop()>>s)}),new Opcode("lshr",0,function(rs){var s=rs.pop();rs.push2(rs.pop2().shiftRight(gLong.fromInt(s)),null)}),new Opcode("iushr",0,function(rs){var s=rs.pop();rs.push(rs.pop()>>>s)}),new Opcode("lushr",0,function(rs){var s=rs.pop();rs.push2(rs.pop2().shiftRightUnsigned(gLong.fromInt(s)),null)}),new Opcode("iand",0,function(rs){return rs.push(rs.pop()&rs.pop())}),new Opcode("land",0,function(rs){return rs.push2(rs.pop2().and(rs.pop2()),null)}),new Opcode("ior",0,function(rs){return rs.push(rs.pop()|rs.pop())}),new Opcode("lor",0,function(rs){return rs.push2(rs.pop2().or(rs.pop2()),null)}),new Opcode("ixor",0,function(rs){return rs.push(rs.pop()^rs.pop())}),new Opcode("lxor",0,function(rs){return rs.push2(rs.pop2().xor(rs.pop2()),null)}),new IIncOpcode("iinc"),new Opcode("i2l",0,function(rs){return rs.push2(gLong.fromInt(rs.pop()),null)}),new Opcode("i2f",0,function(rs){}),new Opcode("i2d",0,function(rs){return rs.push(null)}),new Opcode("l2i",0,function(rs){return rs.push(rs.pop2().toInt())}),new Opcode("l2f",0,function(rs){return rs.push(rs.pop2().toNumber())}),new Opcode("l2d",0,function(rs){return rs.push2(rs.pop2().toNumber(),null)}),new Opcode("f2i",0,function(rs){return rs.push(util.float2int(rs.pop()))}),new Opcode("f2l",0,function(rs){return rs.push2(gLong.fromNumber(rs.pop()),null)}),new Opcode("f2d",0,function(rs){return rs.push(null)}),new Opcode("d2i",0,function(rs){return rs.push(util.float2int(rs.pop2()))}),new Opcode("d2l",0,function(rs){var d_val=rs.pop2();d_val===Number.POSITIVE_INFINITY?rs.push2(gLong.MAX_VALUE,null):d_val===Number.NEGATIVE_INFINITY?rs.push2(gLong.MIN_VALUE,null):rs.push2(gLong.fromNumber(d_val),null)}),new Opcode("d2f",0,function(rs){return rs.push(util.wrap_float(rs.pop2()))}),new Opcode("i2b",0,function(rs){return rs.push(rs.pop()<<24>>24)}),new Opcode("i2c",0,function(rs){return rs.push(rs.pop()&65535)}),new Opcode("i2s",0,function(rs){return rs.push(rs.pop()<<16>>16)}),new Opcode("lcmp",0,function(rs){var v2=rs.pop2();rs.push(rs.pop2().compare(v2))}),new Opcode("fcmpl",0,function(rs){var v2=rs.pop(),res=util.cmp(rs.pop(),v2);res==null?rs.push(-1):rs.push(res)}),new Opcode("fcmpg",0,function(rs){var v2=rs.pop(),res=util.cmp(rs.pop(),v2);res==null?rs.push(1):rs.push(res)}),new Opcode("dcmpl",0,function(rs){var v2=rs.pop2(),res=util.cmp(rs.pop2(),v2);res==null?rs.push(-1):rs.push(res)}),new Opcode("dcmpg",0,function(rs){var v2=rs.pop2(),res=util.cmp(rs.pop2(),v2);res==null?rs.push(1):rs.push(res)}),new UnaryBranchOpcode("ifeq",function(v){return v===0}),new UnaryBranchOpcode("ifne",function(v){return v!==0}),new UnaryBranchOpcode("iflt",function(v){return v<0}),new UnaryBranchOpcode("ifge",function(v){return v>=0}),new UnaryBranchOpcode("ifgt",function(v){return v>0}),new UnaryBranchOpcode("ifle",function(v){return v<=0}),new BinaryBranchOpcode("if_icmpeq",function(v1,v2){return v1===v2}),new BinaryBranchOpcode("if_icmpne",function(v1,v2){return v1!==v2}),new BinaryBranchOpcode("if_icmplt",function(v1,v2){return v1<v2}),new BinaryBranchOpcode("if_icmpge",function(v1,v2){return v1>=v2}),new BinaryBranchOpcode("if_icmpgt",function(v1,v2){return v1>v2}),new BinaryBranchOpcode("if_icmple",function(v1,v2){return v1<=v2}),new BinaryBranchOpcode("if_acmpeq",function(v1,v2){return v1===v2}),new BinaryBranchOpcode("if_acmpne",function(v1,v2){return v1!==v2}),new GotoOpcode("goto",2),new JSROpcode("jsr",2),new Opcode("ret",1,function(rs){this.goto_pc(rs,rs.cl(this.args[0]))}),new TableSwitchOpcode("tableswitch"),new LookupSwitchOpcode("lookupswitch"),new ReturnOpcode("ireturn"),new ReturnOpcode2("lreturn"),new ReturnOpcode("freturn"),new ReturnOpcode2("dreturn"),new ReturnOpcode("areturn"),new VoidReturnOpcode("return"),new FieldOpcode("getstatic",function(rs){var _this=this,desc=this.field_spec.class_desc,ref_cls=rs.get_class(desc,!0),new_execute;this.field_spec.type=="J"||this.field_spec.type=="D"?new_execute=function(rs){return rs.push2(_this.cls.static_get(rs,_this.field_spec.name),null)}:new_execute=function(rs){return rs.push(_this.cls.static_get(rs,_this.field_spec.name))};if(ref_cls!=null){var cls_type=ref_cls.field_lookup(rs,this.field_spec.name).cls.get_type();this.cls=rs.get_class(cls_type,!0),this.cls!=null?(new_execute.call(this,rs),this.execute=new_execute):rs.async_op(function(resume_cb,except_cb){rs.get_cl().initialize_class(rs,cls_type,function(class_file){resume_cb(undefined,undefined,!0,!1)},except_cb)})}else rs.async_op(function(resume_cb,except_cb){rs.get_cl().initialize_class(rs,desc,function(class_file){resume_cb(undefined,undefined,!0,!1)},except_cb)})}),new FieldOpcode("putstatic",function(rs){var _this=this,desc=this.field_spec.class_desc,ref_cls=rs.get_class(desc,!0),new_execute;this.field_spec.type=="J"||this.field_spec.type=="D"?new_execute=function(rs){return _this.cls.static_put(rs,_this.field_spec.name,rs.pop2())}:new_execute=function(rs){return _this.cls.static_put(rs,_this.field_spec.name,rs.pop())};if(ref_cls!=null){var cls_type=ref_cls.field_lookup(rs,this.field_spec.name).cls.get_type();this.cls=rs.get_class(cls_type,!0),this.cls!=null?(new_execute.call(this,rs),this.execute=new_execute):rs.async_op(function(resume_cb,except_cb){rs.get_cl().initialize_class(rs,cls_type,function(class_file){resume_cb(undefined,undefined,!0,!1)},except_cb)});return}rs.async_op(function(resume_cb,except_cb){rs.get_cl().initialize_class(rs,desc,function(class_file){resume_cb(undefined,undefined,!0,!1)},except_cb)})}),new FieldOpcode("getfield",function(rs){var desc=this.field_spec.class_desc,obj=rs.check_null(rs.peek()),cls=rs.get_class(desc,!0);if(cls!=null){var field=cls.field_lookup(rs,this.field_spec.name),name=field.cls.get_type()+this.field_spec.name,new_execute;this.field_spec.type=="J"||this.field_spec.type=="D"?new_execute=function(rs){return rs.push2(rs.check_null(rs.pop()).get_field(rs,name),null)}:new_execute=function(rs){return rs.push(rs.check_null(rs.pop()).get_field(rs,name))},new_execute.call(this,rs),this.execute=new_execute;return}rs.async_op(function(resume_cb,except_cb){rs.get_cl().resolve_class(rs,desc,function(){resume_cb(undefined,undefined,!0,!1)},except_cb)})}),new FieldOpcode("putfield",function(rs){var desc=this.field_spec.class_desc,is_cat_2=this.field_spec.type=="J"||this.field_spec.type=="D";rs.check_null(rs.peek(is_cat_2?2:1));var cls_obj=rs.get_class(desc,!0);if(cls_obj!=null){var field=cls_obj.field_lookup(rs,this.field_spec.name),name=field.cls.get_type()+this.field_spec.name,new_execute;is_cat_2?new_execute=function(rs){var val=rs.pop2();rs.check_null(rs.pop()).set_field(rs,name,val)}:new_execute=function(rs){var val=rs.pop();rs.check_null(rs.pop()).set_field(rs,name,val)},new_execute.call(this,rs),this.execute=new_execute}else rs.async_op(function(resume_cb,except_cb){rs.get_cl().resolve_class(rs,desc,function(){resume_cb(undefined,undefined,!0,!1)},except_cb)})}),new DynInvokeOpcode("invokevirtual"),new InvokeOpcode("invokespecial"),new InvokeOpcode("invokestatic"),new DynInvokeOpcode("invokeinterface"),null,new ClassOpcode("new",function(rs){var _this=this,desc=this.class_desc;this.cls=rs.get_class(desc,!0),this.cls!=null?this.cls.is_castable(rs.get_bs_cl().get_resolved_class("Ljava/lang/ClassLoader;",!0))?(rs.push(new JavaClassLoaderObject(rs,this.cls)),this.execute=function(rs){return rs.push(new JavaClassLoaderObject(rs,_this.cls))}):this.cls.is_castable(rs.get_bs_cl().get_resolved_class("Ljava/lang/Thread;",!0))?(rs.push(new threading.JavaThreadObject(rs,this.cls)),this.execute=function(rs){return rs.push(new threading.JavaThreadObject(rs,_this.cls))}):(rs.push(new JavaObject(rs,this.cls)),this.execute=function(rs){return rs.push(new JavaObject(rs,_this.cls))}):rs.async_op(function(resume_cb,except_cb){var success_fn=function(class_file){var obj;class_file.is_castable(rs.get_bs_cl().get_resolved_class("Ljava/lang/ClassLoader;",!0))?obj=new JavaClassLoaderObject(rs,class_file):class_file.is_castable(rs.get_bs_cl().get_resolved_class("Ljava/lang/Thread;",!0))?obj=new threading.JavaThreadObject(rs,class_file):obj=new JavaObject(rs,class_file),resume_cb(obj,undefined,!0)};rs.get_cl().initialize_class(rs,desc,success_fn,except_cb)})}),new NewArrayOpcode("newarray"),new ClassOpcode("anewarray",function(rs){var desc=this.class_desc,cls=rs.get_cl().get_resolved_class(desc,!0);if(cls!=null){var new_execute=function(rs){return rs.push(rs.heap_newarray(desc,rs.pop()))};new_execute.call(this,rs),this.execute=new_execute}else rs.async_op(function(resume_cb,except_cb){rs.get_cl().resolve_class(rs,desc,function(class_file){resume_cb(undefined,undefined,!0,!1)},except_cb)})}),new Opcode("arraylength",0,function(rs){return rs.push(rs.check_null(rs.pop()).array.length)}),new Opcode("athrow",0,function(rs){throw new JavaException(rs.pop())}),new ClassOpcode("checkcast",function(rs){var desc=this.class_desc;this.cls=rs.get_cl().get_resolved_class(desc,!0);if(this.cls!=null){var new_execute=function(rs){var o=rs.peek();if(o!=null&&!o.cls.is_castable(this.cls)){var target_class=this.cls.toExternalString(),candidate_class=o.cls.toExternalString(),err_cls=rs.get_bs_class("Ljava/lang/ClassCastException;");rs.java_throw(err_cls,candidate_class+" cannot be cast to "+target_class)}};new_execute.call(this,rs),this.execute=new_execute;return}rs.async_op(function(resume_cb,except_cb){rs.get_cl().resolve_class(rs,desc,function(){return resume_cb(undefined,undefined,!0,!1)},except_cb)})}),new ClassOpcode("instanceof",function(rs){var desc=this.class_desc;this.cls=rs.get_cl().get_resolved_class(desc,!0);if(this.cls!=null){var new_execute=function(rs){var o=rs.pop();rs.push(o!=null?o.cls.is_castable(this.cls)+0:0)};new_execute.call(this,rs),this.execute=new_execute;return}rs.async_op(function(resume_cb,except_cb){rs.get_cl().resolve_class(rs,desc,function(){return resume_cb(undefined,undefined,!0,!1)},except_cb)})}),new Opcode("monitorenter",0,function(rs){if(!exports.monitorenter(rs,rs.peek(),this))throw ReturnException;rs.pop()}),new Opcode("monitorexit",0,function(rs){return exports.monitorexit(rs,rs.pop())}),null,new MultiArrayOpcode("multianewarray"),new UnaryBranchOpcode("ifnull",function(v){return v==null}),new UnaryBranchOpcode("ifnonnull",function(v){return v!=null}),new GotoOpcode("goto_w",4),new JSROpcode("jsr_w",4)]}),define("src/attributes",["require","exports","./util","./opcodes"],function(require,exports,__util__,__opcodes__){function make_attributes(bytes_array,constant_pool){var attr_types={Code:Code,LineNumberTable:LineNumberTable,SourceFile:SourceFile,StackMapTable:StackMapTable,LocalVariableTable:LocalVariableTable,ConstantValue:ConstantValue,Exceptions:Exceptions,InnerClasses:InnerClasses,Synthetic:Synthetic,Deprecated:Deprecated,Signature:Signature,RuntimeVisibleAnnotations:RuntimeVisibleAnnotations,AnnotationDefault:AnnotationDefault,EnclosingMethod:EnclosingMethod},num_attrs=bytes_array.get_uint(2),attrs=[];for(var i=0;i<num_attrs;i++){var name=constant_pool.get(bytes_array.get_uint(2)).value,attr_len=bytes_array.get_uint(4);if(attr_types[name]!=null){var attr=new attr_types[name],old_len=bytes_array.size();attr.parse(bytes_array,constant_pool,attr_len);var new_len=bytes_array.size();old_len-new_len!==attr_len&&bytes_array.skip(attr_len-old_len+new_len),attrs.push(attr)}else bytes_array.skip(attr_len)}return attrs}var util=__util__,opcodes=__opcodes__,ExceptionHandler=function(){function ExceptionHandler(){this.name="ExceptionHandler"}return ExceptionHandler.prototype.parse=function(bytes_array,constant_pool){this.start_pc=bytes_array.get_uint(2),this.end_pc=bytes_array.get_uint(2),this.handler_pc=bytes_array.get_uint(2);var cti=bytes_array.get_uint(2);this.catch_type=cti===0?"<any>":constant_pool.get(cti).deref()},ExceptionHandler}();exports.ExceptionHandler=ExceptionHandler;var Code=function(){function Code(){this.name="Code"}return Code.prototype.parse=function(bytes_array,constant_pool){this.constant_pool=constant_pool,this.max_stack=bytes_array.get_uint(2),this.max_locals=bytes_array.get_uint(2),this.code_len=bytes_array.get_uint(4),this.code_len===0&&!0,this._code_array=bytes_array.splice(this.code_len),this.opcodes=null;var except_len=bytes_array.get_uint(2);this.exception_handlers=[];for(var i=0;i<except_len;i++){var eh=new ExceptionHandler;this.exception_handlers.push(eh),eh.parse(bytes_array,constant_pool)}this.attrs=exports.make_attributes(bytes_array,constant_pool),this.run_stamp=0},Code.prototype.parse_code=function(){this.opcodes=new Array(this.code_len);while(this._code_array.has_bytes()){var op_index=this._code_array.pos(),c=this._code_array.get_uint(1),wide=c===196;wide&&(c=this._code_array.get_uint(1)),opcodes.opcodes[c]==null&&!0;var op=Object.create(opcodes.opcodes[c]);op.take_args(this._code_array,this.constant_pool,wide),this.opcodes[op_index]=op}this._code_array.rewind()},Code.prototype.each_opcode=function(fn){for(var i=0;i<this.code_len;i++)this.opcodes[i]!=null&&fn(i,this.opcodes[i])},Code.prototype.get_attribute=function(name){for(var i=0;i<this.attrs.length;i++){var attr=this.attrs[i];if(attr.name===name)return attr}return null},Code}();exports.Code=Code;var LineNumberTable=function(){function LineNumberTable(){this.name="LineNumberTable"}return LineNumberTable.prototype.parse=function(bytes_array,constant_pool){this.entries=[];var lnt_len=bytes_array.get_uint(2);for(var i=0;i<lnt_len;i++){var spc=bytes_array.get_uint(2),ln=bytes_array.get_uint(2);this.entries.push({start_pc:spc,line_number:ln})}},LineNumberTable.prototype.disassemblyOutput=function(){var rv="  LineNumberTable:\n";for(var i=0;i<this.entries.length;i++){var entry=this.entries[i];rv+="   line "+entry.line_number+": "+entry.start_pc+"\n"}return rv},LineNumberTable}();exports.LineNumberTable=LineNumberTable;var SourceFile=function(){function SourceFile(){this.name="SourceFile"}return SourceFile.prototype.parse=function(bytes_array,constant_pool){this.filename=constant_pool.get(bytes_array.get_uint(2)).value},SourceFile}();exports.SourceFile=SourceFile;var StackMapTable=function(){function StackMapTable(){this.name="StackMapTable"}return StackMapTable.prototype.parse=function(bytes_array,constant_pool){this.num_entries=bytes_array.get_uint(2),this.entries=[];for(var i=0;i<this.num_entries;i++)this.entries.push(this.parse_entries(bytes_array,constant_pool))},StackMapTable.prototype.parse_entries=function(bytes_array,constant_pool){var frame_type=bytes_array.get_uint(1);if(0<=frame_type&&frame_type<64)return{frame_type:frame_type,frame_name:"same"};if(64<=frame_type&&frame_type<128)return{frame_type:frame_type,frame_name:"same_locals_1_stack_item",stack:[this.parse_verification_type_info(bytes_array,constant_pool)]};if(!(128<=frame_type&&frame_type<247)){if(frame_type===247)return{frame_type:frame_type,frame_name:"same_locals_1_stack_item_frame_extended",offset_delta:bytes_array.get_uint(2),stack:[this.parse_verification_type_info(bytes_array,constant_pool)]};if(248<=frame_type&&frame_type<251)return{frame_type:frame_type,frame_name:"chop",offset_delta:[bytes_array.get_uint(2)]};if(frame_type===251)return{frame_type:frame_type,frame_name:"same_frame_extended",offset_delta:[bytes_array.get_uint(2)]};if(252<=frame_type&&frame_type<255){var offset_delta=bytes_array.get_uint(2),locals=[];for(var i=0;i<frame_type-251;i++)locals.push(this.parse_verification_type_info(bytes_array,constant_pool));return{frame_type:frame_type,frame_name:"append",offset_delta:offset_delta,locals:locals}}if(frame_type===255){var offset_delta=bytes_array.get_uint(2),num_locals=bytes_array.get_uint(2);locals=[];for(var i=0;i<num_locals;i++)locals.push(this.parse_verification_type_info(bytes_array,constant_pool));var num_stack_items=bytes_array.get_uint(2),stack=[];for(var i=0;i<num_stack_items;i++)stack.push(this.parse_verification_type_info(bytes_array,constant_pool));return{frame_type:frame_type,frame_name:"full_frame",offset_delta:offset_delta,num_locals:num_locals,locals:locals,num_stack_items:num_stack_items,stack:stack}}}},StackMapTable.prototype.parse_verification_type_info=function(bytes_array,constant_pool){var tag=bytes_array.get_uint(1);if(tag===7){var cls=constant_pool.get(bytes_array.get_uint(2)).deref();return"class "+(/\w/.test(cls[0])?util.descriptor2typestr(cls):'"'+cls+'"')}if(tag===8)return"uninitialized "+bytes_array.get_uint(2);var tag_to_type=["bogus","int","float","double","long","null","this","object","uninitialized"];return tag_to_type[tag]},StackMapTable.prototype.disassemblyOutput=function(){var rv="  StackMapTable: number_of_entries = "+this.num_entries+"\n";for(var i=0;i<this.entries.length;i++){var entry=this.entries[i];rv+="   frame_type = "+entry.frame_type+" /* "+entry.frame_name+" */\n",entry["offset_delta"]!=null&&(rv+="     offset_delta = "+entry.offset_delta+"\n"),entry["locals"]!=null&&(rv+="     locals = [ "+entry.locals.join(", ")+" ]\n"),entry["stack"]!=null&&(rv+="     stack = [ "+entry.stack.join(", ")+" ]\n")}return rv},StackMapTable}();exports.StackMapTable=StackMapTable;var LocalVariableTable=function(){function LocalVariableTable(){this.name="LocalVariableTable"}return LocalVariableTable.prototype.parse=function(bytes_array,constant_pool){this.num_entries=bytes_array.get_uint(2),this.entries=[];for(var i=0;i<this.num_entries;i++)this.entries.push(this.parse_entries(bytes_array,constant_pool))},LocalVariableTable.prototype.parse_entries=function(bytes_array,constant_pool){return{start_pc:bytes_array.get_uint(2),length:bytes_array.get_uint(2),name:constant_pool.get(bytes_array.get_uint(2)).value,descriptor:constant_pool.get(bytes_array.get_uint(2)).value,ref:bytes_array.get_uint(2)}},LocalVariableTable.prototype.disassemblyOutput=function(){var rv="  LocalVariableTable:\n   Start  Length  Slot  Name   Signature\n";for(var i=0;i<this.num_entries;i++){var entry=this.entries[i];rv+="   "+entry.start_pc+"      "+entry.length+"      "+entry.ref,rv+=""+entry.name+"      "+entry.descriptor+"\n"}return rv},LocalVariableTable}();exports.LocalVariableTable=LocalVariableTable;var Exceptions=function(){function Exceptions(){this.name="Exceptions"}return Exceptions.prototype.parse=function(bytes_array,constant_pool){this.num_exceptions=bytes_array.get_uint(2);var exc_refs=[];for(var i=0;i<this.num_exceptions;i++)exc_refs.push(bytes_array.get_uint(2));this.exceptions=exc_refs.map(function(ref){return constant_pool.get(ref).deref()})},Exceptions}();exports.Exceptions=Exceptions;var InnerClasses=function(){function InnerClasses(){this.name="InnerClasses"}return InnerClasses.prototype.parse=function(bytes_array,constant_pool){var num_classes=bytes_array.get_uint(2);this.classes=[];for(var i=0;i<num_classes;i++)this.classes.push(this.parse_class(bytes_array,constant_pool))},InnerClasses.prototype.parse_class=function(bytes_array,constant_pool){return{inner_info_index:bytes_array.get_uint(2),outer_info_index:bytes_array.get_uint(2),inner_name_index:bytes_array.get_uint(2),inner_access_flags:bytes_array.get_uint(2)}},InnerClasses}();exports.InnerClasses=InnerClasses;var ConstantValue=function(){function ConstantValue(){this.name="ConstantValue"}return ConstantValue.prototype.parse=function(bytes_array,constant_pool){this.ref=bytes_array.get_uint(2);var valref=constant_pool.get(this.ref);this.value=typeof valref.deref=="function"?valref.deref():valref.value},ConstantValue}();exports.ConstantValue=ConstantValue;var Synthetic=function(){function Synthetic(){this.name="Synthetic"}return Synthetic.prototype.parse=function(bytes_array,constant_pool){},Synthetic}();exports.Synthetic=Synthetic;var Deprecated=function(){function Deprecated(){this.name="Deprecated"}return Deprecated.prototype.parse=function(bytes_array,constant_pool){},Deprecated}();exports.Deprecated=Deprecated;var Signature=function(){function Signature(){this.name="Signature"}return Signature.prototype.parse=function(bytes_array,constant_pool,attr_len){this.raw_bytes=bytes_array.read(attr_len);var ref=util.read_uint(this.raw_bytes);this.sig=constant_pool.get(ref).value},Signature}();exports.Signature=Signature;var RuntimeVisibleAnnotations=function(){function RuntimeVisibleAnnotations(){this.name="RuntimeVisibleAnnotations"}return RuntimeVisibleAnnotations.prototype.parse=function(bytes_array,constant_pool,attr_len){this.raw_bytes=bytes_array.read(attr_len)},RuntimeVisibleAnnotations}();exports.RuntimeVisibleAnnotations=RuntimeVisibleAnnotations;var AnnotationDefault=function(){function AnnotationDefault(){this.name="AnnotationDefault"}return AnnotationDefault.prototype.parse=function(bytes_array,constant_pool,attr_len){this.raw_bytes=bytes_array.read(attr_len)},AnnotationDefault}();exports.AnnotationDefault=AnnotationDefault;var EnclosingMethod=function(){function EnclosingMethod(){this.name="EnclosingMethod"}return EnclosingMethod.prototype.parse=function(bytes_array,constant_pool){this.enc_class=constant_pool.get(bytes_array.get_uint(2)).deref();var method_ref=bytes_array.get_uint(2);method_ref>0&&(this.enc_method=constant_pool.get(method_ref).deref())},EnclosingMethod}();exports.EnclosingMethod=EnclosingMethod,exports.make_attributes=make_attributes}),define("src/natives",["require","exports","./gLong","./util","./java_object","./exceptions","./logging","./threading"],function(require,exports,__gLong__,__util__,__java_object__,__exceptions__,__logging__,__threading__){function instantiate(rcd,pcd,acd){ReferenceClassData=rcd,PrimitiveClassData=pcd,ArrayClassData=acd}function get_property(rs,jvm_key,_default){_default===undefined&&(_default=null);var key=jvm_key.jvm2js_str(),val=rs.jvm_state.system_properties[key];return key==="java.class.path"?rs.init_string(val.slice(0,val.length-1).join(":")):val!=null?rs.init_string(val,!0):_default}function o(fn_name,fn){return{fn_name:fn_name,fn:fn}}function doPrivileged(rs,action){var my_sf=rs.curr_frame(),m=action.cls.method_lookup(rs,"run()Ljava/lang/Object;");if(m!=null)throw m.access_flags["static"]||rs.push(action),m.setup_stack(rs),my_sf.runner=function(){var rv=rs.pop();rs.meta_stack().pop(),rs.push(rv)},exceptions.ReturnException;rs.async_op(function(resume_cb,except_cb){action.cls.resolve_method(rs,"run()Ljava/lang/Object;",function(){rs.meta_stack().push({}),resume_cb()},except_cb)})}function stat_file(fname,cb){fs.stat(fname,function(err,stat){err!=null?cb(null):cb(stat)})}function arraycopy_no_check(src,src_pos,dest,dest_pos,length){var j=dest_pos,end=src_pos+length;for(var i=src_pos;i<end;i++)dest.array[j++]=src.array[i]}function arraycopy_check(rs,src,src_pos,dest,dest_pos,length){var j=dest_pos,end=src_pos+length,dest_comp_cls=dest.cls.get_component_class();for(var i=src_pos;i<end;i++){if(src.array[i]===null||src.array[i].cls.is_castable(dest_comp_cls))dest.array[j]=src.array[i];else{var exc_cls=rs.get_bs_class("Ljava/lang/ArrayStoreException;");rs.java_throw(exc_cls,"Array element in src cannot be cast to dest array type.")}j++}}function unsafe_memcpy(rs,src_base,src_offset_l,dest_base,dest_offset_l,num_bytes_l){var num_bytes=num_bytes_l.toNumber();if(src_base!=null){var src_offset=src_offset_l.toNumber();if(dest_base!=null)return arraycopy_no_check(src_base,src_offset,dest_base,dest_offset_l.toNumber(),num_bytes);var dest_addr=rs.block_addr(dest_offset_l);if(typeof DataView!="undefined"&&DataView!==null)for(var i=0;i<num_bytes;i++)rs.mem_blocks[dest_addr].setInt8(i,src_base.array[src_offset+i]);else for(var i=0;i<num_bytes;i++)rs.mem_blocks[dest_addr+i]=src_base.array[src_offset+i]}else{var src_addr=rs.block_addr(src_offset_l);if(dest_base!=null){var dest_offset=dest_offset_l.toNumber();if(typeof DataView!="undefined"&&DataView!==null)for(var i=0;i<num_bytes;i++)dest_base.array[dest_offset+i]=rs.mem_blocks[src_addr].getInt8(i);else for(var i=0;i<num_bytes;i++)dest_base.array[dest_offset+i]=rs.mem_blocks[src_addr+i]}else{var dest_addr=rs.block_addr(dest_offset_l);if(typeof DataView!="undefined"&&DataView!==null)for(var i=0;i<num_bytes;i++)rs.mem_blocks[dest_addr].setInt8(i,rs.mem_blocks[src_addr].getInt8(i));else for(var i=0;i<num_bytes;i++)rs.mem_blocks[dest_addr+i]=rs.mem_blocks[src_addr+i]}}}function unsafe_compare_and_swap(rs,_this,obj,offset,expected,x){var actual=obj.get_field_from_offset(rs,offset);return actual===expected?(obj.set_field_from_offset(rs,offset,x),!0):!1}function native_define_class(rs,name,bytes,offset,len,loader,resume_cb,except_cb){var buff=new Buffer(len),b_array=bytes.array;for(var i=offset;i<offset+len;i++)buff.writeUInt8((256+b_array[i])%256,i);loader.define_class(rs,util.int_classname(name.jvm2js_str()),buff,function(cdata){resume_cb(cdata.get_class_object(rs))},except_cb)}function write_to_file(rs,_this,bytes,offset,len){var buf,fd,fd_obj;fd_obj=_this.get_field(rs,"Ljava/io/FileOutputStream;fd"),fd=fd_obj.get_field(rs,"Ljava/io/FileDescriptor;fd"),fd===-1&&rs.java_throw(rs.get_bs_class("Ljava/io/IOException;"),"Bad file descriptor");if(fd!==1&&fd!==2){buf=new Buffer(bytes.array),rs.async_op(function(cb){return fs.write(fd,buf,offset,len,_this.$pos,function(err,num_bytes){return _this.$pos+=num_bytes,cb()})});return}rs.print(util.chars2js_str(bytes,offset,len));if(typeof node!="undefined"&&node!==null)return rs.async_op(function(cb){return cb()})}function get_cl_from_jclo(rs,jclo){return jclo!=null&&jclo.$loader!=null?jclo.$loader:rs.get_bs_cl()}function create_stack_trace(rs,throwable){var source_file,_ref8,stacktrace=[],cstack=rs.meta_stack()._cs.slice(1,-1);for(var i=0;i<cstack.length;i++){var sf=cstack[i];if(!!sf["native"]||sf.locals[0]===throwable)continue;var cls=sf.method.cls,ln=-1;if(throwable.cls.get_type()!=="Ljava/lang/NoClassDefFoundError;")if(sf.method.access_flags["native"])source_file="Native Method";else{var src_attr=cls.get_attribute("SourceFile");source_file=src_attr!=null?src_attr.filename:"unknown";var code=sf.method.code,table;code!=null&&(table=code.get_attribute("LineNumberTable"));if(table==null)break;for(var k in table.entries){var row=table.entries[k];row.start_pc<=sf.pc&&(ln=row.line_number)}}else source_file="unknown";stacktrace.push(new JavaObject(rs,rs.get_bs_class("Ljava/lang/StackTraceElement;"),{"Ljava/lang/StackTraceElement;declaringClass":rs.init_string(util.ext_classname(cls.get_type())),"Ljava/lang/StackTraceElement;methodName":rs.init_string((_ref8=sf.method.name)!=null?_ref8:"unknown"),"Ljava/lang/StackTraceElement;fileName":rs.init_string(source_file),"Ljava/lang/StackTraceElement;lineNumber":ln}))}return stacktrace.reverse()}function verify_array(rs,obj){if(!(obj instanceof java_object.JavaArray)){var err_cls=this.get_bs_class("Ljava/lang/IllegalArgumentException;");this.java_throw(err_cls,"Object is not an array.")}return obj}function array_get(rs,arr,idx){var array,err_cls;return array=rs.check_null(arr).array,0<=idx&&idx<array.length||(err_cls=rs.get_bs_class("Ljava/lang/ArrayIndexOutOfBoundsException;"),rs.java_throw(err_cls,"Tried to access an illegal index in an array.")),array[idx]}function next_address(){return next_host_address++,next_host_address>4194304e3&&(error("Out of addresses"),next_host_address=4026531840),next_host_address}function pack_address(address){var i,ret,_i;ret=0;for(i=_i=3;_i>=0;i=_i+=-1)ret|=address[i]&255,ret<<=8;return ret}function host_allocate_address(address){var ret;return ret=next_address(),host_lookup[ret]=address,host_reverse_lookup[address]=ret,ret}function websocket_status_to_message(status){switch(status){case 1e3:return"Normal closure";case 1001:return"Endpoint is going away";case 1002:return"WebSocket protocol error";case 1003:return"Server received invalid data"}return"Unknown status code or error"}function socket_read_async(impl,b,offset,len,resume_cb){var available,i,read,trimmed_len,_i;available=impl.$ws.rQlen(),trimmed_len=available<len?available:len,read=impl.$ws.rQshiftBytes(trimmed_len);for(i=_i=0;_i<trimmed_len;i=_i+=1)b.array[offset++]=read[i];return resume_cb(trimmed_len)}function setup_caller_stack(rs,method,obj,params){var i,p,p_type,primitive_value,_i,_len,_ref5;method.access_flags["static"]||rs.push(obj),i=0,_ref5=method.param_types;for(_i=0,_len=_ref5.length;_i<_len;_i++)p_type=_ref5[_i],p=params.array[i++],p_type==="J"||p_type==="D"?(p!=null?p.ref:void 0)!=null?(primitive_value=p.get_field(rs,p.cls.get_type()+"value"),rs.push2(primitive_value,null)):(rs.push2(p,null),i++):util.is_primitive_type(p_type)?(p!=null?p.ref:void 0)!=null?(primitive_value=p.get_field(rs,p.cls.get_type()+"value"),rs.push(primitive_value)):rs.push(p):rs.push(p);return rs.curr_frame()}function flatten_pkg(pkg){var pkg_name_arr,rec_flatten,result;return result={},pkg_name_arr=[],rec_flatten=function(pkg){var flattened_inner,fn,fn_name,full_name,full_pkg_name,inner_pkg,method,pkg_name,_i,_len;for(pkg_name in pkg){inner_pkg=pkg[pkg_name],pkg_name_arr.push(pkg_name);if(inner_pkg instanceof Array){full_pkg_name=pkg_name_arr.join("/");for(_i=0,_len=inner_pkg.length;_i<_len;_i++)method=inner_pkg[_i],fn_name=method.fn_name,fn=method.fn,fn_name=fn_name.replace(/!|;/g,function(){var depth;return depth=0,function(c){return c==="!"?pkg_name_arr[depth++]:c===";"?(depth=0,c):c}}()),full_name="L"+full_pkg_name+";::"+fn_name,result[full_name]=fn}else flattened_inner=rec_flatten(inner_pkg);pkg_name_arr.pop(pkg_name)}},rec_flatten(pkg),result}var gLong=__gLong__,util=__util__,java_object=__java_object__,JavaObject=java_object.JavaObject,JavaArray=java_object.JavaArray,exceptions=__exceptions__,logging=__logging__,threading=__threading__,debug=logging.debug,error=logging.error,trace=logging.trace,path=typeof node!="undefined"?node.path:require("path"),fs=typeof node!="undefined"?node.fs:require("fs"),ReferenceClassData,PrimitiveClassData,ArrayClassData;exports.instantiated,exports.instantiated=!1,exports.instantiate=instantiate,exports.trapped_methods={java:{lang:{ref:{Reference:[o("<clinit>()V",function(rs){})]},String:[o("hashCode()I",function(rs,_this){var chars,count,hash,i,offset,_i;hash=_this.get_field(rs,"Ljava/lang/String;hash");if(hash===0){offset=_this.get_field(rs,"Ljava/lang/String;offset"),chars=_this.get_field(rs,"Ljava/lang/String;value").array,count=_this.get_field(rs,"Ljava/lang/String;count");for(i=_i=0;_i<count;i=_i+=1)hash=hash*31+chars[offset++]|0;_this.set_field(rs,"Ljava/lang/String;hash",hash)}return hash})],System:[o("loadLibrary(L!/!/String;)V",function(rs,lib_name){var lib=lib_name.jvm2js_str();if(lib!=="zip"&&lib!=="net"&&lib!=="nio"&&lib!=="awt"&&lib!=="fontmanager")return rs.java_throw(rs.get_bs_class("Ljava/lang/UnsatisfiedLinkError;"),"no "+lib+" in java.library.path")}),o("adjustPropertiesForBackwardCompatibility(L!/util/Properties;)V",function(rs){}),o("getProperty(L!/!/String;)L!/!/String;",get_property),o("getProperty(L!/!/String;L!/!/String;)L!/!/String;",get_property)],Terminator:[o("setup()V",function(rs){})]},util:{concurrent:{atomic:{AtomicInteger:[o("<clinit>()V",function(rs){}),o("compareAndSet(II)Z",function(rs,_this,expect,update){return _this.set_field(rs,"Ljava/util/concurrent/atomic/AtomicInteger;value",update),!0})]}}},nio:{Bits:[o("byteOrder()L!/!/ByteOrder;",function(rs){var cls=rs.get_bs_class("Ljava/nio/ByteOrder;");return cls.static_get(rs,"LITTLE_ENDIAN")}),o("copyToByteArray(JLjava/lang/Object;JJ)V",function(rs,srcAddr,dst,dstPos,length){unsafe_memcpy(rs,null,srcAddr,dst,dstPos,length)})],charset:{Charset$3:[o("run()L!/lang/Object;",function(rs){return null})]}}}},exports.native_methods={classes:{awt:{CanvasGraphicsEnvironment:[]},doppio:{JavaScript:[o("eval(Ljava/lang/String;)Ljava/lang/String;",function(rs,to_eval){var rv=eval(to_eval.jvm2js_str());return rv!=null?rs.init_string(""+rv):null})],Debug:[o("SetLogLevel(L!/!/!$LogLevel;)V",function(rs,loglevel){logging.log_level=loglevel.get_field(rs,"Lclasses/doppio/Debug$LogLevel;level")}),o("GetLogLevel()L!/!/!$LogLevel;",function(rs){var ll_cls=rs.get_bs_class("Lclasses/doppio/Debug$LogLevel;");switch(logging.log_level){case 10:return ll_cls.static_get(rs,"VTRACE");case 9:return ll_cls.static_get(rs,"TRACE");case 5:return ll_cls.static_get(rs,"DEBUG");default:return ll_cls.static_get(rs,"ERROR")}})]}},java:{lang:{ClassLoader:[o("findLoadedClass0(L!/!/String;)L!/!/Class;",function(rs,_this,name){var cls,loader,type;return loader=get_cl_from_jclo(rs,_this),type=util.int_classname(name.jvm2js_str()),cls=loader.get_resolved_class(type,!0),cls!=null?cls.get_class_object(rs):null}),o("findBootstrapClass(L!/!/String;)L!/!/Class;",function(rs,_this,name){var type=util.int_classname(name.jvm2js_str());rs.async_op(function(resume_cb,except_cb){rs.get_bs_cl().resolve_class(rs,type,function(cls){resume_cb(cls.get_class_object(rs))},except_cb,!0)})}),o("getCaller(I)L!/!/Class;",function(rs,i){var cls=rs.meta_stack().get_caller(i).method.cls;return cls.get_class_object(rs)}),o("defineClass1(L!/!/String;[BIIL!/security/ProtectionDomain;L!/!/String;Z)L!/!/Class;",function(rs,_this,name,bytes,offset,len,pd,source,unused){var loader=get_cl_from_jclo(rs,_this);rs.async_op(function(resume_cb,except_cb){native_define_class(rs,name,bytes,offset,len,loader,resume_cb,except_cb)})}),o("defineClass1(L!/!/String;[BIIL!/security/ProtectionDomain;L!/!/String;)L!/!/Class;",function(rs,_this,name,bytes,offset,len,pd,source){var loader=get_cl_from_jclo(rs,_this);rs.async_op(function(resume_cb,except_cb){native_define_class(rs,name,bytes,offset,len,loader,resume_cb,except_cb)})}),o("resolveClass0(L!/!/Class;)V",function(rs,_this,cls){var loader,type;loader=get_cl_from_jclo(rs,_this),type=cls.$cls.get_type();if(loader.get_resolved_class(type,true)!=null)return;rs.async_op(function(resume_cb,except_cb){loader.resolve_class(rs,type,function(){resume_cb()},except_cb,!0)})})],Compiler:[o("disable()V",function(rs,_this){}),o("enable()V",function(rs,_this){})],Float:[o("floatToRawIntBits(F)I",function(rs,f_val){var exp,f_view,i_view,sig,sign;return typeof Float32Array!="undefined"&&Float32Array!==null?(f_view=new Float32Array([f_val]),i_view=new Int32Array(f_view.buffer),i_view[0]):f_val===0?0:f_val===Number.POSITIVE_INFINITY?util.FLOAT_POS_INFINITY_AS_INT:f_val===Number.NEGATIVE_INFINITY?util.FLOAT_NEG_INFINITY_AS_INT:isNaN(f_val)?util.FLOAT_NaN_AS_INT:(sign=f_val<0?1:0,f_val=Math.abs(f_val),f_val<=1.1754942106924411e-38&&f_val>=1.401298464324817e-45?(exp=0,sig=Math.round(f_val/Math.pow(2,-126)*Math.pow(2,23)),sign<<31|exp<<23|sig):(exp=Math.floor(Math.log(f_val)/Math.LN2),sig=Math.round((f_val/Math.pow(2,exp)-1)*Math.pow(2,23)),sign<<31|exp+127<<23|sig))}),o("intBitsToFloat(I)F",function(rs,i_val){return util.intbits2float(i_val)})],Double:[o("doubleToRawLongBits(D)J",function(rs,d_val){var d_view,exp,high_bits,i_view,sig,sign;return typeof Float64Array!="undefined"&&Float64Array!==null?(d_view=new Float64Array([d_val]),i_view=new Uint32Array(d_view.buffer),gLong.fromBits(i_view[0],i_view[1])):d_val===0?gLong.ZERO:d_val===Number.POSITIVE_INFINITY?gLong.fromBits(0,2146435072):d_val===Number.NEGATIVE_INFINITY?gLong.fromBits(0,-1048576):isNaN(d_val)?gLong.fromBits(0,2146959360):(sign=d_val<0?1<<31:0,d_val=Math.abs(d_val),d_val<=2.225073858507201e-308&&d_val>=5e-324?(exp=0,sig=gLong.fromNumber(d_val/Math.pow(2,-1022)*Math.pow(2,52))):(exp=Math.floor(Math.log(d_val)/Math.LN2),d_val<Math.pow(2,exp)&&(exp-=1),sig=gLong.fromNumber((d_val/Math.pow(2,exp)-1)*Math.pow(2,52)),exp=exp+1023<<20),high_bits=sig.getHighBits()|sign|exp,gLong.fromBits(sig.getLowBits(),high_bits))}),o("longBitsToDouble(J)D",function(rs,l_val){return util.longbits2double(l_val.getHighBits(),l_val.getLowBitsUnsigned())})],Object:[o("getClass()L!/!/Class;",function(rs,_this){return _this.cls.get_class_object(rs)}),o("hashCode()I",function(rs,_this){return _this.ref}),o("clone()L!/!/!;",function(rs,_this){return _this.clone(rs)}),o("notify()V",function(rs,_this){var locker;debug("TE(notify): on lock *"+_this.ref);if((locker=rs.lock_refs[_this.ref])!=null&&locker!==rs.curr_thread){var owner=locker.name(rs);rs.java_throw(rs.get_bs_class("Ljava/lang/IllegalMonitorStateException;"),"Thread '"+owner+"' owns this monitor")}rs.waiting_threads[_this.ref]!=null&&rs.waiting_threads[_this.ref].shift()}),o("notifyAll()V",function(rs,_this){var locker;debug("TE(notifyAll): on lock *"+_this.ref);if((locker=rs.lock_refs[_this.ref])!=null&&locker!==rs.curr_thread){var owner=locker.name(rs);rs.java_throw(rs.get_bs_class("Ljava/lang/IllegalMonitorStateException;"),"Thread '"+owner+"' owns this monitor")}rs.waiting_threads[_this.ref]!=null&&(rs.waiting_threads[_this.ref]=[])}),o("wait(J)V",function(rs,_this,timeout){var locker;timeout!==gLong.ZERO&&error("TODO(Object::wait): respect the timeout param ("+timeout+")");if((locker=rs.lock_refs[_this.ref])!=null&&locker!==rs.curr_thread){var owner=locker.name(rs);rs.java_throw(rs.get_bs_class("Ljava/lang/IllegalMonitorStateException;"),"Thread '"+owner+"' owns this monitor")}rs.lock_refs[_this.ref]=null,rs.wait(_this)})],Package:[o("getSystemPackage0(Ljava/lang/String;)Ljava/lang/String;",function(rs,pkg_name_obj){var pkg_name=pkg_name_obj.jvm2js_str();return rs.get_bs_cl().get_package_names().indexOf(pkg_name)>=0?pkg_name_obj:null}),o("getSystemPackages0()[Ljava/lang/String;",function(rs){var cls_name;return new JavaArray(rs,rs.get_bs_class("[Ljava/lang/String;"),function(){var _i,_len,_ref5,_results;_ref5=rs.get_bs_cl().get_package_names(),_results=[];for(_i=0,_len=_ref5.length;_i<_len;_i++)cls_name=_ref5[_i],_results.push(rs.init_string(cls_name));return _results}())})],ProcessEnvironment:[o("environ()[[B",function(rs){var env_arr,k,v,_ref5;env_arr=[],_ref5=process.env;for(k in _ref5)v=_ref5[k],env_arr.push(new JavaArray(rs,rs.get_bs_class("[B"),util.bytestr_to_array(k))),env_arr.push(new JavaArray(rs,rs.get_bs_class("[B"),util.bytestr_to_array(v)));return new JavaArray(rs,rs.get_bs_class("[[B"),env_arr)})],reflect:{Array:[o("multiNewArray(L!/!/Class;[I)L!/!/Object;",function(rs,jco,lens){var _this=this,counts=lens.array,cls=rs.get_class(jco.$cls.get_type(),!0);if(cls==null){rs.async_op(function(resume_cb,except_cb){rs.get_cl().initialize_class(rs,jco.$cls.get_type(),function(cls){var type_str=(new Array(counts.length+1)).join("[")+cls.get_type();rs.heap_multinewarray(type_str,counts),resume_cb()},except_cb)});return}var type_str=(new Array(counts.length+1)).join("[")+cls.get_type();return rs.heap_multinewarray(type_str,counts)}),o("newArray(L!/!/Class;I)L!/!/Object;",function(rs,_this,len){return rs.heap_newarray(_this.$cls.get_type(),len)}),o("getLength(Ljava/lang/Object;)I",function(rs,obj){var arr=verify_array(rs,obj);return rs.check_null(arr).array.length}),o("getBoolean(Ljava/lang/Object;I)Z",array_get),o("getByte(Ljava/lang/Object;I)B",array_get),o("getChar(Ljava/lang/Object;I)C",array_get),o("getDouble(Ljava/lang/Object;I)D",array_get),o("getFloat(Ljava/lang/Object;I)F",array_get),o("getInt(Ljava/lang/Object;I)I",array_get),o("getLong(Ljava/lang/Object;I)J",array_get),o("getShort(Ljava/lang/Object;I)S",array_get),o("get(Ljava/lang/Object;I)Ljava/lang/Object;",function(rs,arr,idx){var val;return val=array_get(rs,arr,idx),val.ref==null?arr.cls.get_component_class().create_wrapper_object(rs,val):val}),o("set(Ljava/lang/Object;ILjava/lang/Object;)V",function(rs,obj,idx,val){var array,ccls,ccname,ecls,illegal_exc,m,my_sf,arr=verify_array(rs,obj);my_sf=rs.curr_frame(),array=rs.check_null(arr).array,0<=idx&&idx<array.length||rs.java_throw(rs.get_bs_class("Ljava/lang/ArrayIndexOutOfBoundsException;"),"Tried to write to an illegal index in an array.");if((ccls=arr.cls.get_component_class())instanceof PrimitiveClassData){if(val.cls.is_subclass(rs.get_bs_class(ccls.box_class_name())))throw ccname=ccls.get_type(),m=val.cls.method_lookup(rs,""+util.internal2external[ccname]+"Value()"+ccname),rs.push(val),m.setup_stack(rs),my_sf.runner=function(){return array[idx]=ccname==="J"||ccname==="D"?rs.pop2():rs.pop(),rs.meta_stack().pop()},exceptions.ReturnException}else if(val.cls.is_subclass(ccls)){array[idx]=val;return}return illegal_exc="Ljava/lang/IllegalArgumentException;",(ecls=rs.get_bs_class(illegal_exc,true))!=null?rs.java_throw(ecls,"argument type mismatch"):rs.async_op(function(resume_cb,except_cb){return rs.get_cl().initialize_class(rs,illegal_exc,function(ecls){return except_cb(function(){return rs.java_throw(ecls,"argument type mismatch")})},except_cb)})})],Proxy:[o("defineClass0(L!/!/ClassLoader;L!/!/String;[BII)L!/!/Class;",function(rs,cl,name,bytes,offset,len){return rs.async_op(function(success_cb,except_cb){return native_define_class(rs,name,bytes,offset,len,get_cl_from_jclo(rs,cl),success_cb,except_cb)})})]},SecurityManager:[o("getClassContext()[Ljava/lang/Class;",function(rs,_this){var classes,sf,_i,_ref5;classes=[],_ref5=rs.meta_stack()._cs;for(_i=_ref5.length-1;_i>=0;_i+=-1)sf=_ref5[_i],sf["native"]||classes.push(sf.method.cls.get_class_object(rs));return new JavaArray(rs,rs.get_bs_class("[Ljava/lang/Class;"),classes)})],Shutdown:[o("halt0(I)V",function(rs,status){throw new exceptions.HaltException(status)})],StrictMath:[o("acos(D)D",function(rs,d_val){return Math.acos(d_val)}),o("asin(D)D",function(rs,d_val){return Math.asin(d_val)}),o("atan(D)D",function(rs,d_val){return Math.atan(d_val)}),o("atan2(DD)D",function(rs,y,x){return Math.atan2(y,x)}),o("cbrt(D)D",function(rs,d_val){var is_neg;return is_neg=d_val<0,is_neg?-Math.pow(-d_val,1/3):Math.pow(d_val,1/3)}),o("cos(D)D",function(rs,d_val){return Math.cos(d_val)}),o("exp(D)D",function(rs,d_val){return Math.exp(d_val)}),o("log(D)D",function(rs,d_val){return Math.log(d_val)}),o("log10(D)D",function(rs,d_val){return Math.log(d_val)/Math.LN10}),o("pow(DD)D",function(rs,base,exp){return Math.pow(base,exp)}),o("sin(D)D",function(rs,d_val){return Math.sin(d_val)}),o("sqrt(D)D",function(rs,d_val){return Math.sqrt(d_val)}),o("tan(D)D",function(rs,d_val){return Math.tan(d_val)}),o("floor(D)D",function(rs,d_val){return Math.floor(d_val)}),o("ceil(D)D",function(rs,d_val){return Math.ceil(d_val)})],String:[o("intern()L!/!/!;",function(rs,_this){var js_str=_this.jvm2js_str(),s=rs.string_pool.get(js_str);return s==null?(rs.string_pool.set(js_str,_this),_this):s})],System:[o("arraycopy(L!/!/Object;IL!/!/Object;II)V",function(rs,src,src_pos,dest,dest_pos,length){var dest_comp_cls,src_comp_cls;return(src==null||dest==null)&&rs.java_throw(rs.get_bs_class("Ljava/lang/NullPointerException;"),"Cannot copy to/from a null array."),(!(src.cls instanceof ArrayClassData)||!(dest.cls instanceof ArrayClassData))&&rs.java_throw(rs.get_bs_class("Ljava/lang/ArrayStoreException;"),"src and dest arguments must be of array type."),(src_pos<0||src_pos+length>src.array.length||dest_pos<0||dest_pos+length>dest.array.length||length<0)&&rs.java_throw(rs.get_bs_class("Ljava/lang/ArrayIndexOutOfBoundsException;"),"Tried to write to an illegal index in an array."),src===dest&&(src={cls:src.cls,array:src.array.slice(src_pos,src_pos+length)},src_pos=0),src.cls.is_castable(dest.cls)?arraycopy_no_check(src,src_pos,dest,dest_pos,length):(src_comp_cls=src.cls.get_component_class(),dest_comp_cls=dest.cls.get_component_class(),src_comp_cls instanceof PrimitiveClassData||dest_comp_cls instanceof PrimitiveClassData?rs.java_throw(rs.get_bs_class("Ljava/lang/ArrayStoreException;"),"If calling arraycopy with a primitive array, both src and dest must be of the same primitive type."):arraycopy_check(rs,src,src_pos,dest,dest_pos,length))}),o("currentTimeMillis()J",function(rs){return gLong.fromNumber((new Date).getTime())}),o("identityHashCode(L!/!/Object;)I",function(rs,x){var _ref5;return(_ref5=x!=null?x.ref:void 0)!=null?_ref5:0}),o("initProperties(L!/util/Properties;)L!/util/Properties;",function(rs,props){return rs.push(null)}),o("nanoTime()J",function(rs){return gLong.fromNumber((new Date).getTime()).multiply(gLong.fromNumber(1e6))}),o("setIn0(L!/io/InputStream;)V",function(rs,stream){var sys;return sys=rs.get_bs_class("Ljava/lang/System;"),sys.static_put(rs,"in",stream)}),o("setOut0(L!/io/PrintStream;)V",function(rs,stream){var sys;return sys=rs.get_bs_class("Ljava/lang/System;"),sys.static_put(rs,"out",stream)}),o("setErr0(L!/io/PrintStream;)V",function(rs,stream){var sys;return sys=rs.get_bs_class("Ljava/lang/System;"),sys.static_put(rs,"err",stream)})],Thread:[o("currentThread()L!/!/!;",function(rs){return rs.curr_thread}),o("setPriority0(I)V",function(rs){}),o("holdsLock(L!/!/Object;)Z",function(rs,obj){return rs.curr_thread===rs.lock_refs[obj.ref]}),o("isAlive()Z",function(rs,_this){var _ref5;return(_ref5=_this.$isAlive)!=null?_ref5:!1}),o("isInterrupted(Z)Z",function(rs,_this,clear_flag){var tmp,_ref5;return tmp=(_ref5=_this.$isInterrupted)!=null?_ref5:!1,clear_flag&&(_this.$isInterrupted=!1),tmp}),o("interrupt0()V",function(rs,_this){var new_thread_sf;_this.$isInterrupted=!0;if(_this===rs.curr_thread)return;if(rs.parked(_this)){rs.yield(_this);return}throw debug("TE(interrupt0): interrupting "+_this.name(rs)),new_thread_sf=util.last(_this.$meta_stack._cs),new_thread_sf.runner=function(){return rs.java_throw(rs.get_bs_class("Ljava/lang/InterruptedException;"),"interrupt0 called")},_this.$meta_stack.push({}),rs.yield(_this),exceptions.ReturnException}),o("start0()V",function(rs,_this){var new_thread_sf,old_thread_sf,run_method,thread_runner_sf;throw _this.$isAlive=!0,_this.$meta_stack=new threading.CallStack,rs.thread_pool.push(_this),old_thread_sf=rs.curr_frame(),debug("TE(start0): starting "+_this.name(rs)+" from "+rs.curr_thread.name(rs)),rs.curr_thread=_this,new_thread_sf=rs.curr_frame(),rs.push(_this),run_method=_this.cls.method_lookup(rs,"run()V"),thread_runner_sf=run_method.setup_stack(rs),new_thread_sf.runner=function(){return new_thread_sf.runner=null,_this.$isAlive=!1,debug("TE(start0): thread died: "+_this.name(rs))},old_thread_sf.runner=function(){return debug("TE(start0): thread resumed: "+rs.curr_thread.name(rs)),rs.meta_stack().pop()},exceptions.ReturnException}),o("sleep(J)V",function(rs,millis){return rs.curr_thread.wakeup_time=(new Date).getTime()+millis.toNumber(),rs.async_op(function(resume_cb){return rs.choose_next_thread(null,function(next_thread){return rs.yield(next_thread),resume_cb()})})}),o("yield()V",function(rs,_this){return rs.async_op(function(resume_cb){return rs.choose_next_thread(null,function(next_thread){return rs.yield(next_thread),resume_cb()})})})],Throwable:[o("fillInStackTrace()L!/!/!;",function(rs,_this){var strace;return strace=new JavaArray(rs,rs.get_bs_class("[Ljava/lang/StackTraceElement;"),create_stack_trace(rs,_this)),_this.set_field(rs,"Ljava/lang/Throwable;stackTrace",strace),_this}),o("getStackTraceDepth()I",function(rs,_this){return create_stack_trace(rs,_this).length}),o("getStackTraceElement(I)L!/!/StackTraceElement;",function(rs,_this,depth){return create_stack_trace(rs,_this)[depth]})],UNIXProcess:[o("forkAndExec([B[BI[BI[BZLjava/io/FileDescriptor;Ljava/io/FileDescriptor;Ljava/io/FileDescriptor;)I",function(rs,_this,prog,argBlock){var args,progname;return progname=util.chars2js_str(prog,0,prog.array.length),args=util.chars2js_str(argBlock,0,argBlock.array.length),rs.java_throw(rs.get_bs_class("Ljava/lang/Error;"),"Doppio doesn't support forking processes. Command was: `"+progname+" "+args+"`")})]},security:{AccessController:[o("doPrivileged(L!/!/PrivilegedAction;)L!/lang/Object;",doPrivileged),o("doPrivileged(L!/!/PrivilegedAction;L!/!/AccessControlContext;)L!/lang/Object;",doPrivileged),o("doPrivileged(L!/!/PrivilegedExceptionAction;)L!/lang/Object;",doPrivileged),o("doPrivileged(L!/!/PrivilegedExceptionAction;L!/!/AccessControlContext;)L!/lang/Object;",doPrivileged),o("getStackAccessControlContext()Ljava/security/AccessControlContext;",function(rs){return null})]},sql:{DriverManager:[o("getCallerClassLoader()Ljava/lang/ClassLoader;",function(rs){var rv;return rv=rs.meta_stack().get_caller(1).method.cls.loader.loader_obj,rv!==void 0?rv:null})]},io:{Console:[o("encoding()L!/lang/String;",function(){return null}),o("istty()Z",function(){return!0})],FileSystem:[o("getFileSystem()L!/!/!;",function(rs){var cache1,cache2,cache_init,cdata,my_sf;throw my_sf=rs.curr_frame(),cdata=rs.get_bs_class("Ljava/io/ExpiringCache;"),cache1=new JavaObject(rs,cdata),cache2=new JavaObject(rs,cdata),cache_init=cdata.method_lookup(rs,"<init>()V"),rs.push2(cache1,cache2),cache_init.setup_stack(rs),my_sf.runner=function(){return cache_init.setup_stack(rs),my_sf.runner=function(){var system_properties=rs.jvm_state.system_properties,rv=new JavaObject(rs,rs.get_bs_class("Ljava/io/UnixFileSystem;"),{"Ljava/io/UnixFileSystem;cache":cache1,"Ljava/io/UnixFileSystem;javaHomePrefixCache":cache2,"Ljava/io/UnixFileSystem;slash":system_properties["file.separator"].charCodeAt(0),"Ljava/io/UnixFileSystem;colon":system_properties["path.separator"].charCodeAt(0),"Ljava/io/UnixFileSystem;javaHome":rs.init_string(system_properties["java.home"],!0)});return rs.meta_stack().pop(),rs.push(rv)}},exceptions.ReturnException})],FileOutputStream:[o("open(L!/lang/String;)V",function(rs,_this,fname){return rs.async_op(function(resume_cb){return fs.open(fname.jvm2js_str(),"w",function(err,fd){var fd_obj;return fd_obj=_this.get_field(rs,"Ljava/io/FileOutputStream;fd"),fd_obj.set_field(rs,"Ljava/io/FileDescriptor;fd",fd),_this.$pos=0,resume_cb()})})}),o("openAppend(Ljava/lang/String;)V",function(rs,_this,fname){return rs.async_op(function(resume_cb){return fs.open(fname.jvm2js_str(),"a",function(err,fd){var fd_obj;return fd_obj=_this.get_field(rs,"Ljava/io/FileOutputStream;fd"),fd_obj.set_field(rs,"Ljava/io/FileDescriptor;fd",fd),fs.fstat(fd,function(err,stats){return _this.$pos=stats.size,resume_cb()})})})}),o("writeBytes([BIIZ)V",write_to_file),o("writeBytes([BII)V",write_to_file),o("close0()V",function(rs,_this){var fd,fd_obj;return fd_obj=_this.get_field(rs,"Ljava/io/FileOutputStream;fd"),fd=fd_obj.get_field(rs,"Ljava/io/FileDescriptor;fd"),rs.async_op(function(resume_cb,except_cb){return fs.close(fd,function(err){return err?except_cb(function(){return rs.java_throw(rs.get_bs_class("Ljava/io/IOException;"),err.message)}):(fd_obj.set_field(rs,"Ljava/io/FileDescriptor;fd",-1),resume_cb())})})})],FileInputStream:[o("available()I",function(rs,_this){var fd,fd_obj;return fd_obj=_this.get_field(rs,"Ljava/io/FileInputStream;fd"),fd=fd_obj.get_field(rs,"Ljava/io/FileDescriptor;fd"),-1===fd&&rs.java_throw(rs.get_bs_class("Ljava/io/IOException;"),"Bad file descriptor"),0===fd?0:rs.async_op(function(cb){return fs.fstat(fd,function(err,stats){return cb(stats.size-_this.$pos)})})}),o("read()I",function(rs,_this){var fd_obj=_this.get_field(rs,"Ljava/io/FileInputStream;fd"),fd=fd_obj.get_field(rs,"Ljava/io/FileDescriptor;fd");-1===fd&&rs.java_throw(rs.get_bs_class("Ljava/io/IOException;"),"Bad file descriptor"),0!==fd?rs.async_op(function(cb){return fs.fstat(fd,function(err,stats){var buf;return buf=new Buffer(stats.size),fs.read(fd,buf,0,1,_this.$pos,function(err,bytes_read){return _this.$pos++,cb(0===bytes_read?-1:buf.readUInt8(0))})})}):rs.async_op(function(cb){return rs.async_input(1,function(byte){return cb(0===byte.length?-1:byte[0])})})}),o("readBytes([BII)I",function(rs,_this,byte_arr,offset,n_bytes){var buf,pos,fd_obj=_this.get_field(rs,"Ljava/io/FileInputStream;fd"),fd=fd_obj.get_field(rs,"Ljava/io/FileDescriptor;fd");-1===fd&&rs.java_throw(rs.get_bs_class("Ljava/io/IOException;"),"Bad file descriptor"),0!==fd?(pos=_this.$pos,buf=new Buffer(n_bytes),rs.async_op(function(cb){return fs.read(fd,buf,0,n_bytes,pos,function(err,bytes_read){var i,_i;if(null!=err)return cb(-1);for(_this.$pos+=bytes_read,i=_i=0;bytes_read>_i;i=_i+=1)byte_arr.array[offset+i]=buf.readInt8(i);return cb(0===bytes_read&&0!==n_bytes?-1:bytes_read)})})):rs.async_op(function(cb){return rs.async_input(n_bytes,function(bytes){var b,idx,_i,_len;for(idx=_i=0,_len=bytes.length;_len>_i;idx=++_i)b=bytes[idx],byte_arr.array[offset+idx]=b;return cb(bytes.length)})})}),o("open(Ljava/lang/String;)V",function(rs,_this,filename){var filepath;return filepath=filename.jvm2js_str(),rs.async_op(function(resume_cb,except_cb){return fs.open(filepath,"r",function(e,fd){var fd_obj;return e!=null?e.code==="ENOENT"||!0?except_cb(function(){return rs.java_throw(rs.get_bs_class("Ljava/io/FileNotFoundException;"),""+filepath+" (No such file or directory)")}):except_cb(function(){throw e}):(fd_obj=_this.get_field(rs,"Ljava/io/FileInputStream;fd"),fd_obj.set_field(rs,"Ljava/io/FileDescriptor;fd",fd),_this.$pos=0,resume_cb())})})}),o("close0()V",function(rs,_this){var fd,fd_obj;return fd_obj=_this.get_field(rs,"Ljava/io/FileInputStream;fd"),fd=fd_obj.get_field(rs,"Ljava/io/FileDescriptor;fd"),rs.async_op(function(resume_cb,except_cb){return fs.close(fd,function(err){return err?except_cb(function(){return rs.java_throw(rs.get_bs_class("Ljava/io/IOException;"),err.message)}):(fd_obj.set_field(rs,"Ljava/io/FileDescriptor;fd",-1),resume_cb())})})}),o("skip(J)J",function(rs,_this,n_bytes){var fd_obj=_this.get_field(rs,"Ljava/io/FileInputStream;fd"),fd=fd_obj.get_field(rs,"Ljava/io/FileDescriptor;fd");-1===fd&&rs.java_throw(rs.get_bs_class("Ljava/io/IOException;"),"Bad file descriptor"),0!==fd?rs.async_op(function(cb){return fs.fstat(fd,function(err,stats){var bytes_left,to_skip;return bytes_left=stats.size-_this.$pos,to_skip=Math.min(n_bytes.toNumber(),bytes_left),_this.$pos+=to_skip,cb(gLong.fromNumber(to_skip),null)})}):rs.async_op(function(cb){return rs.async_input(n_bytes.toNumber(),function(bytes){return cb(gLong.fromNumber(bytes.length),null)})})})],ObjectInputStream:[o("latestUserDefinedLoader()Ljava/lang/ClassLoader;",function(rs){return null})],ObjectStreamClass:[o("initNative()V",function(rs){}),o("hasStaticInitializer(Ljava/lang/Class;)Z",function(rs,cls){return cls.$cls.get_method("<clinit>()V")!=null})],RandomAccessFile:[o("open(Ljava/lang/String;I)V",function(rs,_this,filename,mode){var filepath,mode_str;return filepath=filename.jvm2js_str(),mode_str=function(){switch(mode){case 1:return"r";case 2:return"r+";case 4:case 8:return"rs+"}}(),rs.async_op(function(resume_cb,except_cb){return fs.open(filepath,mode_str,function(e,fd){var fd_obj;return e!=null?e.code==="ENOENT"||!0?except_cb(function(){return rs.java_throw(rs.get_bs_class("Ljava/io/FileNotFoundException;"),"Could not open file "+filepath)}):except_cb(function(){throw e}):(fd_obj=_this.get_field(rs,"Ljava/io/RandomAccessFile;fd"),fd_obj.set_field(rs,"Ljava/io/FileDescriptor;fd",fd),_this.$pos=0,resume_cb())})})}),o("getFilePointer()J",function(rs,_this){return gLong.fromNumber(_this.$pos)}),o("length()J",function(rs,_this){var fd,fd_obj;return fd_obj=_this.get_field(rs,"Ljava/io/RandomAccessFile;fd"),fd=fd_obj.get_field(rs,"Ljava/io/FileDescriptor;fd"),rs.async_op(function(cb){return fs.fstat(fd,function(err,stats){return cb(gLong.fromNumber(stats.size),null)})})}),o("seek(J)V",function(rs,_this,pos){return _this.$pos=pos.toNumber()}),o("readBytes([BII)I",function(rs,_this,byte_arr,offset,len){var fd_obj=_this.get_field(rs,"Ljava/io/RandomAccessFile;fd"),fd=fd_obj.get_field(rs,"Ljava/io/FileDescriptor;fd"),buf=new Buffer(len);rs.async_op(function(cb){fs.read(fd,buf,0,len,_this.$pos,function(err,bytes_read){var i,_i;if(null!=err)return cb(-1);for(i=_i=0;bytes_read>_i;i=_i+=1)byte_arr.array[offset+i]=buf.readInt8(i);return _this.$pos+=bytes_read,cb(0===bytes_read&&0!==len?-1:bytes_read)})})}),o("writeBytes([BII)V",function(rs,_this,byte_arr,offset,len){var fd_obj=_this.get_field(rs,"Ljava/io/RandomAccessFile;fd"),fd=fd_obj.get_field(rs,"Ljava/io/FileDescriptor;fd"),buf=new Buffer(byte_arr.array);rs.async_op(function(cb){fs.write(fd,buf,offset,len,_this.$pos,function(err,num_bytes){_this.$pos+=num_bytes,cb()})})}),o("close0()V",function(rs,_this){var fd,fd_obj;return fd_obj=_this.get_field(rs,"Ljava/io/RandomAccessFile;fd"),fd=fd_obj.get_field(rs,"Ljava/io/FileDescriptor;fd"),rs.async_op(function(resume_cb,except_cb){return fs.close(fd,function(err){return err?except_cb(function(){return rs.java_throw(rs.get_bs_class("Ljava/io/IOException;"),err.message)}):(fd_obj.set_field(rs,"Ljava/io/FileDescriptor;fd",-1),resume_cb())})})})],UnixFileSystem:[o("canonicalize0(L!/lang/String;)L!/lang/String;",function(rs,_this,jvm_path_str){var js_str;return js_str=jvm_path_str.jvm2js_str(),rs.init_string(path.resolve(path.normalize(js_str)))}),o("checkAccess(Ljava/io/File;I)Z",function(rs,_this,file,access){var filepath;return filepath=file.get_field(rs,"Ljava/io/File;path"),rs.async_op(function(resume_cb){return stat_file(filepath.jvm2js_str(),function(stats){var mask;return stats==null?resume_cb(!1):(mask=access|access<<3|access<<6,resume_cb((stats.mode&mask)>0))})})}),o("createDirectory(Ljava/io/File;)Z",function(rs,_this,file){var filepath;return filepath=file.get_field(rs,"Ljava/io/File;path").jvm2js_str(),rs.async_op(function(resume_cb){return stat_file(filepath,function(stat){return stat!=null?resume_cb(!1):fs.mkdir(filepath,function(err){return resume_cb(err!=null?!1:!0)})})})}),o("createFileExclusively(Ljava/lang/String;)Z",function(rs,_this,path){var filepath;return filepath=path.jvm2js_str(),rs.async_op(function(resume_cb,except_cb){return stat_file(filepath,function(stat){return stat!=null?resume_cb(!1):fs.open(filepath,"w",function(err,fd){return err!=null?except_cb(function(){return rs.java_throw(rs.get_bs_class("Ljava/io/IOException;"),err.message)}):fs.close(fd,function(err){return err!=null?except_cb(function(){return rs.java_throw(rs.get_bs_class("Ljava/io/IOException;"),err.message)}):resume_cb(!0)})})})})}),o("createFileExclusively(Ljava/lang/String;Z)Z",function(rs,_this,path){var filepath;return filepath=path.jvm2js_str(),rs.async_op(function(resume_cb,except_cb){return stat_file(filepath,function(stat){return stat!=null?resume_cb(!1):fs.open(filepath,"w",function(err,fd){return err!=null?except_cb(function(){return rs.java_throw(rs.get_bs_class("Ljava/io/IOException;"),err.message)}):fs.close(fd,function(err){return err!=null?except_cb(function(){return rs.java_throw(rs.get_bs_class("Ljava/io/IOException;"),err.message)}):resume_cb(!0)})})})})}),o("delete0(Ljava/io/File;)Z",function(rs,_this,file){var filepath;return filepath=file.get_field(rs,"Ljava/io/File;path").jvm2js_str(),rs.async_op(function(resume_cb,except_cb){return stat_file(filepath,function(stats){return stats==null?resume_cb(!1):stats.isDirectory()?fs.readdir(filepath,function(err,files){return files.length>0?resume_cb(!1):fs.rmdir(filepath,function(err){return resume_cb(!0)})}):fs.unlink(filepath,function(err){return resume_cb(!0)})})})}),o("getBooleanAttributes0(Ljava/io/File;)I",function(rs,_this,file){var filepath;return filepath=file.get_field(rs,"Ljava/io/File;path"),rs.async_op(function(resume_cb){return stat_file(filepath.jvm2js_str(),function(stats){return stats==null?resume_cb(0):stats.isFile()?resume_cb(3):stats.isDirectory()?resume_cb(5):resume_cb(1)})})}),o("getLastModifiedTime(Ljava/io/File;)J",function(rs,_this,file){var filepath;return filepath=file.get_field(rs,"Ljava/io/File;path").jvm2js_str(),rs.async_op(function(resume_cb){return stat_file(filepath,function(stats){return stats==null?resume_cb(gLong.ZERO,null):resume_cb(gLong.fromNumber((new Date(stats.mtime)).getTime()),null)})})}),o("setLastModifiedTime(Ljava/io/File;J)Z",function(rs,_this,file,time){var atime,filepath,mtime;return mtime=time.toNumber(),atime=(new Date).getTime(),filepath=file.get_field(rs,"Ljava/io/File;path").jvm2js_str(),rs.async_op(function(resume_cb){return fs.utimes(filepath,atime,mtime,function(err){return resume_cb(!0)})})}),o("getLength(Ljava/io/File;)J",function(rs,_this,file){var filepath;return filepath=file.get_field(rs,"Ljava/io/File;path"),rs.async_op(function(resume_cb){return fs.stat(filepath.jvm2js_str(),function(err,stat){return resume_cb(gLong.fromNumber(err!=null?0:stat.size),null)})})}),o("list(Ljava/io/File;)[Ljava/lang/String;",function(rs,_this,file){var filepath;return filepath=file.get_field(rs,"Ljava/io/File;path"),rs.async_op(function(resume_cb){return fs.readdir(filepath.jvm2js_str(),function(err,files){var f;return err!=null?resume_cb(null):resume_cb(new JavaArray(rs,rs.get_bs_class("[Ljava/lang/String;"),function(){var _i,_len,_results;_results=[];for(_i=0,_len=files.length;_i<_len;_i++)f=files[_i],_results.push(rs.init_string(f));return _results}()))})})}),o("rename0(Ljava/io/File;Ljava/io/File;)Z",function(rs,_this,file1,file2){var file1path,file2path;return file1path=file1.get_field(rs,"Ljava/io/File;path").jvm2js_str(),file2path=file2.get_field(rs,"Ljava/io/File;path").jvm2js_str(),rs.async_op(function(resume_cb){return fs.rename(file1path,file2path,function(err){return resume_cb(err!=null?!1:!0)})})}),o("setPermission(Ljava/io/File;IZZ)Z",function(rs,_this,file,access,enable,owneronly){var filepath;return filepath=file.get_field(rs,"Ljava/io/File;path").jvm2js_str(),owneronly?access<<=6:access|=access<<6|access<<3,enable||(access=~access),rs.async_op(function(resume_cb){return stat_file(filepath,function(stats){var existing_access;return stats==null?resume_cb(!1):(existing_access=stats.mode,access=enable?existing_access|access:existing_access&access,fs.chmod(filepath,access,function(err){return resume_cb(err!=null?!1:!0)}))})})}),o("setReadOnly(Ljava/io/File;)Z",function(rs,_this,file){var filepath,mask;return filepath=file.get_field(rs,"Ljava/io/File;path").jvm2js_str(),mask=-147,rs.async_op(function(resume_cb){return stat_file(filepath,function(stats){return stats==null?resume_cb(!1):fs.chmod(filepath,stats.mode&mask,function(err){return resume_cb(err!=null?!1:!0)})})})})]},util:{concurrent:{atomic:{AtomicLong:[o("VMSupportsCS8()Z",function(){return!0})]}},jar:{JarFile:[o("getMetaInfEntryNames()[L!/lang/String;",function(rs){return null})]},ResourceBundle:[o("getClassContext()[L!/lang/Class;",function(rs){return new JavaArray(rs,rs.get_bs_class("[Ljava/lang/Class;"),[null,null,null])})],TimeZone:[o("getSystemTimeZoneID(L!/lang/String;L!/lang/String;)L!/lang/String;",function(rs,java_home,country){return rs.init_string("GMT")}),o("getSystemGMTOffsetID()L!/lang/String;",function(rs){return null})]},net:{}},sun:{font:{FontManager:[],FreetypeFontScaler:[o("initIDs(Ljava/lang/Class;)V",function(){})],StrikeCache:[o("getGlyphCacheDescription([J)V",function(rs,infoArray){return infoArray.array[0]=gLong.fromInt(8),infoArray.array[1]=gLong.fromInt(8)})]},management:{VMManagementImpl:[o("getStartupTime()J",function(rs){return rs.startup_time}),o("getVersion0()Ljava/lang/String;",function(rs){return rs.init_string("1.2",!0)}),o("initOptionalSupportFields()V",function(rs){var field_names,name,vm_management_impl,_i,_len,_results;field_names=["compTimeMonitoringSupport","threadContentionMonitoringSupport","currentThreadCpuTimeSupport","otherThreadCpuTimeSupport","bootClassPathSupport","objectMonitorUsageSupport","synchronizerUsageSupport"],vm_management_impl=rs.get_bs_class("Lsun/management/VMManagementImpl;"),_results=[];for(_i=0,_len=field_names.length;_i<_len;_i++)name=field_names[_i],_results.push(vm_management_impl.static_put(rs,name,0));return _results}),o("isThreadAllocatedMemoryEnabled()Z",function(){return!1}),o("isThreadContentionMonitoringEnabled()Z",function(){return!1}),o("isThreadCpuTimeEnabled()Z",function(){return!1}),o("getAvailableProcessors()I",function(){return 1}),o("getProcessId()I",function(){return 1})],MemoryImpl:[o("getMemoryManagers0()[Ljava/lang/management/MemoryManagerMXBean;",function(rs){return new JavaArray(rs,rs.get_bs_class("[Lsun/management/MemoryManagerImpl;"),[])}),o("getMemoryPools0()[Ljava/lang/management/MemoryPoolMXBean;",function(rs){return new JavaArray(rs,rs.get_bs_class("[Lsun/management/MemoryPoolImpl;"),[])})]},misc:{VM:[o("initialize()V",function(rs){var props,sys_cls,vm_cls;vm_cls=rs.get_bs_class("Lsun/misc/VM;");if(vm_cls.major_version>=51)return sys_cls=rs.get_bs_class("Ljava/lang/System;"),props=sys_cls.static_get(rs,"props"),vm_cls=rs.get_bs_class("Lsun/misc/VM;"),vm_cls.static_put("savedProps",props);return})],Unsafe:[o("addressSize()I",function(rs,_this){return 4}),o("allocateInstance(Ljava/lang/Class;)Ljava/lang/Object;",function(rs,_this,cls){return cls=cls.$cls,cls.is_initialized(rs)?new JavaObject(rs,cls):rs.async_op(function(resume_cb,except_cb){return cls.loader.initialize_class(rs,cls.get_type(),function(){return resume_cb(new JavaObject(rs,cls))},except_cb)})}),o("allocateMemory(J)J",function(rs,_this,size){var i,next_addr,_i;next_addr=util.last(rs.mem_start_addrs);if(typeof DataView!="undefined"&&DataView!==null)rs.mem_blocks[next_addr]=new DataView(new ArrayBuffer(size));else{rs.mem_blocks[next_addr]=size,next_addr+=1;for(i=_i=0;_i<size;i=_i+=1)rs.mem_blocks[next_addr+i]=0}return rs.mem_start_addrs.push(next_addr+size),gLong.fromNumber(next_addr)}),o("copyMemory(Ljava/lang/Object;JLjava/lang/Object;JJ)V",function(rs,_this,src_base,src_offset,dest_base,dest_offset,num_bytes){return unsafe_memcpy(rs,src_base,src_offset,dest_base,dest_offset,num_bytes)}),o("setMemory(JJB)V",function(rs,_this,address,bytes,value){var block_addr,i,_i;block_addr=rs.block_addr(address);for(i=_i=0;_i<bytes;i=_i+=1)typeof DataView!="undefined"&&DataView!==null?rs.mem_blocks[block_addr].setInt8(i,value):rs.mem_blocks[block_addr+i]=value}),o("freeMemory(J)V",function(rs,_this,address){var i,num_blocks,_i;if(typeof DataView!="undefined"&&DataView!==null)delete rs.mem_blocks[address.toNumber()];else{address=address.toNumber(),num_blocks=rs.mem_blocks[address-1];for(i=_i=0;_i<num_blocks;i=_i+=1)delete rs.mem_blocks[address+i];delete rs.mem_blocks[address-1],address-=1}return rs.mem_start_addrs.splice(rs.mem_start_addrs.indexOf(address),1)}),o("putLong(JJ)V",function(rs,_this,address,value){var block_addr,offset,store_word;block_addr=rs.block_addr(address),offset=address-block_addr,typeof DataView!="undefined"&&DataView!==null?(rs.mem_blocks[block_addr].setInt32(offset,value.getLowBits(),!0),rs.mem_blocks[block_addr].setInt32(offset+4,value.getHighBits,!0)):(store_word=function(rs_,address,word){return rs_.mem_blocks[address]=word&255,rs_.mem_blocks[address+1]=word>>>8&255,rs_.mem_blocks[address+2]=word>>>16&255,rs_.mem_blocks[address+3]=word>>>24&255},store_word(rs,address,value.getLowBits()),store_word(rs,address+4,value.getHighBits()))}),o("getByte(J)B",function(rs,_this,address){var block_addr;return block_addr=rs.block_addr(address),typeof DataView!="undefined"&&DataView!==null?rs.mem_blocks[block_addr].getInt8(address-block_addr):rs.mem_blocks[block_addr]}),o("arrayBaseOffset(Ljava/lang/Class;)I",function(rs,_this,cls){return 0}),o("arrayIndexScale(Ljava/lang/Class;)I",function(rs,_this,cls){return 1}),o("compareAndSwapObject(Ljava/lang/Object;JLjava/lang/Object;Ljava/lang/Object;)Z",unsafe_compare_and_swap),o("compareAndSwapInt(Ljava/lang/Object;JII)Z",unsafe_compare_and_swap),o("compareAndSwapLong(Ljava/lang/Object;JJJ)Z",unsafe_compare_and_swap),o("ensureClassInitialized(Ljava/lang/Class;)V",function(rs,_this,cls){return rs.async_op(function(resume_cb,except_cb){return cls.$cls.loader.initialize_class(rs,cls.$cls.get_type(),function(){return resume_cb()},except_cb)})}),o("staticFieldOffset(Ljava/lang/reflect/Field;)J",function(rs,_this,field){var jco,slot;return jco=field.get_field(rs,"Ljava/lang/reflect/Field;clazz"),slot=field.get_field(rs,"Ljava/lang/reflect/Field;slot"),gLong.fromNumber(slot+jco.ref)}),o("objectFieldOffset(Ljava/lang/reflect/Field;)J",function(rs,_this,field){var jco,slot;return jco=field.get_field(rs,"Ljava/lang/reflect/Field;clazz"),slot=field.get_field(rs,"Ljava/lang/reflect/Field;slot"),gLong.fromNumber(slot+jco.ref)}),o("staticFieldBase(Ljava/lang/reflect/Field;)Ljava/lang/Object;",function(rs,_this,field){var cls;return cls=field.get_field(rs,"Ljava/lang/reflect/Field;clazz"),new JavaObject(rs,cls.$cls)}),o("getBoolean(Ljava/lang/Object;J)Z",function(rs,_this,obj,offset){return obj.get_field_from_offset(rs,offset)}),o("getBooleanVolatile(Ljava/lang/Object;J)Z",function(rs,_this,obj,offset){return obj.get_field_from_offset(rs,offset)}),o("getDouble(Ljava/lang/Object;J)D",function(rs,_this,obj,offset){return obj.get_field_from_offset(rs,offset)}),o("getDoubleVolatile(Ljava/lang/Object;J)D",function(rs,_this,obj,offset){return obj.get_field_from_offset(rs,offset)}),o("getFloat(Ljava/lang/Object;J)F",function(rs,_this,obj,offset){return obj.get_field_from_offset(rs,offset)}),o("getFloatVolatile(Ljava/lang/Object;J)F",function(rs,_this,obj,offset){return obj.get_field_from_offset(rs,offset)}),o("getInt(Ljava/lang/Object;J)I",function(rs,_this,obj,offset){return obj.get_field_from_offset(rs,offset)}),o("getIntVolatile(Ljava/lang/Object;J)I",function(rs,_this,obj,offset){return obj.get_field_from_offset(rs,offset)}),o("getLong(Ljava/lang/Object;J)J",function(rs,_this,obj,offset){return obj.get_field_from_offset(rs,offset)}),o("getLongVolatile(Ljava/lang/Object;J)J",function(rs,_this,obj,offset){return obj.get_field_from_offset(rs,offset)}),o("getShort(Ljava/lang/Object;J)S",function(rs,_this,obj,offset){return obj.get_field_from_offset(rs,offset)}),o("getShortVolatile(Ljava/lang/Object;J)S",function(rs,_this,obj,offset){return obj.get_field_from_offset(rs,offset)}),o("getObject(Ljava/lang/Object;J)Ljava/lang/Object;",function(rs,_this,obj,offset){return obj.get_field_from_offset(rs,offset)}),o("getObjectVolatile(Ljava/lang/Object;J)Ljava/lang/Object;",function(rs,_this,obj,offset){return obj.get_field_from_offset(rs,offset)}),o("putDouble(Ljava/lang/Object;JD)V",function(rs,_this,obj,offset,new_value){return obj.set_field_from_offset(rs,offset,new_value)}),o("putInt(Ljava/lang/Object;JI)V",function(rs,_this,obj,offset,new_value){return obj.set_field_from_offset(rs,offset,new_value)}),o("putObject(Ljava/lang/Object;JLjava/lang/Object;)V",function(rs,_this,obj,offset,new_obj){return obj.set_field_from_offset(rs,offset,new_obj)}),o("putObjectVolatile(Ljava/lang/Object;JLjava/lang/Object;)V",function(rs,_this,obj,offset,new_obj){return obj.set_field_from_offset(rs,offset,new_obj)}),o("putOrderedObject(Ljava/lang/Object;JLjava/lang/Object;)V",function(rs,_this,obj,offset,new_obj){return obj.set_field_from_offset(rs,offset,new_obj)}),o("defineClass(Ljava/lang/String;[BIILjava/lang/ClassLoader;Ljava/security/ProtectionDomain;)Ljava/lang/Class;",function(rs,_this,name,bytes,offset,len,loader,pd){return rs.async_op(function(success_cb,except_cb){return native_define_class(rs,name,bytes,offset,len,get_cl_from_jclo(rs,loader),success_cb,except_cb)})}),o("pageSize()I",function(rs){return 1024}),o("throwException(Ljava/lang/Throwable;)V",function(rs,_this,exception){var my_sf;throw my_sf=rs.curr_frame(),my_sf.runner=function(){throw my_sf.runner=null,new exceptions.JavaException(exception)},exceptions.ReturnException}),o("park(ZJ)V",function(rs,_this,absolute,time){var timeout;return timeout=Infinity,absolute?timeout=time:time>0&&(timeout=(new Date).getTime()+time/1e6),rs.park(rs.curr_thread,timeout)}),o("unpark(Ljava/lang/Object;)V",function(rs,_this,thread){return rs.unpark(thread)})]},net:{spi:{}},nio:{ch:{FileChannelImpl:[o("initIDs()J",function(rs){return gLong.fromNumber(1024)}),o("size0(Ljava/io/FileDescriptor;)J",function(rs,_this,fd_obj){var fd=fd_obj.get_field(rs,"Ljava/io/FileDescriptor;fd");rs.async_op(function(cb,e_cb){fs.fstat(fd,function(err,stats){null!=err&&e_cb(function(){rs.java_throw(rs.get_bs_class("Ljava/io/IOException;"),"Bad file descriptor.")}),cb(gLong.fromNumber(stats.size))})})}),o("position0(Ljava/io/FileDescriptor;J)J",function(rs,_this,fd,offset){var parent;return parent=_this.get_field(rs,"Lsun/nio/ch/FileChannelImpl;parent"),gLong.fromNumber(offset.equals(gLong.NEG_ONE)?parent.$pos:parent.$pos=offset.toNumber())})],FileDispatcher:[o("init()V",function(rs){}),o("read0(Ljava/io/FileDescriptor;JI)I",function(rs,fd_obj,address,len){var fd=fd_obj.get_field(rs,"Ljava/io/FileDescriptor;fd"),block_addr=rs.block_addr(address),buf=new Buffer(len);rs.async_op(function(cb){fs.read(fd,buf,0,len,0,function(err,bytes_read){var i,_i,_j;if("undefined"!=typeof DataView&&null!==DataView)for(i=0;bytes_read>i;i++)rs.mem_blocks[block_addr].setInt8(i,buf.readInt8(i));else for(i=0;bytes_read>i;i++)rs.mem_blocks[block_addr+i]=buf.readInt8(i);cb(bytes_read)})})}),o("preClose0(Ljava/io/FileDescriptor;)V",function(rs,fd_obj){})],NativeThread:[o("init()V",function(rs){}),o("current()J",function(rs){return gLong.fromNumber(-1)})]}}}},exports.native_methods.java.lang.Class=[o("getPrimitiveClass(L!/!/String;)L!/!/!;",function(rs,jvm_str){var prim_cls,type_desc;return type_desc=util.typestr2descriptor(jvm_str.jvm2js_str()),prim_cls=rs.get_bs_class(type_desc),prim_cls.get_class_object(rs)}),o("getClassLoader0()L!/!/ClassLoader;",function(rs,_this){var loader;return loader=_this.$cls.loader,loader.loader_obj!=null?loader.loader_obj:null}),o("desiredAssertionStatus0(L!/!/!;)Z",function(rs){return!1}),o("getName0()L!/!/String;",function(rs,_this){return rs.init_string(_this.$cls.toExternalString())}),o("forName0(L!/!/String;ZL!/!/ClassLoader;)L!/!/!;",function(rs,jvm_str,initialize,loader){var classname=util.int_classname(jvm_str.jvm2js_str());util.verify_int_classname(classname)||rs.java_throw(rs.get_bs_class("Ljava/lang/ClassNotFoundException;"),classname),loader=get_cl_from_jclo(rs,loader),rs.async_op(function(resume_cb,except_cb){return initialize?loader.initialize_class(rs,classname,function(cls){return resume_cb(cls.get_class_object(rs))},except_cb,!0):loader.resolve_class(rs,classname,function(cls){return resume_cb(cls.get_class_object(rs))},except_cb,!0)})}),o("getComponentType()L!/!/!;",function(rs,_this){return _this.$cls instanceof ArrayClassData?_this.$cls.get_component_class().get_class_object(rs):null}),o("getGenericSignature()Ljava/lang/String;",function(rs,_this){var sig,_ref5;return sig=(_ref5=_this.$cls.get_attribute("Signature"))!=null?_ref5.sig:void 0,sig!=null?rs.init_string(sig):null}),o("getProtectionDomain0()Ljava/security/ProtectionDomain;",function(rs,_this){return null}),o("isAssignableFrom(L!/!/!;)Z",function(rs,_this,cls){return cls.$cls.is_castable(_this.$cls)}),o("isInterface()Z",function(rs,_this){return _this.$cls instanceof ReferenceClassData?_this.$cls.access_flags["interface"]:!1}),o("isInstance(L!/!/Object;)Z",function(rs,_this,obj){return obj.cls.is_castable(_this.$cls)}),o("isPrimitive()Z",function(rs,_this){return _this.$cls instanceof PrimitiveClassData}),o("isArray()Z",function(rs,_this){return _this.$cls instanceof ArrayClassData}),o("getSuperclass()L!/!/!;",function(rs,_this){if(_this.$cls instanceof PrimitiveClassData)return null;var cls=_this.$cls;return cls.access_flags["interface"]||cls.get_super_class()==null?null:cls.get_super_class().get_class_object(rs)}),o("getDeclaredFields0(Z)[Ljava/lang/reflect/Field;",function(rs,_this,public_only){var fields=_this.$cls.get_fields();public_only&&(fields=fields.filter(function(f){return f.access_flags["public"]}));var base_array=[];rs.async_op(function(resume_cb,except_cb){util.async_foreach(fields,function(f,next_item){f.reflector(rs,function(jco){base_array.push(jco),next_item()},except_cb)},function(){var field_arr_cls=rs.get_bs_class("[Ljava/lang/reflect/Field;");resume_cb(new JavaArray(rs,field_arr_cls,base_array))})})}),o("getDeclaredMethods0(Z)[Ljava/lang/reflect/Method;",function(rs,_this,public_only){var methods=_this.$cls.get_methods();methods=function(){var _results=[];for(var sig in methods){var m=methods[sig];sig[0]!=="<"&&(m.access_flags["public"]||!public_only)&&_results.push(m)}return _results}();var base_array=[];rs.async_op(function(resume_cb,except_cb){util.async_foreach(methods,function(m,next_item){m.reflector(rs,!1,function(jco){base_array.push(jco),next_item()},except_cb)},function(){var method_arr_cls=rs.get_bs_class("[Ljava/lang/reflect/Method;");resume_cb(new JavaArray(rs,method_arr_cls,base_array))})})}),o("getDeclaredConstructors0(Z)[Ljava/lang/reflect/Constructor;",function(rs,_this,public_only){var methods=_this.$cls.get_methods();methods=function(){var _results=[];for(var sig in methods){var m=methods[sig];m.name==="<init>"&&_results.push(m)}return _results}(),public_only&&(methods=methods.filter(function(m){return m.access_flags["public"]}));var ctor_array_cdata=rs.get_bs_class("[Ljava/lang/reflect/Constructor;"),base_array=[];rs.async_op(function(resume_cb,except_cb){util.async_foreach(methods,function(m,next_item){m.reflector(rs,!0,function(jco){base_array.push(jco),next_item()},except_cb)},function(){resume_cb(new JavaArray(rs,ctor_array_cdata,base_array))})})}),o("getInterfaces()[L!/!/!;",function(rs,_this){var cls=_this.$cls,ifaces=cls.get_interfaces(),iface_objs=ifaces.map(function(iface){return iface.get_class_object(rs)});return new JavaArray(rs,rs.get_bs_class("[Ljava/lang/Class;"),iface_objs)}),o("getModifiers()I",function(rs,_this){return _this.$cls.access_byte}),o("getRawAnnotations()[B",function(rs,_this){var annotations,cls,m,sig,_ref5;cls=_this.$cls,annotations=cls.get_attribute("RuntimeVisibleAnnotations");if(annotations!=null)return new JavaArray(rs,rs.get_bs_class("[B"),annotations.raw_bytes);_ref5=cls.get_methods();for(sig in _ref5){m=_ref5[sig],annotations=m.get_attribute("RuntimeVisibleAnnotations");if(annotations!=null)return new JavaArray(rs,rs.get_bs_class("[B"),annotations.raw_bytes)}return null}),o("getConstantPool()Lsun/reflect/ConstantPool;",function(rs,_this){var cls;return cls=_this.$cls,new JavaObject(rs,rs.get_bs_class("Lsun/reflect/ConstantPool;"),{"Lsun/reflect/ConstantPool;constantPoolOop":cls.constant_pool})}),o("getEnclosingMethod0()[L!/!/Object;",function(rs,_this){var cls,em,enc_cls,enc_desc,enc_name;return _this.$cls instanceof ReferenceClassData?(cls=_this.$cls,em=cls.get_attribute("EnclosingMethod"),em==null?null:(enc_cls=cls.loader.get_resolved_class(em.enc_class).get_class_object(rs),em.enc_method!=null?(enc_name=rs.init_string(em.enc_method.name),enc_desc=rs.init_string(em.enc_method.type)):(enc_name=null,enc_desc=null),new JavaArray(rs,rs.get_bs_class("[Ljava/lang/Object;"),[enc_cls,enc_name,enc_desc]))):null}),o("getDeclaringClass()L!/!/!;",function(rs,_this){var cls,declaring_name,entry,icls,my_class,name,_i,_len,_ref5;if(_this.$cls instanceof ReferenceClassData){cls=_this.$cls,icls=cls.get_attribute("InnerClasses");if(icls==null)return null;my_class=_this.$cls.get_type(),_ref5=icls.classes;for(_i=0,_len=_ref5.length;_i<_len;_i++){entry=_ref5[_i];if(entry.outer_info_index>0){name=cls.constant_pool.get(entry.inner_info_index).deref();if(name!==my_class)continue;return declaring_name=cls.constant_pool.get(entry.outer_info_index).deref(),cls.loader.get_resolved_class(declaring_name).get_class_object(rs)}continue}return null}return null}),o("getDeclaredClasses0()[L!/!/!;",function(rs,_this){var _i,_j,_len,_len1,ret=new JavaArray(rs,rs.get_bs_class("[Ljava/lang/Class;"),[]);if(!(_this.$cls instanceof ReferenceClassData))return ret;var cls=_this.$cls,my_class=_this.$cls.get_type(),iclses=cls.get_attributes("InnerClasses");if(iclses.length===0)return ret;var flat_names=[];for(var i=0;i<iclses.length;i++){var names=iclses[i].classes.filter(function(c){return c.outer_info_index>0&&cls.constant_pool.get(c.outer_info_index).deref()===my_class}).map(function(c){return cls.constant_pool.get(c.inner_info_index).deref()});flat_names.push.apply(flat_names,names)}rs.async_op(function(resume_cb,except_cb){util.async_foreach(flat_names,function(name,next_item){cls.loader.resolve_class(rs,name,function(cls){ret.array.push(cls.get_class_object(rs)),next_item()},except_cb)},function(){return resume_cb(ret)})})})],exports.native_methods.java.lang.Runtime=[o("availableProcessors()I",function(){return 1}),o("gc()V",function(rs){return rs.async_op(function(cb){return cb()})}),o("maxMemory()J",function(rs){return debug("Warning: maxMemory has no meaningful value in Doppio -- there is no hard memory limit."),gLong.MAX_VALUE})],exports.native_methods.java.net.Inet4Address=[o("init()V",function(rs){})];var host_lookup={},host_reverse_lookup={},next_host_address=4026531840;exports.native_methods.java.net.Inet4AddressImpl=[o("lookupAllHostAddr(Ljava/lang/String;)[Ljava/net/InetAddress;",function(rs,_this,hostname){var cdata,cons,failure,success;return cdata=rs.get_class("Ljava/net/Inet4Address;"),success=function(rv,success_cb,except_cb){return success_cb(new JavaArray(rs,rs.get_bs_class("[Ljava/net/InetAddress;"),[rv]))},failure=function(e_cb,success_cb,except_cb){return except_cb(e_cb)},cons=cdata.method_lookup(rs,"<init>(Ljava/lang/String;I)V"),rs.call_bytecode(cdata,cons,[hostname,host_allocate_address(hostname.jvm2js_str())],success,failure)}),o("getLocalHostName()Ljava/lang/String;",function(rs,_this){return rs.init_string("localhost")}),o("getHostByAddr([B)Ljava/lang/String;",function(rs,_this,addr){var ret;return ret=host_reverse_lookup[pack_address(addr.array)],ret===void 0?null:rs.init_string(ret)}),o("isReachable0([BII[BII)Z",function(rs,_this,addr,scope,timeout,inf,ttl,if_scope){return!1})],exports.native_methods.java.net.Inet6Address=[o("init()V",function(rs){})],exports.native_methods.java.net.InetAddress=[o("init()V",function(rs){})],exports.native_methods.java.net.InetAddressImplFactory=[o("isIPv6Supported()Z",function(rs){return!1})],exports.native_methods.java.net.PlainSocketImpl=[o("socketCreate(Z)V",function(rs,_this,isServer){var fd;return(typeof node=="undefined"||node===null)&&rs.java_throw(rs.get_bs_class("Ljava/io/IOException;"),"WebSockets are disabled"),fd=_this.get_field(rs,"Ljava/net/SocketImpl;fd"),fd.set_field(rs,"Ljava/io/FileDescriptor;fd",8374),_this.$ws=new Websock,_this.$is_shutdown=!1}),o("socketConnect(Ljava/net/InetAddress;II)V",function(rs,_this,address,port,timeout){var addy,holder,host,i,shift,_i;holder=address.get_field(rs,"Ljava/net/InetAddress;holder"),addy=holder.get_field(rs,"Ljava/net/InetAddress$InetAddressHolder;address"),host="ws://";if(host_lookup[addy]===void 0){for(i=_i=3;_i>=0;i=_i+=-1)shift=i*8,host+=""+((addy&255<<shift)>>>shift)+".";host=host.substring(0,host.length-1)}else host+=host_lookup[addy];return host+=":"+port,debug("Connecting to "+host+" with timeout = "+timeout+" ms"),rs.async_op(function(resume_cb,except_cb){var clear_state,close_cb,err,error_cb,id;id=0,clear_state=function(){return window.clearTimeout(id),_this.$ws.on("open",function(){}),_this.$ws.on("close",function(){}),_this.$ws.on("error",function(){})},error_cb=function(msg){return function(e){return clear_state(),except_cb(function(){return rs.java_throw(rs.get_bs_class("Ljava/io/IOException;"),msg+": "+e)})}},close_cb=function(msg){return function(e){return clear_state(),except_cb(function(){return rs.java_throw(rs.get_bs_class("Ljava/io/IOException;"),msg+": "+websocket_status_to_message(e.status))})}},_this.$ws.on("open",function(){return debug("Open!"),clear_state(),resume_cb()}),_this.$ws.on("close",close_cb("Connection failed! (Closed)")),timeout===0&&(timeout=1e4),id=setTimeout(error_cb("Connection timeout!"),timeout),debug("Host: "+host);try{return _this.$ws.open(host)}catch(_error){return err=_error,error_cb("Connection failed! (exception)")(err.message)}})}),o("socketBind(Ljava/net/InetAddress;I)V",function(rs,_this,address,port){return rs.java_throw(rs.get_bs_class("Ljava/io/IOException;"),"WebSockets doesn't know how to bind")}),o("socketListen(I)V",function(rs,_this,port){return rs.java_throw(rs.get_bs_class("Ljava/io/IOException;"),"WebSockets doesn't know how to listen")}),o("socketAccept(Ljava/net/SocketImpl;)V",function(rs,_this,s){return rs.java_throw(rs.get_bs_class("Ljava/io/IOException;"),"WebSockets doesn't know how to accept")}),o("socketAvailable()I",function(rs,_this){return rs.async_op(function(resume_cb){return setImmediate(function(){return resume_cb(_this.$ws.rQlen())})})}),o("socketClose0(Z)V",function(rs,_this,useDeferredClose){return _this.$ws.close()}),o("socketShutdown(I)V",function(rs,_this,type){return _this.$is_shutdown=!0}),o("initProto()V",function(rs){}),o("socketSetOption(IZLjava/lang/Object;)V",function(rs,_this,cmd,_on,value){}),o("socketGetOption(ILjava/lang/Object;)I",function(rs,_this,opt,iaContainerObj){}),o("socketGetOption1(ILjava/lang/Object;Ljava/io/FileDescriptor;)I",function(rs,_this,opt,iaContainerObj,fd){}),o("socketSendUrgentData(I)V",function(rs,_this,data){return _this.$ws.send(data)})],exports.native_methods.java.net.SocketInputStream=[o("init()V",function(rs){}),o("socketRead0(Ljava/io/FileDescriptor;[BIII)I",function(rs,_this,fd,b,offset,len,timeout){var impl;return impl=_this.get_field(rs,"Ljava/net/SocketInputStream;impl"),impl.$is_shutdown===!0&&rs.java_throw(rs.get_bs_class("Ljava/io/IOException;"),"Socket is shutdown."),rs.async_op(function(resume_cb){return setTimeout(socket_read_async(impl,b,offset,len,resume_cb),timeout)})})],exports.native_methods.java.net.SocketOutputStream=[o("init()V",function(rs){}),o("socketWrite0(Ljava/io/FileDescriptor;[BII)V",function(rs,_this,fd,b,offset,len){var impl;return impl=_this.get_field(rs,"Ljava/net/SocketOutputStream;impl"),impl.$is_shutdown===!0&&rs.java_throw(rs.get_bs_class("Ljava/io/IOException;"),"Socket is shutdown."),impl.$ws.get_raw_state()!==WebSocket.OPEN&&rs.java_throw(rs.get_bs_class("Ljava/io/IOException;"),"Connection isn't open"),impl.$ws.send(b.array.splice(offset,offset+len)),rs.async_op(function(resume_cb){return setImmediate(function(){return resume_cb()})})})],exports.native_methods.sun.net.spi.DefaultProxySelector=[o("init()Z",function(rs){return!0}),o("getSystemProxy(Ljava/lang/String;Ljava/lang/String;)Ljava/net/Proxy;",function(rs){return null})],exports.native_methods.sun.reflect={ConstantPool:[o("getLongAt0(Ljava/lang/Object;I)J",function(rs,_this,cp,idx){return cp.get(idx).value}),o("getUTF8At0(Ljava/lang/Object;I)Ljava/lang/String;",function(rs,_this,cp,idx){return rs.init_string(cp.get(idx).value)})],NativeMethodAccessorImpl:[o("invoke0(Ljava/lang/reflect/Method;Ljava/lang/Object;[Ljava/lang/Object;)Ljava/lang/Object;",function(rs,m,obj,params){var caller_sf,cleanup_runner,cls,cls_obj,m_sig,method,name,p_desc,p_types,pt,ret_descriptor,ret_type,slot;cls=m.get_field(rs,"Ljava/lang/reflect/Method;clazz"),ret_type=m.get_field(rs,"Ljava/lang/reflect/Method;returnType"),ret_descriptor=ret_type.$cls.get_type(),util.is_primitive_type(ret_descriptor)&&ret_descriptor!=="V"?cleanup_runner=function(){var rv;return rv=ret_descriptor==="J"||ret_descriptor==="D"?rs.pop2():rs.pop(),rs.meta_stack().pop(),rs.push(ret_type.$cls.create_wrapper_object(rs,rv))}:cleanup_runner=function(){var rv;return rv=rs.pop(),rs.meta_stack().pop(),rs.push(rv)};if(cls.$cls.access_byte&512)throw cls_obj=rs.check_null(obj).cls,name=m.get_field(rs,"Ljava/lang/reflect/Method;name").jvm2js_str(rs),p_types=m.get_field(rs,"Ljava/lang/reflect/Method;parameterTypes"),p_desc=function(){var _i,_len,_ref5,_results;_ref5=p_types.array,_results=[];for(_i=0,_len=_ref5.length;_i<_len;_i++)pt=_ref5[_i],_results.push(pt.$cls.get_type());return _results}().join(""),m_sig=""+name+"("+p_desc+")"+ret_descriptor,method=cls_obj.method_lookup(rs,m_sig),caller_sf=setup_caller_stack(rs,method,obj,params),method.setup_stack(rs),caller_sf.runner=cleanup_runner,exceptions.ReturnException;return slot=m.get_field(rs,"Ljava/lang/reflect/Method;slot"),rs.async_op(function(resume_cb,except_cb){return cls.$cls.loader.initialize_class(rs,cls.$cls.get_type(),function(cls_obj){var sig;return method=function(){var _ref5,_results;_ref5=cls_obj.get_methods(),_results=[];for(sig in _ref5)method=_ref5[sig],method.idx===slot&&_results.push(method);return _results}()[0],caller_sf=setup_caller_stack(rs,method,obj,params),except_cb(function(){return method.setup_stack(rs),caller_sf.runner=cleanup_runner})},except_cb)})})],NativeConstructorAccessorImpl:[o("newInstance0(Ljava/lang/reflect/Constructor;[Ljava/lang/Object;)Ljava/lang/Object;",function(rs,m,params){var cls,slot;return cls=m.get_field(rs,"Ljava/lang/reflect/Constructor;clazz"),slot=m.get_field(rs,"Ljava/lang/reflect/Constructor;slot"),rs.async_op(function(resume_cb,except_cb){return cls.$cls.loader.initialize_class(rs,cls.$cls.get_type(),function(cls_obj){var method,my_sf,obj,sig;return method=function(){var _ref5,_results;_ref5=cls_obj.get_methods(),_results=[];for(sig in _ref5)method=_ref5[sig],method.idx===slot&&_results.push(method);return _results}()[0],my_sf=rs.curr_frame(),obj=new JavaObject(rs,cls_obj),rs.push(obj),params!=null&&rs.push_array(params.array),except_cb(function(){return method.setup_stack(rs),my_sf.runner=function(){return rs.meta_stack().pop(),rs.push(obj)}})},except_cb)})})],Reflection:[o("getCallerClass(I)Ljava/lang/Class;",function(rs,frames_to_skip){var caller,cls;return caller=rs.meta_stack().get_caller(frames_to_skip),caller.name.indexOf("Ljava/lang/reflect/Method;::invoke")===0&&(caller=rs.meta_stack().get_caller(frames_to_skip+1)),cls=caller.method.cls,cls.get_class_object(rs)}),o("getClassAccessFlags(Ljava/lang/Class;)I",function(rs,class_obj){return class_obj.$cls.access_byte})]},exports.trapped_methods=flatten_pkg(exports.trapped_methods),exports.native_methods=flatten_pkg(exports.native_methods)}),define("src/jvm",["require","exports","./logging","./runtime","./ClassLoader"],function(require,exports,__logging__,__runtime__,__ClassLoader__){var logging=__logging__,runtime=__runtime__,ClassLoader=__ClassLoader__,trace=logging.trace,error=logging.error,fs,path,vendor_path;typeof node=="undefined"?(fs=require("fs"),path=require("path"),vendor_path=path.resolve(__dirname,"../vendor")):(fs=node.fs,path=node.path,vendor_path="/sys/vendor"),exports.show_NYI_natives=!1;var JVM=function(){function JVM(dump_state){typeof dump_state=="undefined"&&(dump_state=!1),this.should_dump_state=!1,this.should_dump_state=dump_state,this.reset_classloader_cache(),this.reset_system_properties()}return JVM.prototype.dump_state=function(){this.should_dump_state&&this._rs.curr_thread.dump_state(this._rs)},JVM.prototype.reset_classloader_cache=function(){this.bs_cl=new ClassLoader.BootstrapClassLoader(this)},JVM.prototype.reset_system_properties=function(){this.system_properties={"java.class.path":[],"java.home":vendor_path+"/java_home","sun.boot.class.path":vendor_path+"/classes","file.encoding":"UTF-8","java.vendor":"Doppio","java.version":"1.6","java.vendor.url":"https://github.com/int3/doppio","java.class.version":"50.0","java.specification.version":"1.6","line.separator":"\n","file.separator":"/","path.separator":":","user.dir":path.resolve("."),"user.home":".","user.name":"DoppioUser","os.name":"doppio","os.arch":"js","os.version":"0","java.vm.name":"Doppio 64-bit VM","java.vm.vendor":"Doppio Inc.","java.awt.headless":(typeof node=="undefined"||node===null).toString(),"java.awt.graphicsenv":"classes.awt.CanvasGraphicsEnvironment",useJavaUtilZip:"true","jline.terminal":"jline.UnsupportedTerminal"}},JVM.prototype.read_classfile=function(cls,cb,failure_cb){function try_get(i){fs.readFile(cpath[i]+cls+".class",function(err,data){err?i+1==cpath.length?failure_cb(function(){throw new Error("Error: No file found for class "+cls)}):try_get(i+1):cb(data)})}cls=cls.slice(1,-1);var cpath=this.system_properties["java.class.path"];try_get(0)},JVM.prototype.set_classpath=function(jcl_path,classpath){var dirs=classpath.split(":");dirs.push(jcl_path);var tmp_classpath=[];for(var i=0;i<dirs.length;i++){var cp=path.normalize(dirs[i]);cp.charAt(cp.length-1)!=="/"&&(cp+="/"),tmp_classpath.push(cp)}this.system_properties["java.class.path"]=tmp_classpath},JVM.prototype.prepend_classpath=function(classpath){var p=path.normalize(classpath);p.charAt(p.length-1)!=="/"&&(p+="/"),this.system_properties["java.class.path"].unshift(p)},JVM.prototype.run_class=function(print,_async_input,class_name,cmdline_args,done_cb){function run_main(){trace("run_main"),rs.run_until_finished(function(){rs.async_op(function(resume_cb,except_cb){_this.bs_cl.initialize_class(rs,class_descriptor,function(cls){return rs.init_args(cmdline_args),rs.run_until_finished(function(){main_method=cls.method_lookup(rs,main_sig);if(main_method!=null)return;return rs.async_op(function(resume_cb,except_cb){cls.resolve_method(rs,main_sig,function(m){return main_method=m,except_cb(function(){})},except_cb)})},!0,function(success){return(!success||main_method==null)&&typeof done_cb=="function"&&done_cb(success),rs.run_until_finished(function(){return main_method.setup_stack(rs)},!1,function(success){typeof done_cb=="function"&&done_cb(success&&!rs.unusual_termination)})})},except_cb)})},!0,done_cb)}function run_program(){trace("run_program"),rs.run_until_finished(function(){rs.init_threads()},!0,function(success){if(!success)return;rs.system_initialized!=null?run_main():rs.run_until_finished(function(){rs.init_system_class()},!0,function(success){if(!success)return;run_main()})})}var class_descriptor="L"+class_name+";",main_sig="main([Ljava/lang/String;)V",main_method=null,rs=this._rs=new runtime.RuntimeState(print,_async_input,this),_this=this;return rs.run_until_finished(function(){return rs.async_op(function(resume_cb,except_cb){return rs.preinitialize_core_classes(run_program,function(e){e()})})},!0,function(){})},JVM}();exports.JVM=JVM});var __extends=this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);__.prototype=b.prototype,d.prototype=new __};define("src/methods",["require","exports","./util","./opcodes","./attributes","./natives","./logging","./jvm","./exceptions","./java_object","./threading"],function(require,exports,__util__,__opcodes__,__attributes__,__natives__,__logging__,__jvm__,__exceptions__,__java_object__,__threading__){var util=__util__,opcodes=__opcodes__,attributes=__attributes__,natives=__natives__,logging=__logging__,jvm=__jvm__,exceptions=__exceptions__,java_object=__java_object__,threading=__threading__,ReturnException=exceptions.ReturnException,vtrace=logging.vtrace,trace=logging.trace,debug_vars=logging.debug_vars,native_methods=natives.native_methods,trapped_methods=natives.trapped_methods,JavaArray=java_object.JavaArray,JavaObject=java_object.JavaObject,AbstractMethodField=function(){function AbstractMethodField(cls){this.cls=cls}return AbstractMethodField.prototype.parse=function(bytes_array,constant_pool,idx){this.idx=idx,this.access_byte=bytes_array.get_uint(2),this.access_flags=util.parse_flags(this.access_byte),this.name=constant_pool.get(bytes_array.get_uint(2)).value,this.raw_descriptor=constant_pool.get(bytes_array.get_uint(2)).value,this.parse_descriptor(this.raw_descriptor),this.attrs=attributes.make_attributes(bytes_array,constant_pool)},AbstractMethodField.prototype.get_attribute=function(name){for(var i=0;i<this.attrs.length;i++){var attr=this.attrs[i];if(attr.name===name)return attr}return null},AbstractMethodField.prototype.get_attributes=function(name){return this.attrs.filter(function(attr){return attr.name===name})},AbstractMethodField.prototype.parse_descriptor=function(raw_descriptor){throw new Error("Unimplemented error.")},AbstractMethodField}();exports.AbstractMethodField=AbstractMethodField;var Field=function(_super){function Field(){_super.apply(this,arguments)}return __extends(Field,_super),Field.prototype.parse_descriptor=function(raw_descriptor){this.type=raw_descriptor},Field.prototype.reflector=function(rs,success_fn,failure_fn){function create_obj(clazz_obj,type_obj){var field_cls=rs.get_bs_class("Ljava/lang/reflect/Field;");return new JavaObject(rs,field_cls,{"Ljava/lang/reflect/Field;clazz":clazz_obj,"Ljava/lang/reflect/Field;name":rs.init_string(_this.name,!0),"Ljava/lang/reflect/Field;type":type_obj,"Ljava/lang/reflect/Field;modifiers":_this.access_byte,"Ljava/lang/reflect/Field;slot":_this.idx,"Ljava/lang/reflect/Field;signature":sig!=null?rs.init_string(sig):null})}var _this=this,found=this.get_attribute("Signature"),sig=found!=null?found.sig:null,clazz_obj=this.cls.get_class_object(rs);this.cls.loader.resolve_class(rs,this.type,function(type_cls){var type_obj=type_cls.get_class_object(rs),rv=create_obj(clazz_obj,type_obj);success_fn(rv)},failure_fn)},Field}(AbstractMethodField);exports.Field=Field;var Method=function(_super){function Method(){_super.apply(this,arguments)}return __extends(Method,_super),Method.prototype.parse_descriptor=function(raw_descriptor){this.reset_caches=!1;var match=/\(([^)]*)\)(.*)/.exec(raw_descriptor),param_str=match[1],return_str=match[2],param_carr=param_str.split("");this.param_types=[];var field;while(field=util.carr2descriptor(param_carr))this.param_types.push(field);this.param_bytes=0;for(var i=0;i<this.param_types.length;i++){var p=this.param_types[i];this.param_bytes+=p==="D"||p==="J"?2:1}this.access_flags["static"]||this.param_bytes++,this.num_args=this.param_types.length,this.access_flags["static"]||this.num_args++,this.return_type=return_str},Method.prototype.full_signature=function(){return this.cls.get_type()+"::"+this.name+this.raw_descriptor},Method.prototype.parse=function(bytes_array,constant_pool,idx){_super.prototype.parse.call(this,bytes_array,constant_pool,idx);var sig=this.full_signature(),c;(c=trapped_methods[sig])!=null?(this.code=c,this.access_flags["native"]=!0):this.access_flags["native"]?(c=native_methods[sig])!=null?this.code=c:sig.indexOf("::registerNatives()V",1)<0&&sig.indexOf("::initIDs()V",1)<0?(jvm.show_NYI_natives&&console.log(sig),this.code=function(rs){rs.java_throw(rs.get_bs_class("Ljava/lang/UnsatisfiedLinkError;"),"Native method '"+sig+"' not implemented.\nPlease fix or file a bug at https://github.com/int3/doppio/issues")}):this.code=null:this.access_flags.abstract||(this.has_bytecode=!0,this.code=this.get_attribute("Code"))},Method.prototype.reflector=function(rs,is_constructor,success_fn,failure_fn){var _ref3,_ref4,_ref5,_ref6,_ref7,_this=this;is_constructor==null&&(is_constructor=!1);var typestr=is_constructor?"Ljava/lang/reflect/Constructor;":"Ljava/lang/reflect/Method;",exceptions=(_ref3=(_ref4=this.get_attribute("Exceptions"))!=null?_ref4.exceptions:void 0)!=null?_ref3:[],anns=(_ref5=this.get_attribute("RuntimeVisibleAnnotations"))!=null?_ref5.raw_bytes:void 0,adefs=(_ref6=this.get_attribute("AnnotationDefault"))!=null?_ref6.raw_bytes:void 0,sig=(_ref7=this.get_attribute("Signature"))!=null?_ref7.sig:void 0,obj={},clazz_obj=this.cls.get_class_object(rs);this.cls.loader.resolve_class(rs,this.return_type,function(rt_cls){function fetch_catch_type(){if(k<handlers.length){var eh=handlers[k++];return eh.catch_type==="<any>"?fetch_catch_type():_this.cls.loader.resolve_class(rs,eh.catch_type,fetch_catch_type,failure_fn)}return fetch_ptype()}function fetch_etype(){j++;if(j<exceptions.length){var e_desc=exceptions[j];return _this.cls.loader.resolve_class(rs,e_desc,function(cls){return etype_objs[j]=cls.get_class_object(rs),fetch_etype()},failure_fn)}var jco_arr_cls=rs.get_bs_class("[Ljava/lang/Class;"),byte_arr_cls=rs.get_bs_class("[B"),cls=rs.get_bs_class(typestr);return obj[typestr+"clazz"]=clazz_obj,obj[typestr+"name"]=rs.init_string(_this.name,!0),obj[typestr+"parameterTypes"]=new JavaArray(rs,jco_arr_cls,param_type_objs),obj[typestr+"returnType"]=rt_obj,obj[typestr+"exceptionTypes"]=new JavaArray(rs,jco_arr_cls,etype_objs),obj[typestr+"modifiers"]=_this.access_byte,obj[typestr+"slot"]=_this.idx,obj[typestr+"signature"]=sig!=null?rs.init_string(sig):null,obj[typestr+"annotations"]=anns!=null?new JavaArray(rs,byte_arr_cls,anns):null,obj[typestr+"annotationDefault"]=adefs!=null?new JavaArray(rs,byte_arr_cls,adefs):null,success_fn(new JavaObject(rs,cls,obj))}function fetch_ptype(){return i++,i<_this.param_types.length?_this.cls.loader.resolve_class(rs,_this.param_types[i],function(cls){return param_type_objs[i]=cls.get_class_object(rs),fetch_ptype()},failure_fn):fetch_etype()}var rt_obj=rt_cls.get_class_object(rs),j=-1,etype_objs=[],i=-1,param_type_objs=[],k=0,handlers;return _this.code!=null&&_this.code.exception_handlers!=null&&_this.code.exception_handlers.length>0?(handlers=[{catch_type:"Ljava/lang/Throwable;"}],Array.prototype.push.apply(handlers,_this.code.exception_handlers)):handlers=[],fetch_catch_type()},failure_fn)},Method.prototype.take_params=function(caller_stack){var start=caller_stack.length-this.param_bytes,params=caller_stack.slice(start);return caller_stack.length-=this.param_bytes,params},Method.prototype.convert_params=function(rs,params){var converted_params=[rs],param_idx=0;this.access_flags["static"]||(converted_params.push(params[0]),param_idx=1);for(var i=0;i<this.param_types.length;i++){var p=this.param_types[i];converted_params.push(params[param_idx]),param_idx+=p==="J"||p==="D"?2:1}return converted_params},Method.prototype.run_manually=function(func,rs,converted_params){trace("entering native method "+this.full_signature());var rv;try{rv=func.apply(null,converted_params)}catch(_error){var e=_error;if(e===ReturnException)return;throw e}rs.meta_stack().pop();var ret_type=this.return_type;ret_type!=="V"&&(ret_type==="Z"?rs.push(rv+0):rs.push(rv),(ret_type==="J"||ret_type==="D")&&rs.push(null))},Method.prototype.initialize=function(){this.reset_caches=!0},Method.prototype.method_lock=function(rs){return this.access_flags["static"]?this.cls.get_class_object(rs):rs.cl(0)},Method.prototype.run_bytecode=function(rs){trace("entering method "+this.full_signature());var code=this.code.opcodes;if(this.reset_caches)for(var i=0;i<code.length;i++){var instr=code[i];instr!=null&&instr.reset_cache()}var cf=rs.curr_frame();if(this.access_flags.synchronized&&cf.pc===0&&!opcodes.monitorenter(rs,this.method_lock(rs))){cf.pc=0;return}var op=code[cf.pc];while(!rs.should_return){var annotation;if(op.execute(rs)===!1)break;cf.pc+=1+op.byte_count,op=code[cf.pc]}rs.should_return=!1},Method.prototype.setup_stack=function(runtime_state){var sf,_this=this,ms=runtime_state.meta_stack(),caller_stack=runtime_state.curr_frame().stack,params=this.take_params(caller_stack);if(this.access_flags["native"]){if(this.code!=null){ms.push(sf=new threading.StackFrame(this,[],[]));var c_params=this.convert_params(runtime_state,params);return sf.runner=function(){return _this.run_manually(_this.code,runtime_state,c_params)},sf}return null}if(this.access_flags.abstract){var err_cls=runtime_state.get_bs_class("Ljava/lang/Error;");runtime_state.java_throw(err_cls,"called abstract method: "+this.full_signature())}ms.push(sf=new threading.StackFrame(this,params,[]));if(this.code.run_stamp<runtime_state.run_stamp){this.code.run_stamp=runtime_state.run_stamp,this.code.parse_code();if(this.access_flags.synchronized)for(var i in this.code.opcodes){var c=this.code.opcodes[i];c.name.match(/^[ildfa]?return$/)&&function(c){c.execute=function(rs){return opcodes.monitorexit(rs,_this.method_lock(rs)),c.orig_execute(rs)}}(c)}}return sf.runner=function(){return _this.run_bytecode(runtime_state)},sf},Method}(AbstractMethodField);exports.Method=Method});var __extends=this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);__.prototype=b.prototype,d.prototype=new __};define("src/ClassData",["require","exports","./util","./ConstantPool","./attributes","./java_object","./logging","./methods","./natives","./enums"],function(require,exports,__util__,__ConstantPool__,__attributes__,__java_object__,__logging__,__methods__,__natives__,__enums__){var util=__util__,ConstantPool=__ConstantPool__,attributes=__attributes__,java_object=__java_object__,JavaObject=java_object.JavaObject,JavaClassObject=java_object.JavaClassObject,logging=__logging__,methods=__methods__,natives=__natives__,enums=__enums__,ClassState=enums.ClassState,trace=logging.trace,ClassData=function(){function ClassData(loader){this.access_flags=null,this.state=ClassState.LOADED,this.jco=null,this.reset_bit=0,natives.instantiated||natives.instantiate(ReferenceClassData,PrimitiveClassData,ArrayClassData),this.loader=loader!=null?loader:null}return ClassData.prototype.reset=function(){this.jco=null,this.reset_bit=0;var sc=this.get_super_class();sc!=null&&sc.reset_bit===1&&sc.reset();var ifaces=this.get_interfaces();for(var i=0;i<ifaces.length;i++){var iface=ifaces[i];iface.reset_bit===1&&iface.reset()}},ClassData.prototype.toExternalString=function(){return util.ext_classname(this.this_class)},ClassData.prototype.get_class_loader=function(){return this.loader},ClassData.prototype.get_type=function(){return this.this_class},ClassData.prototype.get_super_class_type=function(){return this.super_class},ClassData.prototype.get_super_class=function(){return this.super_class_cdata},ClassData.prototype.get_interface_types=function(){return[]},ClassData.prototype.get_interfaces=function(){return[]},ClassData.prototype.get_class_object=function(rs){return this.jco==null&&(this.jco=new JavaClassObject(rs,this)),this.jco},ClassData.prototype.get_method=function(name){return null},ClassData.prototype.get_methods=function(){return{}},ClassData.prototype.get_fields=function(){return[]},ClassData.prototype.method_lookup=function(rs,sig){var err_cls=rs.get_bs_class("Ljava/lang/NoSuchMethodError;");return rs.java_throw(err_cls,"No such method found in "+util.ext_classname(this.get_type())+"::"+sig),null},ClassData.prototype.field_lookup=function(rs,name){var err_cls=rs.get_bs_class("Ljava/lang/NoSuchFieldError;");return rs.java_throw(err_cls,"No such field found in "+util.ext_classname(this.get_type())+"::"+name),null},ClassData.prototype.set_state=function(state){this.state=state},ClassData.prototype.get_state=function(){if(this.state==ClassState.RESOLVED&&this.get_method("<clinit>()V")==null){var scls=this.get_super_class();scls!=null&&scls.get_state()===ClassState.INITIALIZED&&(this.state=ClassState.INITIALIZED)}return this.state},ClassData.prototype.is_initialized=function(){return this.get_state()===ClassState.INITIALIZED},ClassData.prototype.is_resolved=function(){return this.get_state()!==ClassState.LOADED},ClassData.prototype.is_subinterface=function(target){return!1},ClassData.prototype.is_subclass=function(target){return this===target?!0:this.get_super_class()==null?!1:this.get_super_class().is_subclass(target)},ClassData.prototype.is_castable=function(target){throw new Error("Unimplemented.")},ClassData}();exports.ClassData=ClassData;var PrimitiveClassData=function(_super){function PrimitiveClassData(this_class,loader){_super.call(this,loader),this.this_class=this_class,this.set_state(ClassState.INITIALIZED)}return __extends(PrimitiveClassData,_super),PrimitiveClassData.prototype.is_castable=function(target){return this.this_class===target.this_class},PrimitiveClassData.prototype.box_class_name=function(){switch(this.this_class){case"B":return"Ljava/lang/Byte;";case"C":return"Ljava/lang/Character;";case"D":return"Ljava/lang/Double;";case"F":return"Ljava/lang/Float;";case"I":return"Ljava/lang/Integer;";case"J":return"Ljava/lang/Long;";case"S":return"Ljava/lang/Short;";case"Z":return"Ljava/lang/Boolean;";default:throw new Error("Tried to box a non-primitive class: "+this.this_class)}},PrimitiveClassData.prototype.create_wrapper_object=function(rs,value){var box_name=this.box_class_name(),box_cls=rs.get_bs_class(box_name),wrapped=new JavaObject(rs,box_cls);return wrapped.fields[box_name+"value"]=value,wrapped},PrimitiveClassData}(ClassData);exports.PrimitiveClassData=PrimitiveClassData;var ArrayClassData=function(_super){function ArrayClassData(component_type,loader){_super.call(this,loader),this.component_type=component_type,this.this_class="["+this.component_type,this.super_class="Ljava/lang/Object;",this.access_flags=util.parse_flags(0)}return __extends(ArrayClassData,_super),ArrayClassData.prototype.reset=function(){_super.prototype.reset.call(this);var ccls=this.get_component_class();ccls&&ccls.reset_bit&&ccls.reset()},ArrayClassData.prototype.get_component_type=function(){return this.component_type},ArrayClassData.prototype.get_component_class=function(){return this.component_class_cdata},ArrayClassData.prototype.field_lookup=function(rs,name){return this.super_class_cdata.field_lookup(rs,name)},ArrayClassData.prototype.method_lookup=function(rs,sig){return this.super_class_cdata.method_lookup(rs,sig)},ArrayClassData.prototype.set_resolved=function(super_class_cdata,component_class_cdata){this.super_class_cdata=super_class_cdata,this.component_class_cdata=component_class_cdata,this.set_state(ClassState.INITIALIZED)},ArrayClassData.prototype.is_castable=function(target){if(!(target instanceof ArrayClassData)){if(target instanceof PrimitiveClassData)return!1;if(target.access_flags["interface"]){var type=target.get_type();return type==="Ljava/lang/Cloneable;"||type==="Ljava/io/Serializable;"}return target.get_type()==="Ljava/lang/Object;"}return this.get_component_class().is_castable(target.get_component_class())},ArrayClassData}(ClassData);exports.ArrayClassData=ArrayClassData;var ReferenceClassData=function(_super){function ReferenceClassData(buffer,loader){_super.call(this,loader);var bytes_array=new util.BytesArray(buffer);if(bytes_array.get_uint(4)!==3405691582)throw"Magic number invalid";this.minor_version=bytes_array.get_uint(2),this.major_version=bytes_array.get_uint(2);if(!(45<=this.major_version&&this.major_version<=51))throw"Major version invalid";this.constant_pool=new ConstantPool.ConstantPool,this.constant_pool.parse(bytes_array),this.access_byte=bytes_array.get_uint(2),this.access_flags=util.parse_flags(this.access_byte),this.this_class=this.constant_pool.get(bytes_array.get_uint(2)).deref();var super_ref=bytes_array.get_uint(2);super_ref!==0&&(this.super_class=this.constant_pool.get(super_ref).deref());var isize=bytes_array.get_uint(2);this.interfaces=[];for(var _i=0;_i<isize;++_i)this.interfaces.push(this.constant_pool.get(bytes_array.get_uint(2)).deref());var num_fields=bytes_array.get_uint(2);this.fields=[];for(var _i=0;_i<num_fields;++_i)this.fields.push(new methods.Field(this));this.fl_cache={};for(var i=0,_len=this.fields.length;i<_len;++i){var f=this.fields[i];f.parse(bytes_array,this.constant_pool,i),this.fl_cache[f.name]=f}var num_methods=bytes_array.get_uint(2);this.methods={},this.ml_cache={};for(var i=0;i<num_methods;i+=1){var m=new methods.Method(this);m.parse(bytes_array,this.constant_pool,i);var mkey=m.name+m.raw_descriptor;this.methods[mkey]=m}this.attrs=attributes.make_attributes(bytes_array,this.constant_pool);if(bytes_array.has_bytes())throw"Leftover bytes in classfile: "+bytes_array;this.static_fields=Object.create(null)}return __extends(ReferenceClassData,_super),ReferenceClassData.prototype.reset=function(){_super.prototype.reset.call(this),this.get_state()===ClassState.INITIALIZED&&this.set_state(ClassState.LOADED),this.static_fields=Object.create(null);for(var k in this.methods)this.methods[k].initialize()},ReferenceClassData.prototype.get_interfaces=function(){return this.interface_cdatas},ReferenceClassData.prototype.get_interface_types=function(){return this.interfaces},ReferenceClassData.prototype.get_fields=function(){return this.fields},ReferenceClassData.prototype.get_method=function(sig){return this.methods[sig]},ReferenceClassData.prototype.get_methods=function(){return this.methods},ReferenceClassData.prototype.get_attribute=function(name){var attrs=this.attrs;for(var i=0;i<attrs.length;i++){var attr=attrs[i];if(attr.name===name)return attr}return null},ReferenceClassData.prototype.get_attributes=function(name){var attrs=this.attrs,results=[];for(var i=0;i<attrs.length;i++){var attr=attrs[i];attr.name===name&&results.push(attr)}return results},ReferenceClassData.prototype.get_default_fields=function(){return this.default_fields?this.default_fields:(this.construct_default_fields(),this.default_fields)},ReferenceClassData.prototype._initialize_static_field=function(rs,name){var f=this.fl_cache[name];if(f!=null&&f.access_flags["static"]){var cva=f.get_attribute("ConstantValue");if(cva!=null)var cv=f.type==="Ljava/lang/String;"?rs.init_string(cva.value):cva.value;this.static_fields[name]=cv!=null?cv:util.initial_value(f.raw_descriptor)}else rs.java_throw(this.loader.get_initialized_class("Ljava/lang/NoSuchFieldError;"),name)},ReferenceClassData.prototype.static_get=function(rs,name){return this.static_fields[name]!==void 0?this.static_fields[name]:(this._initialize_static_field(rs,name),this.static_get(rs,name))},ReferenceClassData.prototype.static_put=function(rs,name,val){this.static_fields[name]!==void 0?this.static_fields[name]=val:(this._initialize_static_field(rs,name),this.static_put(rs,name,val))},ReferenceClassData.prototype.set_resolved=function(super_class_cdata,interface_cdatas){this.super_class_cdata=super_class_cdata,trace("Class "+this.get_type()+" is now resolved."),this.interface_cdatas=interface_cdatas,this.set_state(ClassState.RESOLVED)},ReferenceClassData.prototype.construct_default_fields=function(){var cls=this;this.default_fields=Object.create(null);while(cls!=null){var fields=cls.fields;for(var i=0;i<fields.length;i++){var f=fields[i];if(!!f.access_flags["static"])continue;var val=util.initial_value(f.raw_descriptor);this.default_fields[cls.get_type()+f.name]=val}cls=cls.get_super_class()}},ReferenceClassData.prototype.field_lookup=function(rs,name,null_handled){var field=this.fl_cache[name];if(field!=null)return field;field=this._field_lookup(rs,name);if(field!=null||null_handled===!0)return this.fl_cache[name]=field,field;var err_cls=rs.get_bs_class("Ljava/lang/NoSuchFieldError;");return rs.java_throw(err_cls,"No such field found in "+util.ext_classname(this.get_type())+"::"+name),null},ReferenceClassData.prototype._field_lookup=function(rs,name){for(var i=0;i<this.fields.length;i++){var field=this.fields[i];if(field.name===name)return field}var ifaces=this.get_interfaces();for(var i=0;i<ifaces.length;i++){var field=ifaces[i].field_lookup(rs,name,!0);if(field!=null)return field}var sc=this.get_super_class();if(sc!=null){var field=sc.field_lookup(rs,name,!0);if(field!=null)return field}return null},ReferenceClassData.prototype.method_lookup=function(rs,sig){if(this.ml_cache[sig]!=null)return this.ml_cache[sig];var method=this._method_lookup(rs,sig);if(method==null){var err_cls=rs.get_bs_class("Ljava/lang/NoSuchMethodError;");rs.java_throw(err_cls,"No such method found in "+util.ext_classname(this.get_type())+"::"+sig)}if(method.code!=null&&method.code.exception_handlers!=null){var handlers=method.code.exception_handlers;for(var i=0;i<handlers.length;i++){var eh=handlers[i];if(eh.catch_type!=="<any>"&&this.loader.get_resolved_class(eh.catch_type,true)==null)return null}}return method},ReferenceClassData.prototype._method_lookup=function(rs,sig){if(sig in this.ml_cache)return this.ml_cache[sig];if(sig in this.methods)return this.ml_cache[sig]=this.methods[sig];var parent=this.get_super_class();if(parent!=null){this.ml_cache[sig]=parent._method_lookup(rs,sig);if(this.ml_cache[sig]!=null)return this.ml_cache[sig]}var ifaces=this.get_interfaces();for(var i=0;i<ifaces.length;i++){var ifc=ifaces[i];this.ml_cache[sig]=ifc._method_lookup(rs,sig);if(this.ml_cache[sig]!=null)return this.ml_cache[sig]}return this.ml_cache[sig]=null},ReferenceClassData.prototype.resolve_method=function(rs,sig,success_fn,failure_fn){var _this=this;trace("ASYNCHRONOUS: resolve_method "+sig);var m=this.method_lookup(rs,sig),handlers=m.code.exception_handlers;util.async_foreach(handlers,function(eh,next_item){eh.catch_type!=="<any>"&&!_this.loader.get_resolved_class(eh.catch_type,!0)?_this.loader.resolve_class(rs,eh.catch_type,next_item,failure_fn):next_item()},function(){return success_fn(m)})},ReferenceClassData.prototype.is_castable=function(target){if(!(target instanceof ReferenceClassData))return!1;if(!this.access_flags["interface"])return target.access_flags["interface"]?this.is_subinterface(target):this.is_subclass(target);if(target.access_flags["interface"])return this.is_subinterface(target);if(!target.access_flags["interface"])return target.get_type()==="Ljava/lang/Object;"},ReferenceClassData.prototype.is_subinterface=function(target){if(this.this_class===target.this_class)return!0;var ifaces=this.get_interfaces();for(var i=0;i<ifaces.length;i++){var super_iface=ifaces[i];if(super_iface.is_subinterface(target))return!0}return this.get_super_class()==null?!1:this.get_super_class().is_subinterface(target)},ReferenceClassData}(ClassData);exports.ReferenceClassData=ReferenceClassData});var __extends=this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);__.prototype=b.prototype,d.prototype=new __};define("src/ClassLoader",["require","exports","./ClassData","./util","./logging","./exceptions","./threading","./java_object","./enums"],function(require,exports,__ClassData__,__util__,__logging__,__exceptions__,__threading__,__java_object__,__enums__){var ClassData=__ClassData__,util=__util__,logging=__logging__,trace=logging.trace,exceptions=__exceptions__,JavaException=exceptions.JavaException,threading=__threading__,java_object=__java_object__,JavaObject=java_object.JavaObject,enums=__enums__,ClassState=enums.ClassState,ClassLoader=function(){function ClassLoader(bootstrap){this.bootstrap=bootstrap,this.loaded_classes=Object.create(null)}return ClassLoader.prototype.serialize=function(visited){throw new Error("Abstract method!")},ClassLoader.prototype.get_package_names=function(){var classes=this.get_loaded_class_list(!0),pkg_names={};for(var i=0;i<classes.length;i++){var cls=classes[i];pkg_names[cls.substring(0,cls.lastIndexOf("/")+1)]=!0}return Object.keys(pkg_names)},ClassLoader.prototype.get_loaded_class_list=function(ref_class_only){ref_class_only==null&&(ref_class_only=!1);if(ref_class_only){var loaded_classes=this.loaded_classes,results=[];for(var k in loaded_classes){var cdata=loaded_classes[k];"major_version"in cdata&&results.push(k.slice(1,-1))}return results}return Object.keys(this.loaded_classes)},ClassLoader.prototype.remove_class=function(type_str){this._rem_class(type_str);if(util.is_primitive_type(type_str))return;var loaded_classes=this.loaded_classes;for(var k in loaded_classes){var cdata=loaded_classes[k];(type_str===cdata.get_super_class_type()||cdata instanceof ClassData.ArrayClassData&&type_str===cdata.get_component_type())&&this.remove_class(k)}},ClassLoader.prototype._rem_class=function(type_str){delete this.loaded_classes[type_str]},ClassLoader.prototype._add_class=function(type_str,cdata){this.loaded_classes[type_str]=cdata},ClassLoader.prototype._get_class=function(type_str){var cdata=this.loaded_classes[type_str];return cdata!=null&&cdata.reset_bit===1&&cdata.reset(),cdata!=null?cdata:null},ClassLoader.prototype._try_define_array_class=function(type_str){var component_type=util.get_component_type(type_str),component_cdata=this.get_resolved_class(component_type,!0);return component_cdata==null?null:this._define_array_class(type_str,component_cdata)},ClassLoader.prototype._define_array_class=function(type_str,component_cdata){if(component_cdata.get_class_loader()!==this)return component_cdata.get_class_loader()._define_array_class(type_str,component_cdata);var cdata=new ClassData.ArrayClassData(component_cdata.get_type(),this);return this._add_class(type_str,cdata),cdata.set_resolved(this.bootstrap.get_resolved_class("Ljava/lang/Object;"),component_cdata),cdata},ClassLoader.prototype._parallel_class_resolve=function(rs,types,success_fn,failure_fn,explicit){var _this=this;explicit==null&&(explicit=!1);var pending_requests=types.length,failure=null,resolved=[],request_finished=function(){pending_requests--;if(pending_requests===0)return failure==null?success_fn(resolved):failure_fn(failure)},fetch_data=function(type){_this.resolve_class(rs,type,function(cdata){resolved.push(cdata),request_finished()},function(f_fn){failure=f_fn,request_finished()},explicit)};for(var i=0;i<types.length;i++)fetch_data(types[i])},ClassLoader.prototype._regular_class_resolve=function(rs,types,success_fn,failure_fn,explicit){var _this=this;explicit==null&&(explicit=!1);if(types.length===0)return success_fn(null);var resolved=[],fetch_class=function(type){_this.resolve_class(rs,type,function(cdata){resolved.push(cdata),types.length>0?fetch_class(types.shift()):success_fn(resolved)},failure_fn,explicit)};fetch_class(types.shift())},ClassLoader.prototype.define_class=function(rs,type_str,data,success_fn,failure_fn,parallel,explicit){function process_resolved_classes(cdatas){cdatas=resolved_already.concat(cdatas);var super_cdata=null,interface_cdatas=[],super_type=cdata.get_super_class_type();for(var j=0;j<cdatas.length;j++){var a_cdata=cdatas[j];type=a_cdata.get_type(),type===super_type?super_cdata=a_cdata:interface_cdatas.push(a_cdata)}cdata.set_resolved(super_cdata,interface_cdatas),success_fn(cdata)}var _this=this;parallel==null&&(parallel=!1),explicit==null&&(explicit=!1),trace("Defining class "+type_str+"...");var cdata=new ClassData.ReferenceClassData(data,this),type=cdata.get_type();if(type!==type_str){var msg=util.descriptor2typestr(type_str)+" (wrong name: "+util.descriptor2typestr(type)+")";failure_fn(function(){var err_cls=_this.get_initialized_class("Ljava/lang/NoClassDefFoundError;");rs.java_throw(err_cls,msg)})}this._add_class(type_str,cdata);var types=cdata.get_interface_types();types.push(cdata.get_super_class_type());var to_resolve=[],resolved_already=[];for(var i=0;i<types.length;i++){type=types[i];if(type==null)continue;var clsdata=this.get_resolved_class(type,!0);clsdata!=null?resolved_already.push(clsdata):to_resolve.push(type)}return to_resolve.length>0?this._regular_class_resolve(rs,to_resolve,process_resolved_classes,failure_fn,explicit):process_resolved_classes([])},ClassLoader.prototype.get_loaded_class=function(type_str,null_handled){null_handled==null&&(null_handled=!1);var cdata=this._get_class(type_str);if(cdata!=null)return cdata;if(util.is_array_type(type_str)){cdata=this._try_define_array_class(type_str);if(cdata!=null)return cdata}if(util.is_primitive_type(type_str))return this.bootstrap.get_primitive_class(type_str);if(null_handled)return null;throw new Error("Error in get_loaded_class: Class "+type_str+" is not loaded.")},ClassLoader.prototype.get_resolved_class=function(type_str,null_handled){null_handled==null&&(null_handled=!1);var cdata=this.get_loaded_class(type_str,null_handled);if(cdata!=null&&cdata.is_resolved())return cdata;if(null_handled)return null;throw new Error("Error in get_resolved_class: Class "+type_str+" is not resolved.")},ClassLoader.prototype.get_initialized_class=function(type_str,null_handled){null_handled==null&&(null_handled=!1);var cdata=this.get_resolved_class(type_str,null_handled);if(cdata!=null&&cdata.is_initialized())return cdata;if(null_handled)return null;throw new Error("Error in get_initialized_class: Class "+type_str+" is not initialized.")},ClassLoader.prototype._initialize_class=function(rs,cdata,success_fn,failure_fn){var _this=this;trace("Actually initializing class "+cdata.get_type()+"...");if(!(cdata instanceof ClassData.ReferenceClassData))throw new Error("Tried to initialize a non-reference type: "+cdata.get_type());var first_clinit=!0,first_native_frame=threading.StackFrame.native_frame("$clinit",function(){if(rs.curr_frame()!==first_native_frame)throw new Error("The top of the meta stack should be this native frame, but it is not: "+rs.curr_frame().name+" at "+rs.meta_stack().length());return rs.meta_stack().pop(),rs.async_op(function(){return success_fn(cdata)})},function(e){rs.curr_frame().cdata.reset();if(e instanceof JavaException){if(e.exception.cls.get_type()==="Ljava/lang/NoClassDefFoundError;")throw rs.meta_stack().pop(),e;var nf=rs.curr_frame();nf.runner=function(){var rv=rs.pop();throw rs.meta_stack().pop(),new JavaException(rv)},nf.error=function(){return rs.meta_stack().pop(),failure_fn(function(){throw e})};var cls=_this.bootstrap.get_resolved_class("Ljava/lang/ExceptionInInitializerError;"),v=new JavaObject(rs,cls);return rs.push_array([v,v,e.exception]),cls.method_lookup(rs,"<init>(Ljava/lang/Throwable;)V").setup_stack(rs)}throw rs.meta_stack().pop(),e});first_native_frame.cdata=cdata;var class_file=cdata;while(class_file!=null&&!class_file.is_initialized()){trace("initializing class: "+class_file.get_type()),class_file.set_state(ClassState.INITIALIZED);var clinit=class_file.get_method("<clinit>()V");if(clinit!=null){trace("	Found <clinit>. Pushing stack frame.");if(first_clinit)trace("	First <clinit> in the loop."),first_clinit=!1,rs.meta_stack().push(first_native_frame);else{var next_nf=threading.StackFrame.native_frame("$clinit_secondary",function(){return rs.meta_stack().pop()},function(e){rs.curr_frame().cdata.reset(),rs.meta_stack().pop();while(!rs.curr_frame()["native"])rs.meta_stack().pop();return rs.async_op(function(){failure_fn(function(){throw e},!0)})});next_nf.cdata=class_file,rs.meta_stack().push(next_nf)}clinit.setup_stack(rs)}class_file=class_file.get_super_class()}if(!first_clinit){rs.run_until_finished(function(){},!1,rs.stashed_done_cb);return}success_fn(cdata)},ClassLoader.prototype.initialize_class=function(rs,type_str,success_fn,failure_fn,explicit){var _this=this;explicit==null&&(explicit=!1),trace("Initializing class "+type_str+"...");var cdata=this.get_initialized_class(type_str,!0);if(cdata!=null)return success_fn(cdata);if(util.is_array_type(type_str)){var component_type=util.get_component_type(type_str);this.resolve_class(rs,component_type,function(cdata){return success_fn(_this._define_array_class(type_str,cdata))},failure_fn,explicit);return}return cdata=this.get_resolved_class(type_str,!0),cdata!=null?this._initialize_class(rs,cdata,success_fn,failure_fn):this.resolve_class(rs,type_str,function(cdata){return cdata.is_initialized()?success_fn(cdata):_this._initialize_class(rs,cdata,success_fn,failure_fn)},failure_fn,explicit)},ClassLoader.prototype.resolve_class=function(rs,type_str,success_fn,failure_fn,explicit){var _this=this;explicit==null&&(explicit=!1),trace("Resolving class "+type_str+"... [general]");var rv=this.get_resolved_class(type_str,!0);if(rv!=null)return success_fn(rv);if(util.is_array_type(type_str)){var component_type=util.get_component_type(type_str);this.resolve_class(rs,component_type,function(cdata){return success_fn(_this._define_array_class(type_str,cdata))},failure_fn,explicit);return}return this._resolve_class(rs,type_str,success_fn,failure_fn,explicit)},ClassLoader.prototype._resolve_class=function(rs,type_str,success_fn,failure_fn,explicit){throw new Error("Unimplemented.")},ClassLoader}();exports.ClassLoader=ClassLoader;var BootstrapClassLoader=function(_super){function BootstrapClassLoader(jvm_state){_super.call(this,this),this.jvm_state=jvm_state}return __extends(BootstrapClassLoader,_super),BootstrapClassLoader.prototype.serialize=function(visited){if("bootstrapLoader"in visited)return"<*bootstrapLoader>";visited.bootstrapLoader=!0;var loaded={},loaded_classes=this.loaded_classes;for(var type in loaded_classes){var cls=loaded_classes[type];type!=="__proto__"&&(loaded[""+type+"("+ClassState[cls.get_state()]+")"]=cls.loader.serialize(visited))}return{ref:"bootstrapLoader",loaded:loaded}},BootstrapClassLoader.prototype.reset=function(){var loaded_classes=this.loaded_classes;for(var cname in loaded_classes){var cls=loaded_classes[cname];cname!=="__proto__"&&(cls.reset_bit=1)}},BootstrapClassLoader.prototype.get_primitive_class=function(type_str){var cdata=this._get_class(type_str);return cdata!=null?cdata:(cdata=new ClassData.PrimitiveClassData(type_str,this),this._add_class(type_str,cdata),cdata)},BootstrapClassLoader.prototype._resolve_class=function(rs,type_str,success_fn,failure_fn,explicit){var _this=this;explicit==null&&(explicit=!1),trace("ASYNCHRONOUS: resolve_class "+type_str+" [bootstrap]");var rv=this.get_resolved_class(type_str,!0);if(rv!=null)return success_fn(rv);this.jvm_state.read_classfile(type_str,function(data){_this.define_class(rs,type_str,data,success_fn,failure_fn,!0,explicit)},function(e){try{e()}catch(exp){trace("Failed to read class "+type_str+": "+exp+"\n"+exp.stack)}return failure_fn(function(){rs.meta_stack().push(threading.StackFrame.native_frame("$class_not_found",function(){rs.curr_frame().runner=function(){var rv=rs.pop();throw rs.meta_stack().pop(),new JavaException(rv)};if(!explicit){var rv=rs.pop(),cls=_this.bootstrap.get_initialized_class("Ljava/lang/NoClassDefFoundError;"),v=new JavaObject(rs,cls);return rs.push_array([v,v,rv]),cls.method_lookup(rs,"<init>(Ljava/lang/Throwable;)V").setup_stack(rs)}},function(){return rs.meta_stack().pop(),failure_fn(function(){throw new Error("Failed to throw a "+(explicit?"ClassNotFoundException":"NoClassDefFoundError")+".")})}));var cls=_this.bootstrap.get_initialized_class("Ljava/lang/ClassNotFoundException;"),v=new JavaObject(rs,cls),msg=rs.init_string(util.ext_classname(type_str));return rs.push_array([v,v,msg]),cls.method_lookup(rs,"<init>(Ljava/lang/String;)V").setup_stack(rs)})})},BootstrapClassLoader}(ClassLoader);exports.BootstrapClassLoader=BootstrapClassLoader;var CustomClassLoader=function(_super){function CustomClassLoader(bootstrap,loader_obj){_super.call(this,bootstrap),this.loader_obj=loader_obj}return __extends(CustomClassLoader,_super),CustomClassLoader.prototype.serialize=function(visited){return this.loader_obj.serialize(visited)},CustomClassLoader.prototype._resolve_class=function(rs,type_str,success_fn,failure_fn,explicit){var _this=this;explicit==null&&(explicit=!1),trace("ASYNCHRONOUS: resolve_class "+type_str+" [custom]"),rs.meta_stack().push(threading.StackFrame.native_frame("$"+this.loader_obj.cls.get_type(),function(){var jclo=rs.pop();rs.meta_stack().pop();var cls=jclo.$cls;return _this.get_resolved_class(type_str,true)==null&&_this._add_class(type_str,cls),rs.async_op(function(){return success_fn(cls)})},function(e){return rs.meta_stack().pop(),rs.async_op(function(){return failure_fn(function(){throw e})})})),rs.push2(this.loader_obj,rs.init_string(util.ext_classname(type_str))),this.loader_obj.cls.method_lookup(rs,"loadClass(Ljava/lang/String;)Ljava/lang/Class;").setup_stack(rs),rs.run_until_finished(function(){},!1,rs.stashed_done_cb)},CustomClassLoader}(ClassLoader);exports.CustomClassLoader=CustomClassLoader}),define("src/runtime",["require","exports","./gLong","./util","./logging","./exceptions","./java_object","./ClassLoader","./threading"],function(require,exports,__gLong__,__util__,__logging__,__exceptions__,__java_object__,__ClassLoader__,__threading__){var gLong=__gLong__,util=__util__,logging=__logging__,exceptions=__exceptions__,java_object=__java_object__,ClassLoader=__ClassLoader__,threading=__threading__,vtrace=logging.vtrace,trace=logging.trace,debug=logging.debug,error=logging.error,YieldIOException=exceptions.YieldIOException,ReturnException=exceptions.ReturnException,JavaException=exceptions.JavaException,JavaObject=java_object.JavaObject,JavaArray=java_object.JavaArray,process=typeof node!="undefined"?node.process:global.process,run_count=0,RuntimeState=function(){function RuntimeState(print,_async_input,jvm_state){this.print=print,this._async_input=_async_input,this.jvm_state=jvm_state,this.input_buffer=[],this.startup_time=gLong.fromNumber((new Date).getTime()),this.run_stamp=++run_count,this.mem_start_addrs=[1],this.mem_blocks={},this.high_oref=1,this.string_pool=new util.SafeMap,this.lock_refs={},this.lock_counts={},this.waiting_threads={},this.thread_pool=[],this.should_return=!1;var ct=new threading.JavaThreadObject(this,null);this.curr_thread=ct,this.max_m_count=1e5}return RuntimeState.prototype.get_bs_cl=function(){return this.jvm_state.bs_cl},RuntimeState.prototype.get_bs_class=function(type,handle_null){return handle_null==null&&(handle_null=!1),this.jvm_state.bs_cl.get_initialized_class(type,handle_null)},RuntimeState.prototype.get_class=function(type,handle_null){return handle_null==null&&(handle_null=!1),this.curr_frame().method.cls.loader.get_initialized_class(type,handle_null)},RuntimeState.prototype.get_cl=function(){return this.curr_frame().method.cls.loader},RuntimeState.prototype.construct_cl=function(jclo){return new ClassLoader.CustomClassLoader(this.get_bs_cl(),jclo)},RuntimeState.prototype.preinitialize_core_classes=function(resume_cb,except_cb){var core_classes=["Ljava/lang/Class;","Ljava/lang/ClassLoader;","Ljava/lang/String;","Ljava/lang/Error;","Ljava/lang/StackTraceElement;","Ljava/io/ExpiringCache;","Ljava/io/FileDescriptor;","Ljava/io/FileNotFoundException;","Ljava/io/IOException;","Ljava/io/Serializable;","Ljava/io/UnixFileSystem;","Ljava/lang/ArithmeticException;","Ljava/lang/ArrayIndexOutOfBoundsException;","Ljava/lang/ArrayStoreException;","Ljava/lang/ClassCastException;","Ljava/lang/ClassNotFoundException;","Ljava/lang/NoClassDefFoundError;","Ljava/lang/Cloneable;","Ljava/lang/ExceptionInInitializerError;","Ljava/lang/IllegalMonitorStateException;","Ljava/lang/InterruptedException;","Ljava/lang/NegativeArraySizeException;","Ljava/lang/NoSuchFieldError;","Ljava/lang/NoSuchMethodError;","Ljava/lang/NullPointerException;","Ljava/lang/reflect/Constructor;","Ljava/lang/reflect/Field;","Ljava/lang/reflect/Method;","Ljava/lang/System;","Ljava/lang/Thread;","Ljava/lang/ThreadGroup;","Ljava/lang/Throwable;","Ljava/lang/UnsatisfiedLinkError;","Ljava/nio/ByteOrder;","Lsun/misc/VM;","Lsun/reflect/ConstantPool;","Ljava/lang/Byte;","Ljava/lang/Character;","Ljava/lang/Double;","Ljava/lang/Float;","Ljava/lang/Integer;","Ljava/lang/Long;","Ljava/lang/Short;","Ljava/lang/Boolean;","[Lsun/management/MemoryManagerImpl;","[Lsun/management/MemoryPoolImpl;"],_this=this;util.async_foreach(core_classes,function(cls,next_item){trace("Initializing "+cls),_this.jvm_state.bs_cl.initialize_class(_this,cls,next_item,except_cb)},resume_cb)},RuntimeState.prototype.init_threads=function(){var _this=this,my_sf=this.curr_frame(),thread_group_cls=this.get_bs_class("Ljava/lang/ThreadGroup;"),thread_cls=this.get_bs_class("Ljava/lang/Thread;"),group=new JavaObject(this,thread_group_cls);this.push(group),thread_group_cls.method_lookup(this,"<init>()V").setup_stack(this),my_sf.runner=function(){var ct=null;my_sf.runner=function(){my_sf.runner=null,ct.$meta_stack=_this.meta_stack(),_this.curr_thread=ct,_this.curr_thread.$isAlive=!0,_this.thread_pool.push(_this.curr_thread),thread_cls.static_fields.threadInitNumber=1,debug("### finished thread init ###")},ct=new threading.JavaThreadObject(_this,_this.get_bs_class("Ljava/lang/Thread;"),{"Ljava/lang/Thread;name":_this.init_carr("main"),"Ljava/lang/Thread;priority":1,"Ljava/lang/Thread;group":group,"Ljava/lang/Thread;threadLocals":null,"Ljava/lang/Thread;blockerLock":new JavaObject(_this,_this.get_bs_class("Ljava/lang/Object;"))})}},RuntimeState.prototype.meta_stack=function(){return this.curr_thread.$meta_stack},RuntimeState.prototype.java_throw=function(cls,msg){var _this=this,v=new JavaObject(this,cls);this.push_array([v,v,this.init_string(msg)]);var my_sf=this.curr_frame();throw cls.method_lookup(this,"<init>(Ljava/lang/String;)V").setup_stack(this),my_sf.runner=function(){throw my_sf.method.has_bytecode?my_sf.runner=function(){return my_sf.method.run_bytecode(_this)}:my_sf.runner=null,new JavaException(_this.pop())},ReturnException},RuntimeState.prototype.init_system_class=function(){var _this=this,my_sf=this.curr_frame();this.get_bs_class("Ljava/lang/System;").get_method("initializeSystemClass()V").setup_stack(this),my_sf.runner=function(){my_sf.runner=null,_this.system_initialized=!0,debug("### finished system class initialization ###")}},RuntimeState.prototype.init_args=function(initial_args){var _this=this,str_arr_cls=this.get_bs_class("[Ljava/lang/String;"),args=new JavaArray(this,str_arr_cls,initial_args.map(function(a){return _this.init_string(a)}));this.curr_thread.$meta_stack=new threading.CallStack([args]),debug("### finished runtime state initialization ###")},RuntimeState.prototype.choose_next_thread=function(blacklist,cb){var _this=this,_this=this;if(blacklist==null){blacklist=[];for(var key in this.waiting_threads)blacklist.push.apply(blacklist,this.waiting_threads[key])}var wakeup_time=this.curr_thread.wakeup_time;wakeup_time==null&&(wakeup_time=Infinity);var current_time=(new Date).getTime(),eligible_threads=this.thread_pool.filter(function(t){return t!==_this.curr_thread&&t.$isAlive});for(var i=0;i<eligible_threads.length;i++){var t=eligible_threads[i];if(this.parked(t)){if(t.$park_timeout>current_time)continue;this.unpark(t)}if(blacklist.indexOf(t)>=0)continue;if(t.wakeup_time>current_time){t.wakeup_time<wakeup_time&&(wakeup_time=t.wakeup_time);continue}return debug("TE(choose_next_thread): choosing thread "+t.name(this)),cb(t)}Infinity>wakeup_time&&wakeup_time>current_time?(debug("TE(choose_next_thread): waiting until "+wakeup_time+" and trying again"),setTimeout(function(){return _this.choose_next_thread(null,cb)},wakeup_time-current_time)):(debug("TE(choose_next_thread): no thread found, sticking with curr_thread"),cb(this.curr_thread))},RuntimeState.prototype.wait=function(monitor,yieldee){debug("TE(wait): waiting "+this.curr_thread.name(this)+" on lock "+monitor.ref),this.waiting_threads[monitor.ref]!=null?this.waiting_threads[monitor.ref].push(this.curr_thread):this.waiting_threads[monitor.ref]=[this.curr_thread];if(yieldee!=null)return this.yield(yieldee);var _this=this;this.choose_next_thread(this.waiting_threads[monitor.ref],function(nt){return _this.yield(nt)})},RuntimeState.prototype.yield=function(yieldee){var _this=this;debug("TE(yield): yielding "+this.curr_thread.name(this)+" to "+yieldee.name(this));var old_thread_sf=this.curr_frame();this.curr_thread=yieldee;var new_thread_sf=this.curr_frame();new_thread_sf.runner=function(){return _this.meta_stack().pop()},old_thread_sf.runner=function(){return _this.meta_stack().pop()}},RuntimeState.prototype.park=function(thread,timeout){var _this=this;thread.$park_count++,thread.$park_timeout=timeout,debug("TE(park): parking "+thread.name(this)+" (count: "+thread.$park_count+", timeout: "+thread.$park_timeout+")"),this.parked(thread)&&this.choose_next_thread(null,function(nt){return _this.yield(nt)})},RuntimeState.prototype.unpark=function(thread){debug("TE(unpark): unparking "+thread.name(this)),thread.$park_count--,thread.$park_timeout=Infinity,this.parked(thread)||this.yield(thread)},RuntimeState.prototype.parked=function(thread){return thread.$park_count>0},RuntimeState.prototype.curr_frame=function(){return this.meta_stack().curr_frame()},RuntimeState.prototype.cl=function(idx){return this.curr_frame().locals[idx]},RuntimeState.prototype.put_cl=function(idx,val){this.curr_frame().locals[idx]=val},RuntimeState.prototype.put_cl2=function(idx,val){this.put_cl(idx,val),!0},RuntimeState.prototype.push=function(arg){return this.curr_frame().stack.push(arg)},RuntimeState.prototype.push2=function(arg1,arg2){return this.curr_frame().stack.push(arg1,arg2)},RuntimeState.prototype.push_array=function(args){var cs=this.curr_frame().stack;Array.prototype.push.apply(cs,args)},RuntimeState.prototype.pop=function(){return this.curr_frame().stack.pop()},RuntimeState.prototype.pop2=function(){return this.pop(),this.pop()},RuntimeState.prototype.peek=function(depth){depth==null&&(depth=0);var s=this.curr_frame().stack;return s[s.length-1-depth]},RuntimeState.prototype.curr_pc=function(){return this.curr_frame().pc},RuntimeState.prototype.goto_pc=function(pc){return this.curr_frame().pc=pc},RuntimeState.prototype.inc_pc=function(n){return this.curr_frame().pc+=n},RuntimeState.prototype.check_null=function(obj){if(obj==null){var err_cls=this.get_bs_class("Ljava/lang/NullPointerException;");this.java_throw(err_cls,"")}return obj},RuntimeState.prototype.heap_newarray=function(type,len){if(len<0){var err_cls=this.get_bs_class("Ljava/lang/NegativeArraySizeException;");this.java_throw(err_cls,"Tried to init ["+type+" array with length "+len)}var arr_cls=this.get_class("["+type);return type==="J"?new JavaArray(this,arr_cls,util.arrayset(len,gLong.ZERO)):type[0]==="L"||type[0]==="["?new JavaArray(this,arr_cls,util.arrayset(len,null)):new JavaArray(this,arr_cls,util.arrayset(len,0))},RuntimeState.prototype.heap_multinewarray=function(type,counts){var _this=this,dim=counts.length,init_arr=function(curr_dim,type){var len=counts[curr_dim];if(len<0){var err_cls=_this.get_bs_class("Ljava/lang/NegativeArraySizeException;");_this.java_throw(err_cls,"Tried to init dimension "+curr_dim+" of a "+dim+" dimensional "+type+" array with length "+len)}var array=new Array(len);if(curr_dim+1===dim){var default_val=util.initial_value(type);for(var i=0;i<len;i++)array[i]=default_val}else{var next_dim=curr_dim+1,comp_type=type.slice(1);for(var i=0;i<len;i++)array[i]=init_arr(next_dim,comp_type)}var arr_cls=_this.get_bs_class(type);return new JavaArray(_this,arr_cls,array)};return init_arr(0,type)},RuntimeState.prototype.init_string=function(str,intern){intern==null&&(intern=!1);var s=this.string_pool.get(str);if(intern&&s!=null)return s;var carr=this.init_carr(str),str_cls=this.get_bs_class("Ljava/lang/String;"),jvm_str=new JavaObject(this,str_cls,{"Ljava/lang/String;value":carr,"Ljava/lang/String;count":str.length});return intern&&this.string_pool.set(str,jvm_str),jvm_str},RuntimeState.prototype.init_carr=function(str){var carr=new Array(str.length);for(var i=0;i<str.length;i++)carr[i]=str.charCodeAt(i);var arr_cls=this.get_bs_class("[C");return new JavaArray(this,arr_cls,carr)},RuntimeState.prototype.block_addr=function(l_address){var address=l_address.toNumber();if(typeof DataView!="undefined"&&DataView!==null){var block_addr_=this.mem_start_addrs[0];for(var i=1;i<this.mem_start_addrs.length;i++){var addr=this.mem_start_addrs[i];if(address<addr)return block_addr_;block_addr_=addr}throw new Error("Invalid memory access at "+address)}if(this.mem_blocks[address]!=null)return address},RuntimeState.prototype.handle_toplevel_exception=function(e,no_threads,done_cb){var _this=this;this.unusual_termination=!0,e.toplevel_catch_handler!=null?this.run_until_finished(function(){return e.toplevel_catch_handler(_this)},no_threads,done_cb):(error("\nInternal JVM Error:",e),(e!=null?e.stack:void 0)!=null&&error(e.stack),done_cb(!1))},RuntimeState.prototype.async_op=function(cb){throw new YieldIOException(cb)},RuntimeState.prototype.call_bytecode=function(cls,method,args,success_cb,except_cb){var _this=this,good_cb=function(ret1,ret2){return _this.async_op(function(good){return good(ret1,ret2)})},bad_cb=function(e_fn){return _this.async_op(function(good,bad){return bad(e_fn)})};return this.async_op(function(){var is_constructor=!1;if(method.name.charAt(0)==="<"&&method.name.charAt(1)==="i"){var v=new JavaObject(_this,cls);args.unshift(v,v),is_constructor=!0}var nf=threading.StackFrame.native_frame("$bytecode_call",function(){if(method.return_type!=="V"||is_constructor){(method.return_type==="J"||method.return_type==="D")&&_this.pop();var rv=_this.pop()}return _this.meta_stack().pop(),success_cb(rv,good_cb,bad_cb)},function(e){return _this.meta_stack().pop(),except_cb(function(){throw e},good_cb,bad_cb)});return _this.meta_stack().push(nf),_this.push_array(args),method.setup_stack(_this),_this.run_until_finished(function(){},!1,_this.stashed_done_cb)})},RuntimeState.prototype.run_until_finished=function(setup_fn,no_threads,done_cb){function nop(){}var _this=this,stack;setImmediate(function(){_this.stashed_done_cb=done_cb;try{setup_fn();var start_time=(new Date).getTime(),m_count=_this.max_m_count,sf=_this.curr_frame();while(sf.runner!=null&&m_count>0)sf.runner(),m_count--,sf=_this.curr_frame();if(sf.runner!=null&&m_count===0){var duration=(new Date).getTime()-start_time;if(duration>2e3||duration<1e3){var ms_per_m=duration/_this.max_m_count;_this.max_m_count=1e3/ms_per_m|0}return _this.run_until_finished(nop,no_threads,done_cb)}return no_threads||_this.thread_pool.length<=1?done_cb(!0):(debug("TE(toplevel): finished thread "+_this.curr_thread.name(_this)),_this.curr_thread.$isAlive=!1,_this.thread_pool.splice(_this.thread_pool.indexOf(_this.curr_thread),1),_this.choose_next_thread(null,function(next_thread){_this.curr_thread=next_thread,_this.run_until_finished(nop,no_threads,done_cb)}))}catch(_error){var e=_error;if(e===ReturnException)_this.run_until_finished(nop,no_threads,done_cb);else if(e instanceof YieldIOException){var success_fn=function(ret1,ret2,bytecode,advance_pc){return advance_pc==null&&(advance_pc=!0),bytecode&&_this.meta_stack().push(threading.StackFrame.native_frame("async_op")),_this.curr_frame().runner=function(){_this.meta_stack().pop(),bytecode&&advance_pc&&(_this.curr_frame().pc+=1+_this.curr_frame().method.code.opcodes[_this.curr_frame().pc].byte_count),ret1!==void 0&&(typeof ret1=="boolean"&&(ret1+=0),_this.push(ret1));if(ret2!==void 0)return _this.push(ret2)},_this.run_until_finished(nop,no_threads,done_cb)},failure_fn=function(e_cb){return _this.meta_stack().push(threading.StackFrame.native_frame("async_op")),_this.curr_frame().runner=function(){_this.meta_stack().pop(),e_cb()},_this.run_until_finished(nop,no_threads,done_cb)};e.condition(success_fn,failure_fn)}else{stack=_this.meta_stack();if(e.method_catch_handler!=null&&stack.length()>1){var frames_to_pop=0;while(!e.method_catch_handler(_this,stack.get_caller(frames_to_pop),frames_to_pop===0))if(stack.length()===++frames_to_pop){_this.jvm_state.dump_state(),stack.pop_n(stack.length()-1),_this.handle_toplevel_exception(e,no_threads,done_cb);return}stack.pop_n(frames_to_pop),_this.run_until_finished(nop,no_threads,done_cb)}else _this.jvm_state.dump_state(),stack.pop_n(Math.max(stack.length()-1,0)),_this.handle_toplevel_exception(e,no_threads,done_cb)}}})},RuntimeState.prototype.async_input=function(n_bytes,resume){if(this.input_buffer.length>0){var data=this.input_buffer.slice(0,n_bytes);this.input_buffer=this.input_buffer.slice(n_bytes),resume(data);return}var _this=this;this._async_input(function(data){data.length>n_bytes&&(_this.input_buffer=data.slice(n_bytes)),resume(data.slice(0,n_bytes))})},RuntimeState}();exports.RuntimeState=RuntimeState}),define("src/disassembler",["require","exports","./util","./ClassData"],function(require,exports,__util__,__ClassData__){function pad_left(value,padding){var zeroes=(new Array(padding)).join("0");return(zeroes+value).slice(-padding)}function access_string(access_flags){var ordered_flags=["public","protected","private","static","final","native"];return access_flags["interface"]||ordered_flags.push("abstract"),ordered_flags.filter(function(flag){return access_flags[flag]}).map(function(flag){return flag+" "}).join("")}function format_decimal(val,type_char){var valStr=val.toString();type_char==="f"&&(val===util.FLOAT_POS_INFINITY||val===Number.POSITIVE_INFINITY?valStr="Infinity":val===util.FLOAT_NEG_INFINITY||val===Number.NEGATIVE_INFINITY?valStr="-Infinity":val===NaN&&(valStr="NaN"));var str;if(valStr.match(/-?(Infinity|NaN)/))str=valStr;else{var m=valStr.match(/(-?\d+)(\.\d+)?(?:e\+?(-?\d+))?/);str=m[1]+(m[2]?m[2]:".0"),type_char==="f"&&m[2]!=null&&m[2].length>8&&(str=parseFloat(str).toFixed(7)),str=str.replace(/0+$/,"").replace(/\.$/,".0"),m[3]!=null&&(str+="E"+m[3])}return str+type_char}function format(entry){var val=entry.value;switch(entry.type){case"Method":case"InterfaceMethod":case"Field":return"#"+val.class_ref.value+".#"+val.sig.value;case"NameAndType":return"#"+val.meth_ref.value+":#"+val.type_ref.value;case"float":return format_decimal(val,"f");case"double":return format_decimal(val,"d");case"long":return val+"l";default:return util.escape_whitespace((entry.deref!=null?"#":"")+val).replace(/"/g,'\\"')}}function pp_type(field_type){return util.is_array_type(field_type)?pp_type(util.get_component_type(field_type))+"[]":util.ext_classname(field_type)}function print_excs(excs){return"   throws "+excs.map(util.ext_classname).join(", ")}function fixed_width(num,width){var num_str=num.toString();return(new Array(width-num_str.length+1)).join(" ")+num_str}function disassemble(buffer){var class_file=new ClassData.ReferenceClassData(buffer);return show_disassembly(make_dis(class_file))}function make_dis(class_file){var src_attr=class_file.get_attribute("SourceFile"),rva_attr=class_file.get_attribute("RuntimeVisibleAnnotations"),dis={source_file:src_attr!=null?src_attr.filename:null,is_deprecated:class_file.get_attribute("Deprecated")!=null,annotation_bytes:rva_attr!=null?rva_attr.raw_bytes:null,interfaces:class_file.get_interface_types(),access_string:access_string(class_file.access_flags),class_type:class_file.access_flags["interface"]?"interface":"class",class_name:class_file.get_type(),superclass:class_file.get_super_class_type(),major_version:class_file.major_version,minor_version:class_file.minor_version,constant_pool:[],inner_classes:[],fields:[],methods:[]},pool=class_file.constant_pool;pool.each(function(idx,entry){dis.constant_pool.push({idx:idx,type:entry.type,value:format(entry),extra:util.format_extra_info(entry)})});var inner_classes=class_file.get_attributes("InnerClasses");for(var i=0;i<inner_classes.length;i++){var icls=inner_classes[i],icls_group=[];for(var j=0;j<icls.classes.length;j++){var cls=icls.classes[j],flags=util.parse_flags(cls.inner_access_flags),astr="";flags["public"]&&(astr+="public "),flags["abstract"]&&(astr+="abstract "),icls_group.push({access_string:astr,type:util.descriptor2typestr(pool.get(cls.inner_info_index).deref()),raw:cls,name:cls.inner_name_index>0?pool.get(cls.inner_name_index).value:null,outer_type:cls.outer_info_index>0?pool.get(cls.outer_info_index).deref():null})}dis.inner_classes.push(icls_group)}var fields=class_file.get_fields();for(var i=0;i<fields.length;i++){var f=fields[i],sig=f.get_attribute("Signature"),field={type:f.type,name:f.name,access_string:access_string(f.access_flags),signature_bytes:sig!=null?sig.raw_bytes:null,const_type:null,const_value:null},const_attr=f.get_attribute("ConstantValue");if(const_attr!=null){var entry=pool.get(const_attr.ref);field.const_type=entry.type,field.const_value=typeof entry.deref=="function"?entry.deref():format(entry)}dis.fields.push(field)}var methods=class_file.get_methods();for(sig in methods){var m=methods[sig],exc_attr=m.get_attribute("Exceptions"),method={access_string:access_string(m.access_flags),is_synchronized:m.access_flags.synchronized,return_type:m.return_type!=null?m.return_type:"",name:m.name,param_types:m.param_types,exceptions:exc_attr!=null?exc_attr.exceptions:null};if(!m.access_flags["native"]&&!m.access_flags.abstract){var code=m.code;code.parse_code(),method.code={max_stack:code.max_stack,max_locals:code.max_locals,num_args:m.num_args,exception_handlers:code.exception_handlers,attributes:code.attrs};var ops=method.code.opcodes=[];code.each_opcode(function(idx,oc){return ops.push({idx:idx,name:oc.name,annotation:oc.annotate(idx,pool)})})}dis.methods.push(method)}return dis}function show_disassembly(dis){var ifaces=dis.interfaces.map(util.ext_classname).join(","),name=util.ext_classname(dis.class_name),rv='Compiled from "'+(dis.source_file!=null?dis.source_file:"unknown")+'"\n'+dis.access_string+dis.class_type+" "+name+" ";dis.class_type==="interface"?rv+=ifaces.length>0?"extends "+ifaces+"\n":"\n":(rv+="extends "+util.ext_classname(dis.superclass),rv+=ifaces?" implements "+ifaces+"\n":"\n"),dis.source_file&&(rv+='  SourceFile: "'+dis.source_file+'"\n'),dis.is_deprecated&&(rv+="  Deprecated: length = 0x\n");if(dis.annotation_bytes){var alen=dis.annotation_bytes.length.toString(16),abytes=dis.annotation_bytes.map(function(b){return pad_left(b.toString(16),2)}).join(" ");rv+="  RuntimeVisibleAnnotations: length = 0x"+alen+"\n   "+abytes+"\n"}for(var i=0,_len=dis.inner_classes.length;i<_len;i++){var icls_group=dis.inner_classes[i];rv+="  InnerClass:\n";for(var j=0,_len1=icls_group.length;j<_len1;j++){var icls=icls_group[j];icls.name==null?rv+="   "+icls.access_string+"#"+icls.raw.inner_info_index+"; //class "+icls.type+"\n":(rv+="   "+icls.access_string+"#"+icls.raw.inner_name_index+"= #"+icls.raw.inner_info_index,icls.outer_type==null?rv+="; //"+icls.name+"=class "+icls.type+"\n":rv+=" of #"+icls.raw.outer_info_index+"; //"+icls.name+"=class "+icls.type+" of class "+icls.outer_type+"\n")}}rv+="  minor version: "+dis.minor_version+"\n  major version: "+dis.major_version+"\n  Constant pool:\n";for(var i=0,_len2=dis.constant_pool.length;i<_len2;i++){var entry=dis.constant_pool[i];rv+="const #"+entry.idx+" = "+entry.type+"	"+entry.value+";"+entry.extra+"\n"}rv+="\n{\n";for(var i=0,_len3=dis.fields.length;i<_len3;i++){var f=dis.fields[i];rv+=""+f.access_string+pp_type(f.type)+" "+f.name+";\n",f.const_type!=null&&(rv+="  Constant value: "+f.const_type+" "+f.const_value+"\n");if(f.signature_bytes!=null){var siglen=f.signature_bytes.length.toString(16),sigbytes=function(){var _ref4=f.signature_bytes,_results=[];for(var _m=0,_len4=_ref4.length;_m<_len4;_m++){var b=_ref4[_m];_results.push(pad_left(b.toString(16).toUpperCase(),2))}return _results}().join(" ");rv+="  Signature: length = 0x"+siglen+"\n   "+sigbytes+"\n"}rv+="\n\n"}for(var _m=0,_len4=dis.methods.length;_m<_len4;_m++){var m=dis.methods[_m];rv+=m.access_string,m.is_synchronized&&(rv+="synchronized ");var ptypes=m.param_types.map(pp_type).join(", ");m.name==="<clinit>"?rv+="{}":m.name==="<init>"?rv+=""+name+"("+ptypes+")":rv+=""+pp_type(m.return_type)+" "+m.name+"("+ptypes+")",m.exceptions!=null&&(rv+=print_excs(m.exceptions)),rv+=";\n";if(m.code!=null){var c=m.code;rv+="  Code:\n   Stack="+c.max_stack+", Locals="+c.max_locals+", Args_size="+c.num_args+"\n",rv+=function(){var _results=[];for(var _n=0,_len5=c.opcodes.length;_n<_len5;_n++){var o=c.opcodes[_n];_results.push("   "+o.idx+":	"+o.name+o.annotation+"\n")}return _results}().join("");var ehs=c.exception_handlers;if(ehs!=null&&ehs.length>0){rv+="  Exception table:\n   from   to  target type\n";for(var _n=0,_len5=ehs.length;_n<_len5;_n++){var eh=ehs[_n];rv+=function(){var _ref7=["start_pc","end_pc","handler_pc"],_results=[];for(var _o=0,_len6=_ref7.length;_o<_len6;_o++){var item=_ref7[_o];_results.push(fixed_width(eh[item],6))}return _results}().join(""),eh.catch_type==="<any>"?rv+="   any\n":rv+="   Class "+eh.catch_type.slice(1,-1)+"\n"}rv+="\n"}rv+=c.attributes.map(function(attr){return(typeof attr.disassemblyOutput=="function"?attr.disassemblyOutput():void 0)||""}).join(""),m.exceptions!=null&&(rv+="  Exceptions:\n"+print_excs(m.exceptions)+"\n")}rv+="\n"}return rv+="}\n",rv}var util=__util__,ClassData=__ClassData__;exports.disassemble=disassemble}),define("src/testing",["require","exports","./jvm","./runtime","./util","./disassembler"],function(require,exports,__jvm__,__runtime__,__util__,__disassembler__){function find_test_classes(doppio_dir,cb){var test_dir=path.resolve(doppio_dir,"classes/test");fs.readdir(test_dir,function(err,files){cb(files.filter(function(file){return path.extname(file)===".java"}).map(function(file){return"classes/test/"+path.basename(file,".java")}))})}function run_tests(test_classes,stdout,hide_diffs,quiet,keep_going,callback){function _runner(test_classes,xfails){if(test_classes.length===0)return quiet||keep_going||stdout("Pass\n"),callback(!1);var test=test_classes.shift();test.indexOf(".")!==-1&&(test=util.descriptor2typestr(util.int_classname(test))),quiet||stdout("testing "+test+"...\n"),run_disasm_test(doppio_dir,test,function(disasm_diff){if(disasm_diff!=null){stdout("Failed disasm test "+test+"\n"),hide_diffs||stdout(""+disasm_diff+"\n");if(!keep_going)return callback(!0)}run_stdout_test(doppio_dir,test,function(diff){if(diff!=null!=xfails.indexOf(test)>=0){diff!=null?(stdout("Failed output test: "+test+"\n"),hide_diffs||stdout(diff+"\n")):stdout("Expected failure passed: "+test+"\n");if(!keep_going)return callback(!0)}_runner(test_classes,xfails)})})}var doppio_dir=typeof node!="undefined"&&node!==null?"/sys/":path.resolve(__dirname,".."),jcl_dir=path.resolve(doppio_dir,"vendor/classes");jvm_state.set_classpath(jcl_dir,doppio_dir);var xfail_file=path.resolve(doppio_dir,"classes/test/xfail.txt");fs.readFile(xfail_file,"utf-8",function(err,contents){var xfails=contents.split("\n").map(function(failname){return"classes/test/"+failname});test_classes!=null&&test_classes.length>0?(test_classes=test_classes.map(function(tc){return tc.replace(/\.class$/,"")}),_runner(test_classes,xfails)):exports.find_test_classes(doppio_dir,function(tcs){return _runner(tcs,xfails)})})}function sanitize(str){return str.replace(/\/\/.*/g,"").replace(/^\s*$[\n\r]+/mg,"").replace(/(float|double)\t.*/g,"$1").replace(/[ \t\r]+/g," ").replace(/[ ]\n/g,"\n").replace(/\[ \]/g,"[]")}function run_disasm_test(doppio_dir,test_class,callback){var test_path=path.resolve(doppio_dir,test_class);fs.readFile(test_path+".disasm","utf8",function(err,contents){var javap_disasm=sanitize(contents);fs.readFile(test_path+".class",function(err,buffer){var doppio_disasm=sanitize(disassembler.disassemble(buffer));callback(cleandiff(doppio_disasm,javap_disasm))})})}function run_stdout_test(doppio_dir,test_class,callback){var output_filename=path.resolve(doppio_dir,test_class)+".runout";fs.readFile(output_filename,"utf8",function(err,java_output){var doppio_output="",stdout=function(str){doppio_output+=str};jvm_state.reset_classloader_cache(),jvm_state.run_class(stdout,function(){},test_class,[],function(){return callback(cleandiff(doppio_output,java_output))})})}function cleandiff(our_str,their_str){var our_lines=our_str.split(/\n/),their_lines=their_str.split(/\n/),oidx=0,tidx=0,diff=[];while(oidx<our_lines.length&&tidx<their_lines.length){if(our_lines[oidx++]===their_lines[tidx++])continue;diff.push("D:"+our_lines[oidx-1]+"\nJ:"+their_lines[tidx-1])}diff.push.apply(diff,our_lines.slice(oidx).map(function(extra){return"D:"+extra})),diff.push.apply(diff,their_lines.slice(tidx).map(function(extra){return"J:"+extra}));if(diff.length>0)return diff.join("\n")}var jvm=__jvm__,runtime=__runtime__,RuntimeState=runtime.RuntimeState,util=__util__,disassembler=__disassembler__,path=typeof node!="undefined"?node.path:require("path"),fs=typeof node!="undefined"?node.fs:require("fs"),jvm_state=new jvm.JVM;exports.find_test_classes=find_test_classes,exports.run_tests=run_tests});